CGEOM --027 ***CITATION*** READS INPUT SECTION 003/ CF-INPT
C
      SUBROUTINE GEOMC(ISTEP,DND)
C
CDEL  INTEGER RGX , MSX , ZNEX , ZDX , WZX
CDEL  PARAMETER ( RGX=100, MSX=211, ZDX=200, ZNEX=1000, WZX=100 )
      INCLUDE  'CITPMINC'
C
CMM   REAL*8 HOLBND
      CHARACTER*8 HOLBND
C
      COMMON/ALSUB/BLSUB(30),TITL1(18),TITL2(18),IMAX,JMAX,KBMAX,KMAX,
     & LMAX,MMAX, NMAX,IMXP1,JMXP1,KBMXP1,NSETMX,NTO,MM1VX,KM1VX,IOIN,
     & IOUT,IOSIG,IOFLX,IO1,IO2,IO3,IO4,IO7,NER(100), IX(200),INNO(100),
     &  NGC(24),IEDG(24),ITMX(24),TIMX(6), GLIM(6),NDPL(24),IEDP1(24),
     & IEDP2(24),IEDP3(24), DPLH(6),NUAC(24),EPI(6),XMIS(6),NSRH(24),
     & XSRH1(6), XTR1(WZX),XTR2(WZX),NXTR1(WZX),NXTR2(WZX),SPARE(200),
     & IXPUT(200),XPUT(200)
      COMMON/AFLUX/BFLUX(30),KXMN8,NIT,NIIT,NIIIT,JXP1,KSCT1,KSCT2,
     & ISTART,IEP, VRGP1,VRGP2,VRGP3,VRG1,VRG2,VRGK1,VRGK2,XABS,PROD,
     & XLEK,RMX,RMN,XKEF1,XKEF2,XKEF3,EXFC1,EXFC2,EXFC3, NI3,IEXTR,
     & IRECV,VRGABS,LO3,LO4,XLAMDA,EPI1,EPI2, BETTA,SUMXI,IX25,IX28,I,J,
     &  KB,K,ITMAX,ITIME, BET(MSX),DEL(MSX)
C
      DIMENSION DND(1)
      DIMENSION B(6)
      DIMENSION HOLBND(6)
      DATA HOLBND/'LEFT    ','TOP     ','RIGHT   ','BOTTOM  ',
     & 'FRONT   ','BACK    '/
C
C
  100 READ(IOIN,1000)(NUAC(I),I=1,24)
C     FORCE KEFF TO BE CALCULATED WITH NEUTRON BALANCE INSTEAD
C     OF WITH RESIDUES.
      NUAC(3) = 0
      IF (NUAC(5)-5) 101,101,102
  101 NUAC(20) = 1
      NUAC(12) = 1
      NUAC(14) = 1
  102 CONTINUE
      IX(72) = 0
      IF (NUAC(11).GE.0) GO TO 103
      NUAC(13) = NUAC(11)
      IX(72) = 1
      NUAC(8) = 0
  103 CONTINUE
      IF (NUAC(13).LE.1) GO TO 104
      IX(72)=NUAC(13)
      NUAC(8)=0
  104 CONTINUE
      IF ((NUAC(12).LT.0).OR.(NUAC(14).LT.0).OR.(NUAC(15).LT.0)
     & .OR.(NUAC(16).LT.0)) NER(30) = 30
      IF (IX(72).NE.1) GO TO 105
      N = NUAC(5)
      IF ((N.EQ.2).OR.(N.EQ.3).OR.(N.EQ.7).OR.(N.EQ.9).OR.(N.EQ.13))
     & NER(30) = 30
  105 CONTINUE
      INRB=IX(72)+1
C******************CONVERGENCE CRITERIA*********************************
      READ(IOIN,1001)(EPI(I),I=1,6)
      IF (EPI(1).LE.0) EPI(1) = 0.0001
      IF (EPI(2).LE.0) EPI(2) = 0.00001
      IF (EPI(3).LE.0) EPI(3) = 0.0001
      IF (EPI(4).LE.0) EPI(4)=0.0001
      IF (EPI(5).LE.0) EPI(5)=0.0001
      EPI1 = EPI(1)
      EPI2 = EPI(2)
      READ(IOIN,1001)(XMIS(I),I=1,6)
      IF (XMIS(3)) 107,106,107
  106 XMIS(3) = 1.0
  107 IF (XMIS(4)) 109,108,109
  108 XMIS(4) = 1.0
  109 IF (XMIS(5)) 111,110,111
  110 XMIS(5) = 1.0
  111 CONTINUE
      SPARE(100) = XMIS(3)
      IX(31) = 0
      IF (XMIS(6)) 113,113,112
  112 IX(31) = 1
  113 CONTINUE
      IF(ISTEP.EQ.1)WRITE(IOUT,1002)
      IF(ISTEP.EQ.1)WRITE(IOUT,1003)(NUAC(I),I=1,24)
      IF(ISTEP.EQ.1)WRITE(IOUT,1008)(EPI (I),I=1,6)
      IF(ISTEP.EQ.1)WRITE(IOUT,1008)(XMIS(I),I=1,6)
      IX(26) = NUAC(5)
      IF (NUAC(5).GT.5) GO TO 114
       IX(25)=1
      GO TO 116
  114 IF (NUAC(5).GT.10) GO TO 115
      IX(25) = 2
      GO TO 116
  115 IX(25) = 3
  116 CONTINUE
      I1 = 0
      I2 = 0
      IF (XMIS(1).LT.0.0) I1 = IFIX(-XMIS(1) + 0.01)
      IF (XMIS(2).LT.0.0) I2 = IFIX(-XMIS(2) + 0.01)
      I3 = MAX0(I1,I2)
      IF (I3.LE.0) GO TO 117
      IO19 = IX(86)
      REWIND IO19
      REWIND IO3
      WRITE(IO3) (DND(K),K=1,I3)
      REWIND IO3
  117 CONTINUE
      IF (XMIS(1)) 118,132,133
  118 KMX = I1
      IGOTO = IX(25) - 2
      IF (IGOTO) 119,120,126
  119 IF (IX(72).GT.0) GO TO 144
      I = 1
      READ(IOIN,1001) (DND(K),K=1,KMX)
      WRITE(IO19) I,(DND(K),K=1,KMX)
      IF(ISTEP.EQ.1)WRITE(IOUT,1004) HOLBND(I),(DND(K),K=1,KMX)
      I = 3
      READ(IOIN,1001) (DND(K),K=1,KMX)
      WRITE(IO19) I,(DND(K),K=1,KMX)
      IF(ISTEP.EQ.1)WRITE(IOUT,1004) HOLBND(I),(DND(K),K=1,KMX)
      GO TO 144
  120 DO 125 I = 1,4
      GO TO (124,121,122,123),INRB
  121 IF (I.EQ.1.OR.I.EQ.3) GO TO 125
      GO TO 124
  122 IF (I.EQ.3.OR.I.EQ.4) GO TO 125
      GO TO 124
  123 IF (I.EQ.3) GO TO 125
  124 CONTINUE
      READ(IOIN,1001) (DND(K),K=1,KMX)
      WRITE(IO19) I,(DND(K),K=1,KMX)
      IF(ISTEP.EQ.1)WRITE(IOUT,1004) HOLBND(I),(DND(K),K=1,KMX)
  125 CONTINUE
      GO TO 144
  126 DO 131 I = 1,6
      GO TO (130,127,128,129),INRB
  127 IF (I.EQ.1.OR.I.EQ.3) GO TO 131
      GO TO 130
  128 IF (I.EQ.3.OR.I.EQ.4) GO TO 131
      GO TO 130
  129 IF (I.EQ.3) GO TO 131
  130 CONTINUE
      READ(IOIN,1001) (DND(K),K=1,KMX)
      WRITE(IO19) I,(DND(K),K=1,KMX)
      IF(ISTEP.EQ.1)WRITE(IOUT,1004) HOLBND(I),(DND(K),K=1,KMX)
  131 CONTINUE
      GO TO 144
  132 T1 = 0.4692
      GO TO 134
  133 T1 = XMIS(1)
  134 DO 137 I = 11,16
      II = I-10
      IF (NUAC(I)) 136,135,136
  135 B(II) = T1
      GO TO 137
  136 B(II) = 0.0
  137 CONTINUE
      IF(ISTEP.EQ.1)WRITE(IOUT,1009)
      GO TO (138,139,140,142),INRB
  138 IF(ISTEP.EQ.1)WRITE(IOUT,1005) B(1),B(2),B(3),B(4),B(5),B(6)
      GO TO 143
  139 IF(ISTEP.EQ.1)WRITE(IOUT,1010) B(2),B(4),B(5),B(6)
      GO TO 143
  140 CONTINUE
      IF ((NUAC(5).EQ.10).OR.(NUAC(5).EQ.14)) GO TO 141
      IF(ISTEP.EQ.1)WRITE(IOUT,1011)B(1),B(2),B(5),B(6)
      GO TO 143
  141 CONTINUE
      IF(ISTEP.EQ.1)WRITE(IOUT,1012)B(1),B(2),B(5),B(6)
      GO TO 143
  142 IF(ISTEP.EQ.1)WRITE(IOUT,1013) B(1),B(2),B(4),B(5),B(6)
  143 CONTINUE
  144 IF (NUAC(17)) 150,150,145
  145 IF (XMIS(2)) 146,147,148
  146 KMX = I2
      I = 7
      READ(IOIN,1001) (DND(K),K=1,KMX)
      WRITE(IO19) I,(DND(K),K=1,KMX)
      IF(ISTEP.EQ.1)WRITE(IOUT,1006) NUAC(17),(DND(K),K=1,KMX)
      GO TO 150
  147 T1 = 0.4692
      GO TO 149
  148 T1 = XMIS(2)
  149 IF(ISTEP.EQ.1)WRITE(IOUT,1007)NUAC(17),T1
  150 CONTINUE
      IF (I3.LE.0) GO TO 151
      END FILE IO19
      REWIND IO19
      READ(IO3) (DND(K),K=1,I3)
      REWIND IO3
  151 CONTINUE
  152 RETURN
 1000 FORMAT(24I3)
 1001 FORMAT(6E12.0)
 1002 FORMAT(1H0/1H0,'NEUTRON FLUX PROBLEM DESCRIPTION - SECTION 003')
 1003 FORMAT(1H0,24I4)
 1004 FORMAT(1H ,A8,1P6E14.6/(1H ,8X,1P6E14.6))
 1005 FORMAT(1H ,1P6E14.6)
 1006 FORMAT(1H0/1H0,'ROD BND. CONSTANTS FOR ZONE',I3/(1H ,1P6E14.6))
 1007 FORMAT(1H0/1H0,'ROD BND. CONSTANT FOR ALL GROUPS IN ZONE',I3,
     & '  IS',1PE14.6)
 1008 FORMAT(1H ,1P6E14.6)
 1009 FORMAT(1H0/'0LEFT,TOP,RIGHT,BOTTOM,FRONT,BACK BOUNDARY CONDITIO',
     &'NS ARE')
 1010 FORMAT(1H ,6X,'PERIODIC',1PE14.6,6X,'PERIODIC',1P3E14.6)
 1011 FORMAT(1H ,1P2E14.6,2X,'ROTATION(90)',2X,'ROTATION(90)',1P2E14.6)
 1012 FORMAT(1H ,1P2E14.6,2X,'ROTATION(60)',2X,'ROTATION(60)',1P2E14.6)
 1013 FORMAT(1H ,1P2E14.6,1X,'ROTATION(180)',1P3E14.6)
      END
