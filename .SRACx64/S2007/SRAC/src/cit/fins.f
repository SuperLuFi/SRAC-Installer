CFINS --099 ***CITATION*** CALC. ROD LOSSES FOR 1,2-D /CF-DNSD,WFLX
C
      SUBROUTINE FINS(P2,B2,NRGN,DCONB,DCONR,SCAC,XL,IVX,JVX,KVX, LVX,
     & IVXP1,JVXP1,IVZ,IOVX,IOVZ,PVOL,NCOMP,MVX)
C
CDEL  INTEGER RGX , MSX , ZNEX , ZDX , WZX
CDEL  PARAMETER ( RGX=100, MSX=211, ZDX=200, ZNEX=1000, WZX=100 )
      INCLUDE  'CITPMINC'
C
      REAL*8 P2
      REAL*8 SUMXI,TPTSA,XADB,XPDB,XS1DB,XS2DB, TL,XRDB,CS1S,CS2S,XLL1,
     & D8,XADX,YADX, XLL2,XLL3,XLL4,XLL5,XLL6,XLEK,B2LK,B3LK,B4LK,B5LK,
     & D1,D2,D3,D4,D5, D6,D7,YADB,YPDB,YLEK,YS1S,YS2S,YS1DB,YS2DB,YRDB,
     & SPR50,XLAST
C
      COMMON/ADUBP/SUMXI(ZNEX)
     &                  ,TPTSA,XADB,XPDB,XS1DB,XS2DB, TL,XRDB,CS1S,CS2S,
     &  XLL1,D8,XADX,YADX, XLL2,XLL3,XLL4,XLL5,XLL6,XLEK,B2LK,B3LK,B4LK,
     &  B5LK,D1,D2,D3,D4,D5, D6,D7,YADB,YPDB,YLEK,YS1S,YS2S,YS1DB,YS2DB,
     &  YRDB,SPR50,XLAST
      COMMON/ALSUB/BLSUB(30),TITL1(18),TITL2(18),IMAX,JMAX,KBMAX,KMAX,
     & LMAX,MMAX, NMAX,IMXP1,JMXP1,KBMXP1,NSETMX,NTO,MM1VX,KM1VX,IOIN,
     & IOUT,IOSIG,IOFLX,IO1,IO2,IO3,IO4,IO7,NER(100), IX(200),INNO(100),
     &  NGC(24),IEDG(24),ITMX(24),TIMX(6), GLIM(6),NDPL(24),IEDP1(24),
     & IEDP2(24),IEDP3(24), DPLH(6),NUAC(24),EPI(6),XMIS(6),NSRH(24),
     & XSRH1(6), XTR1(WZX),XTR2(WZX),NXTR1(WZX),NXTR2(WZX),SPARE(200),
     & IXPUT(200),XPUT(200)
      COMMON/AFLUX/BFLUX(30),KXMN8,NIT,NIIT,NIIIT,JXP1,KSCT1,KSCT2,
     & ISTART,IEP, VRGP1,VRGP2,VRGP3,VRG1,VRG2,VRGK1,VRGK2,XABS,PROD,
     & XELK,RMX,RMN,XKEF1,XKEF2,XKEF3,EXFC1,EXFC2,EXFC3, NI3,IEXTR,
     & IRECV,VRGABS,LO3,LO4,XLAMDA,EPI1,EPI2, BETTA,SAMXI,IX25,IX28,I,J,
     &  KB,K,ITMAX,ITIME, BET(MSX),DEL(MSX)
C
      DIMENSION P2(JVX,IVX,KVX), NRGN(JVX,IVX),DCONB(JVX,IVXP1,IOVX),
     & DCONR(JVXP1,IVZ,IOVZ),B2(MVX,KVX),SCAC(KVX,MVX,KVX),XL(6,KVX)
      DIMENSION PVOL(LVX),NCOMP(LVX)
C
C     INRB = 1  ORDINARY
C     INRB = 2  PERIODIC(REPEATING)
C     INRB = 3  90 DEGREE ROTATIONAL
C     INRB = 4  180 DEGREE ROTATIONAL
C
      INRB = IX(72) + 1
      N = IX(20)
  100 DO 138 I = 1,IMAX
      DO 137 J = 1,JMAX
      L = NRGN(J,I)
      M = NCOMP(L)
      IF (P2(J,I,K)) 103,101,103
  101 IF (XMIS(2).GE.0) GO TO 136
      TT5 = 0.0
      DO 102 KK = 1,KMAX
      TT5 = TT5 + SCAC(KK,M,K)*P2(J,I,KK)*PVOL(L)
  102 CONTINUE
      B2(M,K) = B2(M,K) + TT5
      GO TO 136
  103 IF (I-1) 107,107,104
  104 CONTINUE
      IF (NUAC(5).NE.10) GO TO 105
      IF (P2(J+1,I-1,K).NE.0.0) GO TO 107
      LT = NRGN(J+1,I-1)
      GO TO 106
  105 CONTINUE
      IF (P2(J,I-1,K).NE.0.0) GO TO 107
      LT = NRGN(J,I-1)
  106 CONTINUE
      MT = NCOMP(LT)
      B2(MT,K) = B2(MT,K) + P2(J,I,K)*DCONB(J,I,N)
  107 IF (I-IVX) 110,108,108
  108 IF (INRB.NE.3) GO TO 115
CBUG FIX FOR VPP 95/11/13
C     G = P2(JVX,J,K)
C     LB = NRGN(JVX,J)
C     IF (NUAC(5).NE.10) GO TO 109
C     IF ((J/2)*2.NE.J) GO TO 115
C     G = P2(JVX,J/2,K)
C     LB = NRGN(JVX,J/2)
      IF (NUAC(5).NE.10) THEN
       G = P2(JVX,J,K)
       LB = NRGN(JVX,J)
       ELSE
       IF ((J/2)*2.NE.J) GO TO 115
       G = P2(JVX,J/2,K)
       LB = NRGN(JVX,J/2)
      END IF
  109 CONTINUE
      IF (G.NE.0.0) GO TO 115
      MB = NCOMP(LB)
      T1 = DCONB(J,I+1,N)
      GO TO 113
  110 CONTINUE
      IF (NUAC(5).NE.10) GO TO 111
      IF (J.EQ.1) GO TO 115
      IF (P2(J-1,I+1,K).NE.0.0) GO TO 115
      LB = NRGN(J-1,I+1)
      T1 = DCONB(J-1,I+1,N)
      GO TO 112
  111 CONTINUE
      IF (P2(J,I+1,K).NE.0.0) GO TO 115
      LB = NRGN(J ,I+1)
      T1 = DCONB(J ,I+1,N)
  112 CONTINUE
      MB = NCOMP(LB)
  113 IF (T1-4096.0E-13) 114,115,114
  114 B2(MB,K) = B2(MB,K) + P2(J,I,K)*T1
  115 IF (J.LE.1) GO TO 116
      IF (P2(J-1,I,K).NE.0.0) GO TO 118
      LL = NRGN(J-1,I)
      ML = NCOMP(LL)
      GO TO 117
  116 IF (INRB.NE.2) GO TO 118
      IF (P2(JVX,I,K).NE.0.0) GO TO 118
      LL = NRGN(JVX,I)
      ML = NCOMP(LL)
  117 B2(ML,K) = B2(ML,K) + P2(J,I,K)*DCONR(J,I,N)
  118 IF (J.GE.JVX) GO TO 119
      IF (P2(J+1,I,K).NE.0.0) GO TO 126
      LR = NRGN(J+1,I)
      MR = NCOMP(LR)
      T1 = DCONR(J+1,I,N)
      GO TO 124
  119 GO TO (126,120,121,123),INRB
  120 CONTINUE
      IF (P2(1,I,K).NE.0.0) GO TO 126
      LR = NRGN(1,I)
      MR = NCOMP(LR)
      T1 = DCONR(J+1,I,N)
      GO TO 124
  121 CONTINUE
      G = P2(I,JVX,K)
      LR = NRGN(I,IVX)
      IF (NUAC(5).NE.10) GO TO 122
      G = P2(2*I,IVX,K)
      LR = NRGN(2*I,IVX)
  122 CONTINUE
      IF (G.NE.0.0) GO TO 126
      MR = NCOMP(LR)
      T1 = DCONR(J+1,I,N)
      GO TO 124
  123 CONTINUE
      IF (P2(JVX,IVXP1-I,K).NE.0.0) GO TO 126
      LR = NRGN(JVX,IVXP1-I)
      MR = NCOMP(LR)
      T1 = DCONR(J+1,I,N)
  124 IF (T1.EQ.4096.0E-13) GO TO 126
  125 B2(MR,K) = B2(MR,K) + P2(J,I,K)*T1
  126 IF (NUAC(5)-9) 136,127,136
  127 KKK=N+IOVX
      IF (I-1) 131,131,128
  128 IF (J-JMAX) 129,131,131
  129 IF (P2(J+1,I-1,K)) 131,130,131
  130 LB=NRGN(J+1,I-1)
      MB = NCOMP(LB)
      B2(MB,K) = B2(MB,K) + P2(J,I,K)*DCONR(J+1,I,KKK)
  131 IF (J-1) 135,135,132
  132 IF (I-IMAX) 133,135,135
  133 IF (P2(J-1,I+1,K)) 135,134,135
  134 LB=NRGN(J-1,I+1)
      MB = NCOMP(LB)
      B2(MB,K) = B2(MB,K) + P2(J,I,K)*DCONR(J,I+1,KKK)
  135 CONTINUE
  136 CONTINUE
  137 CONTINUE
  138 CONTINUE
  139 CONTINUE
      DO 140 M=1,MMAX
      XRDB = XRDB + B2(M,K)
  140 CONTINUE
  141 CONTINUE
      RETURN
      END
