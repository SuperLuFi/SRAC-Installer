CSRCH --042 ***CITATION*** READS INPUT SECTION 028/ CF-IPTM
C
      SUBROUTINE SRCH(CONC,MJJR,NVX,MVX,NSETVX)
C
CDEL  INTEGER RGX , MSX , ZNEX , ZDX , WZX
CDEL  PARAMETER ( RGX=100, MSX=211, ZDX=200, ZNEX=1000, WZX=100 )
      INCLUDE  'CITPMINC'
C
      COMMON/ALSUB/BLSUB(30),TITL1(18),TITL2(18),IMAX,JMAX,KBMAX,KMAX,
     & LMAX,MMAX, NMAX,IMXP1,JMXP1,KBMXP1,NSETMX,NTO,MM1VX,KM1VX,IOIN,
     & IOUT,IOSIG,IOFLX,IO1,IO2,IO3,IO4,IO7,NER(100), IX(200),INNO(100),
     &  NGC(24),IEDG(24),ITMX(24),TIMX(6), GLIM(6),NDPL(24),IEDP1(24),
     & IEDP2(24),IEDP3(24), DPLH(6),NUAC(24),EPI(6),XMIS(6),NSRH(24),
     & XSRH1(6), XTR1(WZX),XTR2(WZX),NXTR1(WZX),NXTR2(WZX),SPARE(200),
     & IXPUT(200),XPUT(200)
      COMMON/ABURN/BBURN(30),NSIG1(50),NSIG2(50),NSIG3(50),N1N2R(2,ZDX),
     &  NSIG4(50),NSIG5(50),NSIG6(50),NJM(50),NJMM(50),NJNQ(50),NCH(50),
     &  NZON(ZDX),NXSET(ZDX),NXODR(ZDX),IDXSET(ZDX),NCLASS(ZDX),NDP(ZDX)
     &  , XNAME(3,ZDX)
      COMMON/AMESH/BMESH(30),NREGI,NREGJ,NREGKB,XSHI(RGX),XSHJ(RGX),
     & XSHKB(RGX), MSHI(RGX),MSHJ(RGX),MSHKB(RGX),Y(MSX),YY(MSX), X(MSX)
     &  ,XX(MSX),Z(MSX),ZZ(MSX), ZONVOL(ZNEX),AVZPD(ZNEX),PDI(MSX),
     & PDJ(MSX) , PDK(MSX)
C
      DIMENSION CONC(NVX,MVX),MJJR(200,NSETVX)
      DIMENSION XTR3(WZX)
C
      EQUIVALENCE (NXTR1(1),XTR3(1))
C
      WRITE(IOUT,1006)
      KKKK = 0
      IO17 = IX(84)
      IO10 = IX(77)
      REWIND IO10
  100 READ(IO10,END=101)
      GO TO 100
  101 BACKSPACE IO10
      REWIND IO3
      XDUM = 0.0
      IDUM = 0
      NREC = 0
      IN = 0
  102 READ(IOIN,1007) (NSRH(I),I=1,24)
      IF (NSRH(1).EQ.0) GO TO 128
      READ(IOIN,1008) (XSRH1(I),I=1,6)
      IN = IN + 1
      IF (XSRH1(1).EQ.0.0) XSRH1(1) = 1.0
      IF (XSRH1(2).EQ.0.0) XSRH1(2) = 1.0
      IF ((NSRH(4).GT.0).AND.(NSRH(9).GT.0)) NER(17) = 17
      IF ((NSRH(2).EQ.3).AND.(NSRH(10).EQ.(-1))) NER(17) = 17
      WRITE(IOUT,1009) (NSRH(I),I=1,24),(XSRH1(I),I=1,6)
      WRITE(IO3) (NSRH(I),I=1,24),(XSRH1(I),I=1,6)
      NREC = NREC + 1
      IF (NSRH(2).EQ.3) GO TO 120
      IF (NSRH(10).NE.(-1)) GO TO 102
C*********GOODIES GO HERE*************
      IF (KKKK.GT.0) GO TO 103
      KKKK = 1
      REWIND IO17
      WRITE(IO17) ((CONC(N,M),N=1,NMAX),M=1,MMAX)
      REWIND IO17
  103 CONTINUE
      DO 104 M=1,MMAX
      DO 104 N=1,NMAX
      CONC(N,M) = 0.0
  104 CONTINUE
      WRITE(IOUT,1000)
      NXN = 1
      NXM = 1
      NXS = 1
      CON = 0.0
  105 READ(IOIN,1007) MF,ML,N1,N2
      IF (MF.EQ.0) GO TO 114
      IF (ML.LT.MF) ML = MF
      WRITE(IOUT,1001) MF,ML
      IT = 0
      I2 = 0
  106 I1 = I2 + 1
      I2 = I1 + 5
      READ(IOIN,1002) (NXTR1(I),XTR1(I),I=I1,I2)
      DO 107 I=I1,I2
      IF (NXTR1(I).EQ.0) GO TO 108
      IT = IT + 1
  107 CONTINUE
      GO TO 106
  108 CONTINUE
      WRITE(IOUT,1003) (NXTR1(I),XTR1(I),I=1,IT)
      DO 113 M=MF,ML
      NS = NXSET(M)
      NR = NXODR(NS)
      NSX = NSIG2(NR)
      IF (IT.GT.NSX) NER(40) = 40
      DO 112 N=1,IT
      NRL = NXTR1(N)
      IF (NRL.LE.0.OR.NRL.GT.200) GO TO 109
      IF (MJJR(NRL,NR).NE.0) GO TO 110
  109 CONTINUE
      WRITE(IOUT,1004) NRL,NS
      NER(41) = 41
      NRL = 1
  110 CONTINUE
      NDOR = MJJR(NRL,NR)
      CONC(NDOR,M) = XTR1(N)
      IF (CONC(NDOR,M).LE.CON) GO TO 111
      CON = CONC(NDOR,M)
      NXN = NDOR
      NXM = M
      NXS = NR
  111 CONTINUE
  112 CONTINUE
  113 CONTINUE
      GO TO 105
  114 CONTINUE
      NXZ = 0
      DO 117 M=1,MMAX
      DO 115 N=1,NMAX
      IF (CONC(N,M).NE.0.0) GO TO 116
  115 CONTINUE
      GO TO 117
  116 NXZ = NXZ + 1
      NXTR1(NXZ) = M
  117 CONTINUE
      IF (NXZ.GT.0) GO TO 118
      WRITE(IOUT,1005) NXZ
      STOP
  118 CONTINUE
      WRITE(IO3) NXZ,NXN,NXM,NXS,IDUM,CON,XDUM,XDUM,XDUM,XDUM
      WRITE(IO3) (NXTR1(I),I=1,NXZ)
      DO 119 I=1,NXZ
      M = NXTR1(I)
      WRITE(IO3) (CONC(N,M),N=1,NMAX)
  119 CONTINUE
      NREC = NREC + NXZ + 2
      GO TO 102
  120 CONTINUE
      DO 121 L=1,100
      XTR1(L) = 0.0
      XTR2(L) = 0.0
      XTR3(L) = 0.0
  121 CONTINUE
      INDX = 1
      INGX = 1
      XMX = 0.0
      WRITE(IOUT,1015)
      READ(IOIN,1010) NXJ,NXI,NXKB
      NREC = NREC + 1
      IF (NXJ.LE.0) GO TO 123
      READ(IOIN,1011) (XTR1(J),J=1,NXJ)
      WRITE(IOUT,1012) (XTR1(J),J=1,NXJ)
      NREC = NREC + 1
      DO 122 J=1,NXJ
      XTR1(J) = XTR1(J)*XSHJ(J)
      IF (XTR1(J).LE.XMX) GO TO 122
      XMX = XTR1(J)
      INGX = 1
      INDX = J
  122 CONTINUE
  123 IF (NXI.LE.0) GO TO 125
      READ(IOIN,1011) (XTR2(I),I=1,NXI)
      WRITE(IOUT,1013) (XTR2(I),I=1,NXI)
      NREC = NREC + 1
      DO 124 I=1,NXI
      XTR2(I) = XTR2(I)*XSHI(I)
      IF (XTR2(I).LE.XMX) GO TO 124
      XMX = XTR2(I)
      INGX = 2
      INDX = I
  124 CONTINUE
  125 IF (NXKB.LE.0) GO TO 127
      READ(IOIN,1011) (XTR3(KB),KB=1,NXKB)
      WRITE(IOUT,1014) (XTR3(KB),KB=1,NXKB)
      NREC = NREC + 1
      DO 126 KB=1,NXKB
      XTR3(KB) = XTR3(KB)*XSHKB(KB)
      IF (XTR3(KB).LE.XMX) GO TO 126
      XMX = XTR3(KB)
      INGX = 3
      INDX = KB
  126 CONTINUE
  127 CONTINUE
      WRITE(IO3) NXJ,NXI,NXKB,INDX,INGX,IDUM,IDUM,XMX,XDUM,XDUM, XDUM,
     & XDUM
      IF (NXJ.GT.0) WRITE(IO3) (XTR1(J),J=1,NXJ)
      IF (NXI.GT.0) WRITE(IO3) (XTR2(I),I=1,NXI)
      IF (NXKB.GT.0) WRITE(IO3) (XTR3(KB),KB=1,NXKB)
      GO TO 102
  128 REWIND IO3
      INN = 28
      WRITE(IO10) INN,NREC,IN,NMAX,IDUM
      IF (IN.EQ.0) GO TO 134
      DO 133 IM=1,IN
      READ(IO3) (NSRH(I),I=1,24),(XSRH1(I),I=1,6)
      WRITE(IO10) (NSRH(I),I=1,24),(XSRH1(I),I=1,6)
      IF (NSRH(2).EQ.3) GO TO 130
      IF (NSRH(10).NE.(-1)) GO TO 133
C*********GOODIES GO HERE*************
      READ(IO3) (NXTR1(I),I=1,5),(XTR1(I),I=1,5)
      WRITE(IO10) (NXTR1(I),I=1,5),(XTR1(I),I=1,5)
      NXZ = NXTR1(1)
      READ(IO3) (NXTR1(I),I=1,NXZ)
      WRITE(IO10) (NXTR1(I),I=1,NXZ)
      DO 129 I=1,NXZ
      READ(IO3) (XTR1(N),N=1,NMAX)
      WRITE(IO10) (XTR1(N),N=1,NMAX)
  129 CONTINUE
      GO TO 133
  130 CONTINUE
      READ(IO3) (NXTR1(I),I=1,7),(XTR1(I),I=1,5)
      WRITE(IO10) (NXTR1(I),I=1,7),(XTR1(I),I=1,5)
      NXJ = NXTR1(1)
      NXI = NXTR1(2)
      NXKB = NXTR1(3)
      IF (NXJ.LE.0) GO TO 131
      READ(IO3) (XTR1(I),I=1,NXJ)
      WRITE(IO10) (XTR1(I),I=1,NXJ)
  131 IF (NXI.LE.0) GO TO 132
      READ(IO3) (XTR1(I),I=1,NXI)
      WRITE(IO10) (XTR1(I),I=1,NXI)
  132 IF (NXKB.LE.0) GO TO 133
      READ(IO3) (XTR1(I),I=1,NXKB)
      WRITE(IO10) (XTR1(I),I=1,NXKB)
  133 CONTINUE
  134 END FILE IO10
      REWIND IO10
      IF (KKKK.LE.0) GO TO 135
      READ(IO17) ((CONC(N,M),N=1,NMAX),M=1,MMAX)
      REWIND IO17
  135 CONTINUE
      RETURN
 1000 FORMAT(1H0,'RELATIVE CONCENTRATION CHANGES FOR NUCLIDE SEARCH')
 1001 FORMAT(1H0,'ZONES',I4,' TO',I4)
 1002 FORMAT(6(I3,E9.0))
 1003 FORMAT(1X,I6,1PE13.5,I6,E13.5,I6,E13.5,I6,E13.5,I6,E13.5,I6,E13.5)
 1004 FORMAT(1H0,'NUCLIDE',I4,'  IS NOT IN CROSS SECTION SET',I3)
 1005 FORMAT(1H1,'****NUMBER OF SEARCH ZONES IS .LE. ZERO****',I10)
 1006 FORMAT(1H0,'SEARCH INPUT DATA - SECTION 028')
 1007 FORMAT(24I3)
 1008 FORMAT(6E12.0)
 1009 FORMAT(1H ,24I4/1H ,1P6E13.5)
 1010 FORMAT(24I3)
 1011 FORMAT(6E12.0)
 1012 FORMAT(1H0,'LEFT TO RIGHT',1P8E12.5/(1H ,13X,1P8E12.5))
 1013 FORMAT(1H0,'TOP TO BOTTOM',1P8E12.5/(1H ,13X,1P8E12.5))
 1014 FORMAT(1H0,'FRONT TO BACK',1P8E12.5/(1H ,13X,1P8E12.5))
 1015 FORMAT(1H0,'RELATIVE CHANGES FOR DIMENSION SEARCH')
      END
