CKEGN --118 ***CITATION*** INITILIZE 3-D FLUX CALC/ CF-KLUX
C
      SUBROUTINE KEGN(XL,P2E,E1,XLAMDA,IVX,JVX,KBVX,KVX,LVX,JIVX)
C
CDEL  INTEGER RGX , MSX , ZNEX , ZDX , WZX
CDEL  PARAMETER ( RGX=100, MSX=211, ZDX=200, ZNEX=1000, WZX=100 )
      INCLUDE  'CITPMINC'
C
      REAL*8 XLAMDA
C
      COMMON/ALSUB/BLSUB(30),TITL1(18),TITL2(18),IMAX,JMAX,KBMAX,KMAX,
     & LMAX,MMAX, NMAX,IMXP1,JMXP1,KBMXP1,NSETMX,NTO,MM1VX,KM1VX,IOIN,
     & IOUT,IOSIG,IOFLX,IO1,IO2,IO3,IO4,IO7,NER(100), IX(200),INNO(100),
     &  NGC(24),IEDG(24),ITMX(24),TIMX(6), GLIM(6),NDPL(24),IEDP1(24),
     & IEDP2(24),IEDP3(24), DPLH(6),NUAC(24),EPI(6),XMIS(6),NSRH(24),
     & XSRH1(6), XTR1(WZX),XTR2(WZX),NXTR1(WZX),NXTR2(WZX),SPARE(200),
     & IXPUT(200),XPUT(200)
      COMMON/AFLUX/BFLUX(30),KXMN8,NIT,NIIT,NIIIT,JXP1,KSCT1,KSCT2,
     & ISTART,IEP, VRGP1,VRGP2,VRGP3,VRG1,VRG2,VRGK1,VRGK2,XABS,PROD,
     & XLEK,RMX,RMN,XKEF1,XKEF2,XKEF3,EXFC1,EXFC2,EXFC3, NI3,IEXTR,
     & IRECV,VRGABS,LO3,LO4,XLAMDB,EPI1,EPI2, BETTA,SUMXI,IX25,IX28,I,J,
     &  KB,K,ITMAX,ITIME, BET(MSX),DEL(MSX)
C
      DIMENSION XL(6,KVX)
      DIMENSION P2E(JIVX,KBVX,KVX),E1(LVX,KVX)
C
      NOIR = NUAC(23)
      NTITE = IX(198)
      IF (IX(172).GT.0) GO TO 101
      IF (NTITE.NE.0) GO TO 100
      IF ((NGC(2).NE.0).AND.(NUAC(2).EQ.0)) GO TO 101
  100 CONTINUE
      VRGK2 = BETTA
      SPARE(39) = BETTA
  101 CONTINUE
      DO 103 K = 1,KMAX
      DO 102 L=1,LMAX
      E1(L,K) = 0.0
  102 CONTINUE
  103 CONTINUE
      DO 107 K = 1,KMAX
      DO 106 KB = 1,KBMAX
      N1= 0
      DO 105 I = 1,IMAX
      DO 104 J = 1,JMAX
      N1= N1 + 1
      IF (P2E(N1,KB,K).EQ.0.0) GO TO 104
      IX(10) = I
      IX(11) =J
      IX(12) = KB
      IX(13) = K
      GO TO 108
  104 CONTINUE
  105 CONTINUE
  106 CONTINUE
  107 CONTINUE
  108 CONTINUE
      VRGK1 = 1.0
      IF (IX(24).EQ.0) GO TO 109
      WRITE(IOUT,1007)
      IF (NUAC(3).EQ.0) VRGK1 = 0.0
      GO TO 139
  109 CONTINUE
      XLAMDA = XLAMDB
      IF (IX(172).GT.0) GO TO 111
      IF (NTITE.NE.0) GO TO 110
      IF (NGC(2).NE.0.AND.NUAC(2).EQ.0) GO TO 111
  110 CONTINUE
      XLAMDA = 1.0
  111 CONTINUE
      IF (IX(5).GE.2) XLAMDA = 1.0/XSRH1(1)
C
C***************************SEARCH OPTIONS******************************
      IF (IX(5).EQ.(-5)) GO TO 126
      IF ((IX(5).EQ.0).OR.(IX(5).GE.2)) GO TO 126
      IF (IX(172).GT.0) GO TO 113
      IF (NTITE.NE.0) GO TO 112
      IF ((NGC(2).NE.0).AND.(NUAC(2).EQ.0)) GO TO 113
  112 CONTINUE
      XLAMDA = 1.0
      XKEF1 = 1.0
      SPARE(45) = 1.0
      SPARE(46) = 0.1
      IF ((IX(5).EQ.-1).OR.(IX(5).EQ.1)) XLAMDA = 0.0
  113 CONTINUE
      IF ((NGC(1).GT.0).AND.(IX(2).GT.1)) GO TO 122
      WRITE(IOUT,1005)(TITL1(I),I=1,18)
      WRITE(IOUT,1006) (TITL2(I),I=1,18)
      IF (NGC(1).EQ.0) GO TO 117
      IF (IX(2).GT.0) GO TO 114
      WRITE(IOUT,1000)IX(3),SPARE(12)
      GO TO 117
  114 CONTINUE
      IF (IX(99).EQ.0) GO TO 115
      WRITE(IOUT,1001)IX(3),SPARE(12)
      GO TO 116
  115 CONTINUE
      WRITE(IOUT,1013)IX(3),SPARE(2),SPARE(12)
  116 CONTINUE
  117 CONTINUE
      IF (NUAC(5).EQ.13) GO TO 118
      IF (NUAC(20)+1) 120,119,118
  118 WRITE(IOUT,1008) NOIR
      GO TO 121
  119 WRITE(IOUT,1010) NOIR
      GO TO 121
  120 WRITE(IOUT,1009) NOIR
  121 CONTINUE
      WRITE(IOUT,1004)SPARE(51),SPARE(57)
      GO TO 125
  122 CONTINUE
      IF (IX(99).EQ.0) GO TO 123
      WRITE(IOUT,1001)IX(3),SPARE(12)
      GO TO 124
  123 CONTINUE
      WRITE(IOUT,1013)IX(3),SPARE(2),SPARE(12)
  124 CONTINUE
  125 WRITE(IOUT,1011)
      GO TO 141
  126 CONTINUE
      IF (IX(172).GT.0) GO TO 128
      IF (NTITE.NE.0) GO TO 127
      IF ((NGC(2).NE.0).AND.(NUAC(2).EQ.0)) GO TO 128
  127 CONTINUE
      XKEF1 = 1.0
      IF (XLAMDA.NE.0.0) XKEF1 = 1.0/XLAMDA
  128 CONTINUE
      IF ((NGC(1).GT.0).AND.(IX(2).GT.1)) GO TO 136
      WRITE(IOUT,1005)(TITL1(I),I=1,18)
      WRITE(IOUT,1006) (TITL2(I),I=1,18)
      IF (NGC(1).EQ.0) GO TO 132
      IF (IX(2).GT.0) GO TO 129
      WRITE(IOUT,1000) IX(3),SPARE(12)
      GO TO 132
  129 CONTINUE
      IF (IX(99).EQ.0) GO TO 130
      WRITE(IOUT,1001)IX(3),SPARE(12)
      GO TO 131
  130 CONTINUE
      WRITE(IOUT,1013)IX(3),SPARE(2),SPARE(12)
  131 CONTINUE
  132 CONTINUE
      IF (IX(5).EQ.(-5)) WRITE(IOUT,1002)
      IF (NUAC(5).EQ.13) GO TO 133
      IF (NUAC(20)+1) 135,134,133
  133 WRITE(IOUT,1008) NOIR
      GO TO 139
  134 WRITE(IOUT,1010) NOIR
      GO TO 139
  135 WRITE(IOUT,1009) NOIR
      GO TO 139
  136 CONTINUE
      IF (IX(99).EQ.0) GO TO 137
      WRITE(IOUT,1001)IX(3),SPARE(12)
      GO TO 138
  137 CONTINUE
      WRITE(IOUT,1013)IX(3),SPARE(2),SPARE(12)
  138 CONTINUE
  139 CONTINUE
      IF (IX(5).EQ.(-5)) GO TO 140
      WRITE(IOUT,1012)
      GO TO 141
  140 WRITE(IOUT,1003)
      XLAMDA = 1.0
      XKEF1 = 1.0
      SPARE(46) = 0.1
  141 CONTINUE
      IF (NTITE.NE.0) GO TO 142
      IX(196) = 0
      IF ((NGC(2).NE.0).AND.(NUAC(2).EQ.0)) IX(196) = 1
      IF ((NGC(2).NE.0).AND.(NUAC(2).EQ.0)) GO TO 143
  142 CONTINUE
      KXMN8 = KMAX-IX(29)
      KXMN8 = MAX0(KXMN8,1)
      IEP = 1
      JXP1 = JMAX+1
      IX25 = IX(25)
      IX28 = IX(28)
      NIT = 0
      IEXR = 0
      IRECV = 0
      NIIT = 0
      NIIIT = 0
      LO3 = 0
      LO4 = 0
      VRG1 = 1.0
      VRGP1 = 1.0
      XKEF2 = 2.0
  143 CONTINUE
      IF (IX(5).EQ.(-5)) XKEF2 = 1.0
      IF (IX(24).NE.0) GO TO 146
      DO 145 K = 1,KMAX
      DO 144 N = 1,6
      XL(N,K) = 0.0
  144 CONTINUE
  145 CONTINUE
  146 CONTINUE
      RETURN
 1000 FORMAT('0AN INITILIZATION FLUX - EIGENVALUE PROBLEM FOLLOWS FOR ',
     &'CYCLE',I3,'  TOTAL DEPLETION TIME',F8.2,' DAYS'//)
 1001 FORMAT('0A FINAL FLUX - EIGENVALUE PROBLEM FOLLOWS FOR CYCLE',I3,
     &  '  TOTAL DEPLETION TIME',F11.3,' DAYS')
 1002 FORMAT(1H0,'A FIXED SOURCE PROBLEM FOLLOWS')
 1003 FORMAT(1H ,'ITERATION  FLUX CHANGE',4X,'BETA',6X,'MU-1',6X,'MU-2',
     &  6X,'MU-3',4X,'DRIVE FACTOR',7X,'BALANCE')
 1004 FORMAT(' LIMITING VALUES OF THE SEARCH FACTOR FOR ABSORPTION AND',
     &' TOTAL LOSS ARE',1P2E13.5)
 1005 FORMAT(1H1,18A4)
 1006 FORMAT(1H ,18A4)
 1007 FORMAT(1H0,'ADJOINT PROBLEM FOLLOWS')
 1008 FORMAT(1H ,'LINE RELAXATION WILL BE DONE ON ROWS - ',I3,
     & ' INNER ITERATION(S)')
 1009 FORMAT(1H ,'LINE RELAXATION WILL BE DONE ON ROWS AND COLUMNS - ',
     & I3,' INNER ITERATION(S)')
 1010 FORMAT(1H ,'LINE RELAXATION WILL BE DONE ON ROWS,COLUMNS,AND PLANE
     &S - ',I3,' INNER ITERATION(S)')
 1011 FORMAT(' ITERATION  FLUX CHANGE    BETA      MU-1      MU-2     ',
     &' MU-3            K     SEARCH FACTOR')
 1012 FORMAT(' ITERATION  FLUX CHANGE    BETA      MU-1      MU-2     ',
     &' MU-3            K')
 1013 FORMAT(1H0,'A FLUX - EIGENVALUE PROBLEM FOLLOWS FOR CYCLE',I3,
     & ' CYCLE TIME',0PF11.4,' DAYS   TOTAL TIME',F11.4,' DAYS'//)
      END
