CCALR --005 ***CITATION*** ENTIRE PROBLEM CONTROL/ CF-INPT
C
      SUBROUTINE CALR(A,RATE,NTITE,NDX,MDX,IX3738,MVZ,PF,ISIZ)
C
CDEL  INTEGER RGX , MSX , ZNEX , ZDX , WZX
CDEL  PARAMETER ( RGX=100, MSX=211, ZDX=200, ZNEX=1000, WZX=100 )
      INCLUDE  'CITPMINC'
C
      REAL*8 FLOTR
C
      COMMON/ALSUB/BLSUB(30),TITL1(18),TITL2(18),IMAX,JMAX,KBMAX,KMAX,
     & LMAX,MMAX, NMAX,IMXP1,JMXP1,KBMXP1,NSETMX,NTO,MM1VX,KM1VX,IOIN,
     & IOUT,IOSIG,IOFLX,IO1,IO2,IO3,IO4,IO7,NER(100), IX(200),INNO(100),
     &  NGC(24),IEDG(24),ITMX(24),TIMX(6), GLIM(6),NDPL(24),IEDP1(24),
     & IEDP2(24),IEDP3(24), DPLH(6),NUAC(24),EPI(6),XMIS(6),NSRH(24),
     & XSRH1(6), XTR1(WZX),XTR2(WZX),NXTR1(WZX),NXTR2(WZX),SPARE(200),
     & IXPUT(200),XPUT(200)
      COMMON/AMESH/BMESH(30),NREGI,NREGJ,NREGKB,XSHI(RGX),XSHJ(RGX),
     & XSHKB(RGX), MSHI(RGX),MSHJ(RGX),MSHKB(RGX),Y(MSX),YY(MSX), X(MSX)
     &  ,XX(MSX),Z(MSX),ZZ(MSX), ZONVOL(ZNEX),AVZPD(ZNEX),PDI(MSX),
     & PDJ(MSX) , PDK(MSX)
      COMMON/AFLUX/BFLUX(30),KXMN8,NIT,NIIT,NIIIT,JXP1,KSCT1,KSCT2,
     & ISTART,IEP, VRGP1,VRGP2,VRGP3,VRG1,VRG2,VRGK1,VRGK2,XABS,PROD,
     & XLEK,RMX,RMN,XKEF1,XKEF2,XKEF3,EXFC1,EXFC2,EXFC3, NI3,IEXTR,
     & IRECV,VRGABS,LO3,LO4,XLAMDA,EPI1,EPI2, BETTA,SUMXI,IX25,IX28,I,J,
     &  KB,K,ITMAX,ITIME, BET(MSX),DEL(MSX)
      COMMON/ABURN/BBURN(30),NSIG1(50),NSIG2(50),NSIG3(50),N1N2R(2,ZDX),
     &  NSIG4(50),NSIG5(50),NSIG6(50),NJM(50),NJMM(50),NJNQ(50),NCH(50),
     &  NZON(ZDX),NXSET(ZDX),NXODR(ZDX),IDXSET(ZDX),NCLASS(ZDX),NDP(ZDX)
     &  , XNAME(3,ZDX)
      COMMON/AKADD/KAY(1),K1,K2,K3,K4,K5,K6,K7,K8,K9,K10,K11, K12,K13,
     & K131,K14,K15,K16,K17,K18,K19,K20,K21,K22,K23,K24, K25,K26,K27,
     & K28,K29,K30,K31,K32,K33,K34,K35,K36,K37, K38,K39,K40,K41,K42,K43,
     &  K44,K45,K46,K47,K48,K49, K50,K51,K52,K53,K54,K55,K56,K57,K58,
     & K59, K60,K61,K62, K63,K64,K65,K66,K67,K68,K69,K70,K71,K72,K73,
     & K74,K75, K76,K77,K78,K79,K80,K81,K82,K83,K84,K85,K86,K87, K88,
     & K89,K90, K91,K92,K93,K94,K95,K96,K97,K98, K99,K100,NDATA,KNRGN,
     & KNCOMP, KPVOL,KRVOL,MEMVRY, MEMX
      COMMON/AVDLM/IVDLM(1),IVX,JVX,KBVX,KVX,LVX,MVX,NVX,IVXP1,JVXP1,
     & KBVXP1,NSETVX,NVO,IVO,IVZ,KVZ,NCRP,NSPA,N3DDIM,NBLOCK, JIVX,
     & JIP1VX,JP1IXZ,IOVX,IOVZ
      COMMON/CMARY/MEMARY,IMN,MNI,IJLMN,NMLJI,IY(50),BX(50),TITL(36)
      COMMON/COOPD/FLOTR(200),INTGR(100)
      COMMON/AMISS/ITMIS(20),AITMIS(20)
C
      DIMENSION A(1),RATE(NDX,MDX,10)
      DIMENSION PF(ISIZ)
C
CI EIGN VALUE CALCULATION BYPASS FOR SPETIAL CASE
C     IF (NGC(13).LT.0) GO TO 1109
      MEMORY=MEMVRY
      IX(172) = 0
      IX172 = 0
      IO19 = IX(86)
      KK1 = K19+NVX*MVX*10
      KK2 = K61+NVO
      KL1 = KK1-K23
      KL2 = KK2-K23
      KL3 = MAX0(KL1,KL2)
      KL4 = MAX0(KK1,KK2)
      DO 100 N = 1,20
      ITMIS(N) = 0
      AITMIS(N) = 0.0
  100 CONTINUE
C
C     IF(NTITE.EQ.1) RESTART OR CONTINUE SOME CYCLE.
C     IF(NTITE.EQ.0) NORESTART OR RESTART STATICS PROBLEM.
C     IF(NTITE.EQ.-1) RESTART DEPLETION ONLY OR CONT. FIRST CYCLE.
C
      IO13 = IX(80)
      NCCYL = 999
      IF ((NGC(3).GT.0).AND.(NTITE.EQ.0)) CALL WSTR(NCCYL,A,MEMORY)
      NRCYC = 1
      NCYCLE = 1
      MAC4 = 1
      IF (NDPL(1).NE.0) NCYCLE = NDPL(1)
C
      INNOO = 1
      IF ((INNO(91).EQ.0).OR.(INNO(93).EQ.0)) INNOO = 0
      IF (INNOO.EQ.0) GO TO 102
C*****WRITE FIXED FUEL MANAGEMENT INTERFACE DATA
      IF (NGC(1).LE.0) GO TO 102
      IX(171) = INTGR(29)
      IF (IX(171).LE.0) GO TO 101
      IO33 = IX(139)
      IO34 = IX(140)
      IOOR = IO33
      IOOW = IO34
      REWIND IOOR
      REWIND IOOW
  101 CONTINUE
      IO23 = IX(90)
      CALL WFCC(A,MEMORY, IO23)
      ITMIS(1) = 0
      MAC2 = INTGR(22)
      IF (MAC2.GT.0) NCYCLE = MAC2
      IF (INTGR(24).GT.0) MAC4 = INTGR(24)
      IF (INTGR(35).LE.0) GO TO 102
      NRCYC = INTGR(35)+1
  102 CONTINUE
      I11 = ICLOCK(0)
      NCY = 1
      IQUE = 1
      NRC = 1
      NNST = NGC(2)
      IF (NGC(2).EQ.0) GO TO 103
      INTGR(51) = 0
      NCY = IABS(IX(19))
      IF (INNOO.GT.0) IQUE = INTGR(19)
      IF (INNOO.GT.0) NRC = INTGR(46)
      IF (NTITE.LE.0) GO TO 103
      IF (NGC(2).LT.0) GO TO 103
      GO TO 161
  103 CONTINUE
C**********************START EQUILIBRIUM LOOP***************************
COMENTDO 174 IQUE = 1,MAC4
  104 CONTINUE
C*********************START DEPLETION CYCLE LOOP************************
COMENTDO 168 NCY = 1,NCYCLE
  105 CONTINUE
      IF (NDPL(12).EQ.0) GO TO 106
      IF (NCY.EQ.1) GO TO 106
      NRSET1 = 1
      NRSET2 = 0
      CALL RSET(NRSET1,NRSET2,NCY,A(K12),A(K1),A(K2),A(K3),A(K4),A(K5),
     & A(K6),KVX,NVX,NSETVX,A(K9))
  106 CONTINUE
      ICUP1 = ICLOCK(0)
      IRAL1 = ITTIME(0)
      IX(16) = 0
      IX(99) = 0
      LSTEP = 0
      IX(3) = NCY
      I21 = ICLOCK(0)
      U1 = SPARE(1)
      U2 = SPARE(2)
      U9 = SPARE(9)
      U10 = SPARE(10)
      U11 = SPARE(11)
      U12 = SPARE(12)
      U13 = SPARE(13)
      U26 = SPARE(26)
      U74 = SPARE(74)
      U75 = SPARE(75)
C
C*********************START REPEAT CYCLE LOOP***************************
COMENTDO 164 NRC = 1,NRCYC
  107 CONTINUE
      IF (NDPL(12).EQ.0) GO TO 108
      IF (NRCYC.EQ.1) GO TO 108
      IF (NRC.EQ.1) GO TO 108
      NRSET1 = 2
      NRSET2 = 0
      CALL RSET(NRSET1,NRSET2,NCY,A(K12),A(K1),A(K2),A(K3),A(K4),A(K5),
     & A(K6),KVX,NVX,NSETVX,A(K9))
  108 CONTINUE
      FLOTR(29) = 10000.0
      FLOTR(30) = 10000.0
      IF (NGC(1).EQ.0) GO TO 109
      IF (NGC(2).EQ.0) GO TO 109
      IF (NTITE.LT.0) GO TO 123
      IF ((NGC(2).LT.0).AND.(NTITE.EQ.1)) GO TO 123
  109 CONTINUE
      IX(14) = 0
      IX(8) = NRC
      IND1 = 0
      CALL HOWE(NCY,IND1,IND2,IHW,ITX,ITM)
CI EIGN VALUE CALCULATION BYPASS FOR SPETIAL CASE
      IF (NGC(13).LT.0) GO TO 111
      N1C1S = 0
      IF (IND2.EQ.0) GO TO 123
      N1C1S = 1
      IX(5) = IHW
      ITMAX = ITX
      ITIME = ITM
      IX(75) = 0
      IX(73) = 0
      IGO = 1
      IX(71) = 0
      NDO = 1
      NDOUBL = 1
      IF (IX(5).GT.1) NDOUBL = NSRH(3)
C
C*********************START INITIAL REACTIVITY LOOP*********************
      IX(127) = ICLOCK(0)
COMENTDO 117 NDO = 1,NDOUBL
  110 CONTINUE
      IX(73) = IX(73) + 1
  111 CONTINUE
      CALL EIGN (A,A(K24),A(K24),NTITE,IVX,JVX,KVX,JIVX,KBVX,IX3738)
CI EIGN VALUE CALCULATION BYPASS FOR SPETIAL CASE
      IF (NGC(13).LT.0) GO TO 120
      IX(198) = 1
      NTITE = 0
      IX(16) = 1
      GO TO (112,119),IGO
  112 CONTINUE
      IDJ = 0
      IF (IX(75).EQ.1) GO TO 117
      IF (IX(70).EQ.0) GO TO 116
      IF (IX(70).LT.0) GO TO 113
      WRITE(IOUT,1005)
      GO TO 114
  113 WRITE(IOUT,1012)
  114 CONTINUE
      IF (NGC(15).EQ.0) GO TO 117
      IF (NGC(15).EQ.2) GO TO 115
      IF (IX(126).EQ.0) GO TO 117
  115 WRITE(IOUT,1006)
      WRITE(IOUT,2000)
      STOP
  116 CONTINUE
      NDO = NDO+1
      IF (NDO.LE.NDOUBL) GO TO 110
  117 CONTINUE
      T1 = 1.0/SPARE(18)
      IF ((INTGR(35).GT.0).AND.(INTGR(36).EQ.3)) GO TO 118
      IF ((T1.GT.GLIM(1)).OR.(T1.LT.GLIM(2))) GO TO 178
      IF (IX(5).LE.0) GO TO 118
      IF (SPARE(58).GT.GLIM(3)) GO TO 178
  118 CONTINUE
      IF (IX(23).EQ.0) GO TO 119
      IX(24) = 1
      IDJ = 1
      IF (IX(37).GT.0) IX(71) = 1
      IGO = 2
      GO TO 111
  119 CONTINUE
      IF ((KL1.LE.0).OR.(IDJ.GT.0)) GO TO 120
      REWIND IO19
      WRITE(IO19)(A(I),I=K23,KK1)
      END FILE IO19
      REWIND IO19
  120 CONTINUE
      IX(71) = 0
      INDTOR = 0
      CALL OUTC (A,A(K17),A(K40),A(K38),A(K14),A(K19),A(K52),A(K16),
     & A(K48),A(K23),NVX,MVX,KVX,IX3738,INDTOR,MVZ,A(K39))
CI EIGN VALUE CALCULATION BYPASS FOR SPETIAL CASE
      IF (NGC(13).LT.0) GO TO 177
      IF ((KL1.LE.0).OR.(IDJ.GT.0)) GO TO 121
      READ(IO19)(A(I),I=K23,KK1)
      REWIND IO19
  121 CONTINUE
      NCCYL = 0
      IF ((NGC(1).EQ.0).AND.(NGC(3).GT.0)) CALLWSTR(NCCYL,A,MEMORY)
C**** STATICS BYPASS
      IF (NGC(1).EQ.0) GO TO 177
      IF (NCY.GT.1) GO TO 122
      IF ((NGC(3).GT.0).AND.(NGC(2).EQ.0)) CALLWSTR(NCCYL,A,MEMORY)
  122 CONTINUE
      NGC(2) = 0
  123 CONTINUE
  124 CONTINUE
      IF (INNOO.EQ.0) GO TO 125
C*****WRITE START OF CYCLE CONCENTRATIONS ON IO24
      IO24 = IX(91)
      IO12 = IX(79)
      REWIND IO24
      IXND = 0
      CALL WNSS (A(K17),A(K18),A(K44),MVX,NVX,IVO,IO12,IO24,IXND)
      REWIND IO12
  125 CONTINUE
      IF (NCY-2) 126,127,128
  126 NSTEP = NDPL(2)
      GO TO 129
  127 NSTEP = NDPL(3)
      GO TO 129
  128 NSTEP = NDPL(4)
  129 CONTINUE
      NSTEP = MAX0(1,NSTEP)
C
C*********************START DEPLETION TIME STEP LOOP********************
COMENTDO 157 NST = 1,NSTEP
      NST = 1
      IF (NNST.LT.0) NST = IX(2)
      NNST = 0
  130 CONTINUE
      IF (NDPL(12).EQ.0) GO TO 131
      IF (LSTEP.GT.0) GO TO 131
      NRSET1 = 3
      NRSET2 = NST
      CALL RSET(NRSET1,NRSET2,NCY,A(K12),A(K1),A(K2),A(K3),A(K4),A(K5),
     & A(K6),KVX,NVX,NSETVX,A(K9))
  131 CONTINUE
      IF (IX(172).EQ.0) GO TO 133
      READ(IOOR,END=132)PF,XLAMDA,BETTA,SPARE(45),SPARE(46)
      GO TO 133
  132 CONTINUE
      IX(172) = 0
  133 CONTINUE
      ICPUT1 = ICLOCK(0)
      IRELT1 = ITTIME(0)
      IX(2) = NST
      IF (NDPL(11).GT.0) CALL RODX(A(K17),A(K10),A(KNCOMP),A(K24),
     & A(K24),A(KNRGN),A(K50),NVX,MVX,NSETVX,LVX,JVX,IVX,KBVX, JIVX,KVX)
C NEED SOMETHING TO TELL IF NRTSP = ITMX(4)
      NRTSP = 1
C
C*********************START REPEAT TIME STEP LOOP***********************
      I31 = ICLOCK(0)
      DO 146 NRT = 1,NRTSP
      IX(9) = NRT
      IND1 = 1
      CALL HOWE(NCY,IND1,IND2,IHW,ITX,ITM)
      IX(5) = IHW
      ITMAX = ITX
      ITIME = ITM
      IX(75) = 0
      IX(73) = 0
      IGO = 1
      IX(71) = 0
      NDO = 1
      NDOUBL = 1
      IF (IX(5).GT.1) NDOUBL = NSRH(3)
C
C*********************START CYCLE REACTIVITY LOOP***********************
      IX(127) = ICLOCK(0)
COMENTDO 141 NDO = 1,NDOUBL
  134 CONTINUE
      IX(73) = IX(73) + 1
  135 CONTINUE
      CALL EIGN (A,A(K24),A(K24),NTITE,IVX,JVX,KVX,JIVX,KBVX,IX3738)
      IX(198) = 1
      NTITE = 0
      NGC(2) = 0
      IX(16) = 0
      GO TO (136,143),IGO
  136 CONTINUE
      TF1 = FLOTR(29)
      TF2 = FLOTR(30)
      TM1 = AMIN1(XKEF1,TF1)
      TM2 = AMIN1(SPARE(52),TF2)
      FLOTR(29) = TM1
      FLOTR(30) = TM2
      IF (IX(75).EQ.1) GO TO 141
      IF (IX(70).EQ.0) GO TO 140
      IF (IX(70).LT.0) GO TO 137
      WRITE(IOUT,1007)
      GO TO 138
  137 WRITE(IOUT,1013)
  138 CONTINUE
      IF (NGC(15).EQ.0) GO TO 141
      IF (NGC(15).EQ.2) GO TO 139
      IF (IX(126).EQ.0) GO TO 141
  139 WRITE(IOUT,1008)
      WRITE(IOUT,2000)
      STOP
  140 CONTINUE
      NDO = NDO+1
      IF (NDO.LE.NDOUBL) GO TO 134
  141 CONTINUE
      T1 = 1.0/SPARE(18)
      IF ((INTGR(35).GT.0).AND.(INTGR(36).EQ.3)) GO TO 142
      IF ((T1.GT.GLIM(1)).OR.(T1.LT.GLIM(2))) GO TO 178
      IF (IX(5).LE.0) GO TO 142
      IF (SPARE(58).GT.GLIM(3)) GO TO 178
  142 CONTINUE
      IF (LSTEP.NE.1) GO TO 143
      IF (NDPL(5).GE.0) GO TO 143
      IX(24) = 1
      IF (IX(37).GT.0) IX(71) = 1
      IGO = 2
      GO TO 135
  143 CONTINUE
      IF (KL3.LE.0) GO TO 144
      REWIND IO19
      WRITE(IO19)(A(I),I=K23,KL4)
      END FILE IO19
      REWIND IO19
  144 CONTINUE
      INDTOR = 1
      IF (LSTEP.EQ.1) INDTOR = 0
      CALL OUTC (A,A(K17),A(K40),A(K38),A(K14),A(K19),A(K52),A(K16),
     & A(K48),A(K23),NVX,MVX,KVX,IX3738,INDTOR,MVZ,A(K39))
      IF (LSTEP.EQ.1) GO TO 149
  145 CONTINUE
      SPARE(14) = XKEF1
      CALL TSCL(A,KVX,MVX,NVX,NSETVX,NVO,IVO)
      IX(4) = 0
      IF (IX(15).GT.0) IX(4) = 1
      IF (IX(4).GT.0) GO TO 147
      I32 = ICLOCK(0)
      II3 = (I32-I31)/6000
      IF (II3.LT.ITMX(22)) GO TO 146
      WRITE(IOUT,1014)
      IF (NGC(15).EQ.2) GO TO 179
      GO TO 147
  146 CONTINUE
  147 CONTINUE
      IX(41) = 0
      IF ((NST.EQ.NSTEP).OR.(IX(4).EQ.1)) IX(41) = 1
      IF ((NGC(1).GT.0).AND.(INDTOR.GT.0)) CALL DTOR
      IO1X16=1
      CALL RERT(A(K17), A(K9),RATE,A(K1),A(K2),A(K4),A(K5),A(K38),
     & ZONVOL,A(K18),A(K8),A(K43),A(K67),A(K13),KVX,MVX,NVX,NSETVX, NVO,
     &  IO1X16)
      CALL TABL (RATE,A(K10),MVX,NVX,NSETVX,IO1X16)
      CALL RQED(IX(102),IND)
      IF (IND.NE.0) GO TO 148
      CALL EDIN (A(K17),A(K18),A(K9),MVX,NVX,NSETVX,NVO)
  148 CONTINUE
      IX(14) = IX(14)+1
  149 CONTINUE
      IF ((LSTEP.EQ.1).AND.(NDPL(5).LT.1)) GO TO 150
      IF (KL3.LE.0) GO TO 150
      READ(IO19)(A(I),I=K23,KL4)
      REWIND IO19
  150 CONTINUE
      IF (LSTEP.EQ.1) GO TO 151
      IF ((NCY.GT.1).OR.(NST.GT.1).OR.(IQUE.GT.1)) GO TO 151
      IF (N1C1S.GT.0) GO TO 151
      NCCYL = 0
      IF (NGC(3).GT.0) CALL WSTR(NCCYL,A,MEMORY)
  151 CONTINUE
      IX(2) = IX(2)+1
      IF (IX(171).LE.0) GO TO 154
      IF (IX172.GT.0) GO TO 153
      IF (MAC4.EQ.1) GO TO 152
      IF (IQUE.LT.IX(171)) GO TO 154
      GO TO 153
  152 CONTINUE
      IF (NCY.LT.IX(171)) GO TO 154
  153 CONTINUE
      WRITE(IOOW)PF,XLAMDA,BETTA,SPARE(45),SPARE(46)
      IX172 = 1
  154 CONTINUE
      NCCYL = -NCY
      IF (NGC(3).EQ.0) GO TO 155
      CALL WSTR(NCCYL,A,MEMORY)
      BACKSPACE IO13
      BACKSPACE IO13
  155 CONTINUE
      IF (LSTEP.EQ.1) GO TO 159
      IF (IX(4).GT.0) GO TO 157
      IF (SPARE(2).LT.DPLH(1)) GO TO 156
      WRITE(IOUT,1011)NCY
      GO TO 157
  156 CONTINUE
      NST = NST+1
      IX2 = IX(2)-1
      ICPUT2 = ICLOCK(0)
      IRELT2 = ITTIME(0)
      CPUT = (FLOAT(ICPUT2)-FLOAT(ICPUT1))/6000.0
      RELT = (FLOAT(IRELT2)-FLOAT(IRELT1))/6000.0
      WRITE(IOUT,1009)IX2,CPUT,RELT
      IF (NST.LE.NSTEP) GO TO 130
  157 CONTINUE
      IF (NGC(3).EQ.0) GO TO 158
      IF (INNOO.GT.0) GO TO 158
      READ(IO13)
      READ(IO13)
  158 CONTINUE
      IX(16) = 0
      IX(4) = 0
C
      IF (NDPL(5).EQ.0) GO TO 159
      IX(99) = 1
      LSTEP = 1
      GO TO 130
  159 CONTINUE
      IF (IX172.LE.0) GO TO 160
      END FILE IOOW
      REWIND IOOW
      REWIND IOOR
      IOT1 = IOOR
      IOOR = IOOW
      IOOW = IOT1
      IX(172) = 1
  160 CONTINUE
      IX(99) = 0
      LSTEP = 0
      IF (INNOO.EQ.0) GO TO 165
      ITMIS(1) = ITMIS(1)+1
C*****WRITE   END OF CYCLE CONCENTRATIONS ON IO24
      IO24 = IX(91)
      IO12 = IX(79)
      IXND = 1
      CALL WNSS (A(K17),A(K18),A(K44),MVX,NVX,IVO,IO12,IO24,IXND)
      REWIND IO12
      END FILE IO24
      REWIND IO24
  161 CONTINUE
      REWIND IO1
      WRITE(IO1)(A(I),I=1,MEMORY)
      END FILE IO1
      REWIND IO1
      INTGR(11) = 0
      IO22 = IX(89)
      INTGR(12) = IO22
      INTGR(71) = NCY
      INTGR(13) = IO13
      INTGR(14) = NGC(2)
      INTGR(15) = NGC(3)
      INTGR(77) = 0
      INTGR(19) = IQUE
      INTGR(20) = IOUT
      INTGR(46) = NRC
      INTGR(47) = 0
      INTGR(49) = 0
      IF (INTGR(35).EQ.0) GO TO 162
      IF (NGC(2).NE.0) GO TO 162
      FLOTR(28) = FLOTR(21)
      IF (INTGR(36).EQ.1) FLOTR(21) = XKEF1
      IF (INTGR(36).EQ.2) FLOTR(21) =SPARE(52)
      IF (INTGR(36).EQ.3) FLOTR(21) =SPARE(2)
      IF (INTGR(36).EQ.4) FLOTR(21) = FLOTR(29)
      IF (INTGR(36).EQ.5) FLOTR(21) = FLOTR(30)
  162 CONTINUE
      IF ((NCY.EQ.NCYCLE).AND.(NGC(2).EQ.0)) INTGR(77) = 1
      CALL MEDT(A,MEMORY)
      READ(IO1)(A(I),I=1,MEMORY)
      REWIND IO1
      IO26 = IX(93)
      IO27 = IX(94)
      IO12 = IX(79)
      IO29 = IX(96)
C*****READ CONCENTRATIONS FROM FUEL MANAGEMENT INTERFACE IO26-IO27
      CALL RNSS (A(K17),A(K18),A(K44),NVX,MVX,IVO,IO12,IO26,IO27,IO29)
      I22 = ICLOCK(0)
      II2 = (I22-I21)/6000
      IF (II2.LT.ITMX(23)) GO TO 163
      WRITE(IOUT,1015)
      IF (NGC(15).EQ.2) GO TO 179
      GO TO 164
  163 CONTINUE
      NRC = NRC+1
      IF (INTGR(47).LE.0) GO TO 164
      IF (NRC.GT.NRCYC) GO TO 164
      IX(2) = 0
      IX(198) = 0
      SPARE(1 ) = U1
      SPARE(2 ) = U2
      SPARE(9 ) = U9
      SPARE(10) = U10
      SPARE(11) = U11
      SPARE(12) = U12
      SPARE(13) = U13
      SPARE(26) = U26
      SPARE(74) = U74
      SPARE(75) = U75
      GO TO 107
  164 CONTINUE
      NRC = 1
      CALL CYCR
      IF (NGC(3).EQ.0) GO TO 165
      WRITE(IO13)(IX(I),I=1,200),(SPARE(I),I=1,200)
  165 CONTINUE
      IF (INTGR(35).LE.0) GO TO 166
      IF (INTGR(49).GT.0) GO TO 166
      WRITE(IOUT,1000)
      IF (INTGR(41).GT.0) GO TO 175
  166 CONTINUE
      IX(2) = 0
      ICUP2 = ICLOCK(0)
      IRAL2 = ITTIME(0)
      CUP = (FLOAT(ICUP2)-FLOAT(ICUP1))/6000.0
      RAL = (FLOAT(IRAL2)-FLOAT(IRAL1))/6000.0
      WRITE(IOUT,1002)NCY,CUP,RAL
      NCY = NCY+1
      IF ((NCY.GT.1).AND.(DPLH(2).NE.0)) SPARE(100) = DPLH(2)
      NGC(2) = 0
      I12 = ICLOCK(0)
      II1 = (I12-I11)/6000
      IF (II1.LT.ITMX(24)) GO TO 167
      WRITE(IOUT,1016)
      MAC4 = 1
      IF (NGC(15).EQ.2) GO TO 179
      GO TO 168
  167 CONTINUE
      IF ((INTGR(77).GT.0).AND.(INTGR(35).LT.0)) GO TO 168
      IF (NCY.LE.NCYCLE) GO TO 105
  168 CONTINUE
      NCY = 1
      IX(16) = 0
      SPARE(1) = 0.0
      SPARE(2) = 0.0
      SPARE(9) = 0.0
      SPARE(10) = 0.0
      SPARE(11) = 0.0
      SPARE(12) = 0.0
      SPARE(13) = 0.0
      SPARE(26) = 0.0
      SPARE(74) = 0.0
      SPARE(75) = 0.0
      IX(198) = 0
      IF (INTGR(55).GT.0) GO TO 177
      IF ((NGC(3).EQ.0).OR.(MAC4.LE.1).OR.(IQUE.EQ.MAC4)) GO TO 173
      REWIND IO13
  169 CONTINUE
      READ(IO13,END=171) ISIGNL
      IF (ISIGNL.NE.-11111) GO TO 169
      DO 170 N = 1,8
      READ(IO13,END=171)
  170 CONTINUE
      GO TO 172
  171 CONTINUE
      WRITE(IOUT,1003)
      STOP
  172 CONTINUE
      IF (IX(199).GT.0) READ(IO13,END=171)
  173 CONTINUE
      IQUE = IQUE+1
      IF (IQUE.LE.MAC4) GO TO 104
  174 CONTINUE
      IF (MAC4.EQ.1) GO TO 177
      WRITE(IOUT,1004)
      IF (INTGR(26).EQ.0) GO TO 177
  175 CONTINUE
      WRITE(IOUT,1001)
      IF (NGC(3).EQ.0) GO TO 176
      END FILE IO13
      REWIND IO13
  176 CONTINUE
      STOP
  177 CONTINUE
      GO TO 180
  178 WRITE(IOUT,1010)T1,SPARE(58)
      STOP
  179 CONTINUE
  180 CONTINUE
      RETURN
 1000 FORMAT(1H0,'REPEAT CYCLE CONDITIONS NOT MET')
 1001 FORMAT(1H0,'OPTION TO TERMINATE IS ON')
 1002 FORMAT(1H0,'CYCLE',I4,'  REQUIRED',0PF7.3,
     & '  MINUTES CPU TIME, AND',F7.3,'  MINUTES CLOCK TIME')
 1003 FORMAT(1H0,'ERROR STOP 913')
 1004 FORMAT(1H0,'EQUILIBRIUM CYCLE CONDITIONS NOT MET')
 1005 FORMAT(1H0,'INITIAL REACTIVITY LOOP ITERATION COUNT EXCEEDED')
 1006 FORMAT(1H ,'ERROR STOP 13')
 1007 FORMAT(1H0,' CYCLE REACTIVITY LOOP ITERATION COUNT EXCEEDED')
 1008 FORMAT(1H ,'ERROR STOP 13')
 1009 FORMAT(1H0,'TIME STEP',I3,'  REQUIRED',0PF7.3,
     & '  MINUTES CPU TIME, AND',F7.3,'  MINUTES CLOCK TIME')
 1010 FORMAT(1H0,'THE MULTIPLICATION FACTOR ',1PE13.5,
     & 1H ,'OR THE MAXIMUM SEARCH NUCLIDE CONCENTRATION ',E13.5,
     & 1H ,'EXCEEDS THE RESTRAINTS'/
     & 1H ,'SEE GLIM1,GLIM2,GLIM3, CARD 5 SECTION 001')
 1011 FORMAT('0MAXIMUM EXPOSURE TIME FOR CYCLE',I3,' EXCEEDED')
 1012 FORMAT('0INITIAL REACTIVITY LOOP COMPUTER TIME LIMIT EXCEEDED')
 1013 FORMAT('0CYCLE REACTIVITY LOOP COMPUTER TIME LIMIT EXCEEDED')
 1014 FORMAT('0REPEAT TIME STEP LOOP COMPUTER TIME LIMIT EXCEEDED')
 1015 FORMAT('0REPEAT CYCLE LOOP COMPUTER TIME LIMIT EXCEEDED')
 1016 FORMAT('0TOTAL COMPUTER TIME LIMIT EXCEEDED')
 2000 FORMAT(                   ' THE LIMIT ON MULTIPLICATION FACTOR,',
     &       ' MACHINE TIME, OR THE NUMBER OF ITERATIONS WAS EXCEEDED '/
     &       ' IN SOME LOOP CALCULATION AND THE OPTION TO TERMINATE (N',
     &       'GC15, SECTION 001) IS EXERCISED.')
      END
