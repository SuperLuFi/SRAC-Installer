CMACR --035 ***CITATION*** READS INPUT SECTION 008/ CF-IPTM
C
CM    SUBROUTINE MACR(SIG,F1,XI, MVX,KVX,IOMC,BVSIGF,DXII)
      SUBROUTINE MACR(SIG,F1,XI, MVX,KVX,IOMC,BVSIGF,DXII,BLSIGF)
C
CDEL  INTEGER RGX , MSX , ZNEX , ZDX , WZX
CDEL  PARAMETER ( RGX=100, MSX=211, ZDX=200, ZNEX=1000, WZX=100 )
      INCLUDE  'CITPMINC'
C
      COMMON /SRACIT/ ID2,IXKI,IDELAY,IXYZ(ZNEX)
      COMMON /CRBNC/ ICONV,ICRBN,NCBSTP,AVZAB(ZNEX)
C     ICRBN IS SET IN CIT1 IF SRAC, OR CRBN IF COREBN
C     ICRBN =0 : SRAC-CITATION, ICRBN=1 : COREBN
C
      COMMON/ALSUB/BLSUB(30),TITL1(18),TITL2(18),IMAX,JMAX,KBMAX,KMAX,
     & LMAX,MMAX, NMAX,IMXP1,JMXP1,KBMXP1,NSETMX,NTO,MM1VX,KM1VX,IOIN,
     & IOUT,IOSIG,IOFLX,IO1,IO2,IO3,IO4,IO7,NER(100), IX(200),INNO(100),
     &  NGC(24),IEDG(24),ITMX(24),TIMX(6), GLIM(6),NDPL(24),IEDP1(24),
     & IEDP2(24),IEDP3(24), DPLH(6),NUAC(24),EPI(6),XMIS(6),NSRH(24),
     & XSRH1(6), XTR1(WZX),XTR2(WZX),NXTR1(WZX),NXTR2(WZX),SPARE(200),
     & IXPUT(200),XPUT(200)
C
      DIMENSION SIG(KVX,MVX,12),F1(KVX,KVX,MVX),XI(KVX,MVX),
     & BVSIGF(KVX,IDELAY,MVX),DXII(KVX,IDELAY,MVX)
      DIMENSION BLSIGF(KVX,IDELAY,MVX)
C
      DIMENSION I12(3,8)       ,D(2)
      DATA I12/1,1,1, 2,1,1, 1,2,1, 2,2,1,
     &         1,1,2, 2,1,2, 1,2,2, 2,2,2 /
C
C     FOR INPUT PURPOSES WE SHALL TEMPORARILY EXEED THE SPACE
C      ALLOCATED FOR ARRAY F1, THEREFORE SAVE VALUES
      REWIND IO1
      WRITE(IO1)(((F1(KK,K,M),KK=1,KMAX),K=1,KMAX),M=1,MMAX)
      END FILE IO1
      REWIND IO1
C
      IO14 = IX(81)
CKSK START
      IF(ICRBN.EQ.0) THEN
        IF (IX(27).LE.0) GO TO 101
        IF ((MM1VX.NE.MVX).OR.(KM1VX.NE.KVX)) GO TO 101
        REWIND IO14
        DO 100 K = 1,KMAX
          READ(IO14)((F1(KK,K,M),KK=1,KMAX),M=1,MMAX)
  100   CONTINUE
        REWIND IO14
  101   CONTINUE
      ELSE
      ENDIF
CKSK END
      AX=0
      DO 103 M = 1,MMAX
      DO 102 K = 1,KMAX
      SIG(K,M,7) = 0.0
      SIG(K,M,8) = 0.0
      IF ((MM1VX.EQ.MVX).AND.(KM1VX.EQ.KVX)) GO TO 102
      SIG(K,M,1) = 0.0
      SIG(K,M,3) = 0.0
      SIG(K,M,4) = 0.0
      SIG(K,M,5) = 0.0
      SIG(K,M,6) = 0.0
  102 CONTINUE
  103 CONTINUE
C 83/07/22
      MMAX1 = 0
  104 READ(IOMC,1000)M,K,T1,T2,T3,T4,T5
      IF (M) 107,107,105
  105 IF (K.GT.KMAX) GO TO 106
      IF (M.GT.MMAX) GO TO 106
C 83/07/22
      IF (K.EQ.1) MMAX1 = MMAX1 + 1
      IF (K.EQ.0) GO TO 106
      READ(IOMC,1001)(F1(KK,K,M),KK=1,KMAX)
      SIG(K,M,1) = T1
      SIG(K,M,3) = T2
      SIG(K,M,4) = T3
      SIG(K,M,5) = T4
      AX=AX+T5
      SIG(K,M,7)=T5
CI85/07/24 FOR NEUTORN DENSITY EDIT
      IF (IEDG(16).NE.0) SIG(K,M,13) = T4
      GO TO 104
  106 JB=34
      WRITE(IOUT,1003) JB,K,KMAX,M,MMAX
      WRITE(IOUT,2000)
      STOP
  107 IF (AX.NE.0.) GO TO 110
      DO 109 M = 1,MMAX
      DO 108 K = 1,KMAX
      SIG(K,M,7) = SIG(K,M,4) *1.0E+6
  108 CONTINUE
  109 CONTINUE
  110 CONTINUE
C     STORE F1 ARRAY IN FORM TO BE USED LATER
      REWIND IO14
      DO 111 K=1,KMAX
      WRITE(IO14) ((F1(KK,K,M),KK=1,KMAX),M=1,MMAX)
  111 CONTINUE
      END FILE IO14
      REWIND IO14
C
  112 DO 115 M = 1,MMAX
      DO 114 K = 1,KMAX
      SIG(K,M,2) = 0.0
      DO 113 KK = 1,KMAX
      SIG(K,M,2) = SIG(K,M,2)+F1(KK,K,M)
  113 CONTINUE
  114 CONTINUE
  115 CONTINUE
C     RESET F1 TO PREVIOUS VALUES
      READ(IO1) (((F1(KK,K,M),KK=1,KMAX),K=1,KMAX),M=1,MMAX)
      REWIND IO1
C
      READ(IOMC,1001)(XI(K,1),K=1,KMAX)
C     SUMXI = 0.0
C     DO 116 K = 1,KMAX
C     SUMXI = SUMXI+XI(K)
C 116 CONTINUE
C     WRITE(IOUT,1002)(XI(K),K=1,KMAX),SUMXI
      IF(ID2.NE.0) GO TO 130
      DO 120 M=1,MMAX
      DO 120 K=1,KMAX
      SIG(K,M,11)=SIG(K,M,1)
      SIG(K,M,12)=SIG(K,M,1)
C+++++ DEBUG 1991.MAR.4
C     IF( M .LE. 2 ) WRITE(6,*) SIG( K , M , 1 )
C----- DEBUG END
  120 CONTINUE
      GO TO 150
  130 CONTINUE
CITJX 96.1
      IF (ICRBN.EQ.1) MMAX1 = MMAX
CITJX 96.1
      DO 140 M=1,MMAX1
      READ(IOMC,1001) (XI(K,2),K=1,KMAX)
      I12X=I12(1,IXYZ(M))
      I12Y=I12(2,IXYZ(M))
      I12Z=I12(3,IXYZ(M))
      DO 140 K=1,KMAX
      D(1)    = SIG(K,M,1)
      D(2)    = XI(K,2)
      SIG(K,M,1) =D(I12X)
      SIG(K,M,11)=D(I12Y)
  140 SIG(K,M,12)=D(I12Z)
  150 CONTINUE
      IF(IXKI.NE.0) GO TO 170
      DO 160 M=1,MMAX
      DO 160 K=1,KMAX
  160 XI(K,M) = XI(K,1)
      GO TO 190
  170 CONTINUE
CITJX 96.1
      IF (ICRBN.EQ.1) MMAX1 = MMAX
CITJX 96.1
      DO 180 M=1,MMAX1
  180 READ(IOMC,1001) (XI(K,M),K=1,KMAX)
  190 CONTINUE
      DO 210 M=1,MMAX
      SUMXI=0.0
      DO 200 K=1,KMAX
      SUMXI=SUMXI+XI(K,M)
  200 CONTINUE
CKSK*** SUPPRESS PRINT OF FISSION SOURCE UNLESS WANTED 
      IF(IX(104).EQ.0) GOTO 205
      IF(IXKI.EQ.0.AND.M.EQ.1) WRITE(IOUT,1002) (XI(K,1),K=1,KMAX),SUMXI
      IF(IXKI.NE.0) WRITE(IOUT,1004) M,(XI(K,M),K=1,KMAX),SUMXI
  205 CONTINUE
  210 CONTINUE
      IF (IDELAY.EQ.0) GO TO 230
CITJX 96.1
      IF (ICRBN.EQ.1) MMAX1 = MMAX
CITJX 96.1
      DO 220 M= 1,MMAX1
      READ(IOMC,1001) ((BVSIGF(K,K1,M),K1=1,IDELAY),K=1,KMAX)
     &               ,((DXII  (K,K1,M),K1=1,IDELAY),K=1,KMAX)
     &               ,((BLSIGF(K,K1,M),K1=1,IDELAY),K=1,KMAX)
  220 CONTINUE
  230 CONTINUE
      RETURN
 1000 FORMAT(2I6,5E12.0)
 1001 FORMAT(6E12.0)
 1002 FORMAT(1H0/1H0,'FISSION SOURCE DISTRIBUTION AND SUM',10F9.5/ (
     & 1H ,14F9.5))
 1003 FORMAT(1H0,'***DATA ERROR STOP',6I6)
 1004 FORMAT(1H0,'FISSION SOURCE DISTRIBUTION AND SUM FOR MATERIAL',I3/
     &      (1H ,14F9.5))
 2000 FORMAT(' MACROSCOPIC CROSS SECTIONS HAVE BEEN SPECIFIED FOR A Z',
     &       'ONE OR A GROUP THAT EXCEEDS THE MAXIMUM.'/
     &       ' MAXIMUM ZONE''S MACRO CROSS SECTION MUST BE USED IN TH',
     &       'IS CALCULATION.')
      END
