CWSTR --130-***CITATION***-WRITES-RESTART-TAPE/CF-CALR
C
      SUBROUTINE WSTR(NCYLE,A,MEMORY)
C
C**** IF(NCYLE.EQ.999) WRITE COMMON AND FIXED DATA
C**** IF(NCYLE.EQ.0) WRITE CONC. AND FLUX
C**** IF(NCYLE.LT.0) WRITE CONC.
C
CDEL  INTEGER RGX , MSX , ZNEX , ZDX , WZX
CDEL  PARAMETER ( RGX=100, MSX=211, ZDX=200, ZNEX=1000, WZX=100 )
      INCLUDE  'CITPMINC'
C
      COMMON/ALSUB/BLSUB(30),TITL1(18),TITL2(18),IMAX,JMAX,KBMAX,KMAX,
     & LMAX,MMAX, NMAX,IMXP1,JMXP1,KBMXP1,NSETMX,NTO,MM1VX,KM1VX,IOIN,
     & IOUT,IOSIG,IOFLX,IO1,IO2,IO3,IO4,IO7,NER(100), IX(200),INNO(100),
     &  NGC(24),IEDG(24),ITMX(24),TIMX(6), GLIM(6),NDPL(24),IEDP1(24),
     & IEDP2(24),IEDP3(24), DPLH(6),NUAC(24),EPI(6),XMIS(6),NSRH(24),
     & XSRH1(6), XTR1(WZX),XTR2(WZX),NXTR1(WZX),NXTR2(WZX),SPARE(200),
     & IXPUT(200),XPUT(200)
      COMMON/AMESH/BMESH(30),NREGI,NREGJ,NREGKB,XSHI(RGX),XSHJ(RGX),
     & XSHKB(RGX), MSHI(RGX),MSHJ(RGX),MSHKB(RGX),Y(MSX),YY(MSX), X(MSX)
     &  ,XX(MSX),Z(MSX),ZZ(MSX), ZONVOL(ZNEX),AVZPD(ZNEX),PDI(MSX),
     & PDJ(MSX) , PDK(MSX)
      COMMON/AFLUX/BFLUX(30),KXMN8,NIT,NIIT,NIIIT,JXP1,KSCT1,KSCT2,
     & ISTART,IEP, VRGP1,VRGP2,VRGP3,VRG1,VRG2,VRGK1,VRGK2,XABS,PROD,
     & XLEK,RMX,RMN,XKEF1,XKEF2,XKEF3,EXFC1,EXFC2,EXFC3, NI3,IEXTR,
     & IRECV,VRGABS,LO3,LO4,XLAMDA,EPI1,EPI2, BETTA,SUMXI,IX25,IX28,I,J,
     &  KB,K,ITMAX,ITIME, BET(MSX),DEL(MSX)
      COMMON/ABURN/BBURN(30),NSIG1(50),NSIG2(50),NSIG3(50),N1N2R(2,ZDX),
     &  NSIG4(50),NSIG5(50),NSIG6(50),NJM(50),NJMM(50),NJNQ(50),NCH(50),
     &  NZON(ZDX),NXSET(ZDX),NXODR(ZDX),IDXSET(ZDX),NCLASS(ZDX),NDP(ZDX)
     &  , XNAME(3,ZDX)
      COMMON/AVDLM/IVDLM(1),IVX,JVX,KBVX,KVX,LVX,MVX,NVX,IVXP1,JVXP1,
     & KBVXP1,NSETVX,NVO,IVO,IVZ,KVZ,NCRP,NSPA,N3DDIM,NBLOCK,NUO, JIVX,
     & JIP1VX,JP1IXZ,IOVX,IOVZ
      COMMON/AKADD/KAY(1),K1,K2,K3,K4,K5,K6,K7,K8,K9,K10,K11, K12,K13,
     & K131,K14,K15,K16,K17,K18,K19,K20,K21,K22,K23,K24, K25,K26,K27,
     & K28,K29,K30,K31,K32,K33,K34,K35,K36,K37, K38,K39,K40,K41,K42,K43,
     &  K44,K45,K46,K47,K48,K49, K50,K51,K52,K53,K54,K55,K56,K57,K58,
     & K59, K60,K61,K62, K63,K64,K65,K66,K67,K68,K69,K70,K71,K72,K73,
     & K74,K75, K76,K77,K78,K79,K80,K81,K82,K83,K84,K85,K86,K87, K88,
     & K89,K90, K91,K92,K93,K94,K95,K96,K97,K98, K99,K100,NDATA,KNRGN,
     & KNCOMP, KPVOL,KRVOL,MEMVRY, MEMX
      COMMON/ASRCH/ BSRCH(30),XK1,XK2,XK3,XN1,XN2,XN3, DELK1,DELK2,
     & DELK3,BATTY,DRV,TBF,GWC,EK2,RCCM,DNDK(5), NSC(5),NSCN,NXZ,NXN,
     & NXM,NXS,INIL,INIU,INID
C
      DIMENSION A(MEMORY)
C
      IO10 = IX(77)
      IO12 = IX(79)
      REWIND IO12
      IO13 = IX(80)
      IOR = IO13
      WRITE(IOR) NCYLE,NCYLE,NCYLE,NCYLE,NCYLE
      IF (NCYLE.EQ.999) GO TO 106
      J2 = K19-1
      IF ((NGC(19).GT.0).OR.(IX(199).EQ.0)) GO TO 102
      IO11 = IX(78)
      REWIND IO11
      N1 = K41-1
      WRITE(IO11)(A(I),I=K24,N1)
      END FILE IO11
      REWIND IO11
  100 CONTINUE
      INCR = K18-1
      READ(IO12)MVVX
      DO 101 M = 1,MVVX
      READ(IO12)NZN1,NZN2
      J1 = NZN1+INCR
      J2 = NZN2+INCR
      READ(IO12)(A(I),I=J1,J2)
  101 CONTINUE
      REWIND IO12
  102 CONTINUE
      NKM = KPVOL-1
      WRITE(IOR)J2,NKM,(IX(I),I=1,200),(SPARE(I),I=1,200), (A(I),I=K14,
     & J2),(A(I),I=KNCOMP,NKM)
  103 N1 = K41-1
      N2 = 498
      IF ((NGC(19).GT.0).OR.(IX(199).EQ.0)) GO TO 104
      READ(IO11)(A(I),I=K24,N1)
      REWIND IO11
  104 CONTINUE
      IF (NCYLE.NE.0) GO TO 105
      WRITE(IOR)N1,N2,(BFLUX(I1),I1=1,N2), SPARE(39),(A(I),I=K24,N1)
  105 CONTINUE
      END FILE IOR
      BACKSPACE IOR
      GO TO 107
CKSK
C 106 N1 = 1741
C     N2 = 2932
C     N3 = 498
C     N4 = 2730
  106 N1 = 1341+4*WZX
      N2 = 33+6*RGX+9*MSX+2*ZNEX
      N3 = 76+2*MSX
      N4 = 530+11*ZDX
C-----
      N5 = 26
      N6 = 0
CM    N7 = 109
      N7 = 112
C-----
      N13 = 63
      N8=K34-1
      N9 = K52-1
      N14 = K64-1
      N10 = KNRGN+JVX*IVX*KBVX-1
      WRITE(IOR)N1,N2,N3,N4,N5,N6,N7,N8,N9,N10,N13,N14,MEMORY
      WRITE(IOR)(TITL1(I),I=1,18),(TITL2(I),I=1,18)
      WRITE(IOR)(BLSUB(I1),I1=1,N1)
      WRITE(IOR)(BMESH(I1),I1=1,N2)
      WRITE(IOR)(BFLUX(I1),I1=1,N3)
      WRITE(IOR)(BBURN(I1),I1=1,N4)
      WRITE(IOR)(IVDLM(I1),I1=1,N5)
      WRITE(IOR)(KAY(I1),I1=1,N7)
      WRITE(IOR)(BSRCH(I1),I1=1,N13)
      WRITE(IOR)(A(I1),I1=K8 ,N8)
      WRITE(IOR)(A(I1),I1=K50,N9)
      WRITE(IOR)(A(I1),I1=KNRGN,N10)
      WRITE(IOR)(A(I1),I1=KNCOMP,MEMORY)
      WRITE(IOR)(A(I1),I1=K45,N14)
      LIM = K18-1
      REWIND IO1
      WRITE(IO1)(A(I),I=K17,LIM)
      END FILE IO1
      REWIND IO1
      REWIND IO10
      IREAD = IO10
      IRITE = IOR
      CALL KRAN(A(K17),MVX,NVX,IREAD,IRITE, A(K30),A(K31),A(K32),A(K33),
     &  NSETVX)
      REWIND IO10
      END FILE IOR
      BACKSPACE IOR
      READ(IO1)(A(I),I=K17,LIM)
      REWIND IO1
  107 CONTINUE
      RETURN
      END
