C             DUMPRD              LEVEL=3        DATE=87.05.21
      SUBROUTINE DUMPRD (NOTDP)
C
C     READS RESTART DUMP. ALL RECORDS EXCEPT FIRST CONTAIN COUNT
C
      COMMON /TW1C/ DD(1),LIM1,IA(210)
      COMMON /WORK/AAA(1),LIM2,AA(130)
      DIMENSION D(212),A(132)
      EQUIVALENCE (D(1),DD(1)),(AAA(1),A(1))
      EQUIVALENCE (D(150),IEDOPS),(D(134),IFO),(D(107),IGCDMP),
     1(D(130),IPHAF),(D(131),IPVAF),(D(143),ITLIM),(D(124),I2),
     2(D(126),I4),(D(128),I6),(D(105),LAST1),(A(52),LAST2),(D(106),LASTE
     3C),(D(132),LTHAF),(D(133),LTVAF),(D(139),MAXECS),(D(158),NAFLUX),
     4(D(156),NINP),(D(157),NOUT),(D(159),NDUMP1),(D(160),NDUMP2)
     5,(D(87),IDUSE(1))
C
      DIMENSION IPARM(5), ER1(7), ER2(4), ER3(5), ER4(4), IDUSE(18)
C
      EQUIVALENCE (IA(4),IGM),(IA(12),ISTART),(IA(24),IANG),
     1(IA(26),IITL),(IA(31),IEDOPT),(IA(37),EV),(IA(38),EVM),
     2(IA(39),PV),(IA(40),XLAL),(IA(41),XLAH),(IA(42),XLAX),
     3(IA(49),POD),(IA(57),MM),(IA(65),JT),(IA(77),ITP),(IA(78),JTP),
     4(A(111),LANF),(A(8),JCONV),(D(82),MESH),(D(84),NLIMIT),
     5(D(85),IANGPR),(A(61),LC)
      EQUIVALENCE (IPARM(1),IGMRD),(IPARM(2),NORDM),(IPARM(3),NORDAF),
     1(IPARM(4),ITJTRD),(IPARM(5),NMRD)
C
C     NAMELIST
C
      EQUIVALENCE (IA(43),EPS)
C
      NAMELIST /TWOINP/ IITL,ITLIM,IEDOPT,I2,I4,I6,IANG,IFO,EV,EVM,PV,
     1XLAL,XLAH,XLAX,EPS,POD
      NAMELIST /TWOOUT/ IITL,ITLIM,IEDOPT,I2,I4,I6,IANG,IFO,EV,EVM,PV,
     1XLAL,XLAH,XLAX,EPS,POD
C
      CHARACTER*8 ER1,ER2,ER3,ER4
C
      DATA ER1/'IANG C','HANGE ','NOT PE','RMITTE','D ON F','INAL P',
     1'ASS   '/
      DATA ER2/'CORE S','TORAGE',' EXCEE','DED   '/
      DATA ER3/'EXTEND','ED COR','E STOR','AGE EX','CEEDED'/
      DATA ER4/'NEGATI','VE INP','UT INT','EGER  '/
C
      WRITE (NOUT,330)
C
C     BEGIN READING OF DUMP
C
      CALL REED (NOTDP,0,0.0,0,4)
      CALL REED (NOTDP,IPARM,0.0,ITEMP,6)
CKSK  CALL REED (NOTDP,0,D(1),ITEMP,3)
      CALL REED (NOTDP,0,DD(1),ITEMP,3)
CKSK  CALL REED (NOTDP,0,A(1),ITEMP,3)
      CALL REED (NOTDP,0,AAA(1),ITEMP,3)
      IF (NORDAF.LE.0) GO TO 110
C
C     SKIP DATA BLOCK A AND LCM MATERIAL
C
      CALL REED (NOTDP,0,0.0,IGMRD+NORDM+1,7)
C
C     RESTORE ANGULAR FLUX UNIT NAFLUX
C
      CALL REED (NAFLUX,0,0.0,0,4)
      DO 100 IDY=1,NORDAF
CKSK  CALL REED (NOTDP,0,A(LC),ITEMP,3)
CKSK  CALL RITE (NAFLUX,0,A(LC),ITEMP,2)
      CALL REED (NOTDP,0,AAA(LC),ITEMP,3)
      CALL RITE (NAFLUX,0,AAA(LC),ITEMP,2)
  100 CONTINUE
C
C     SAVE PARAMETERS WHICH MUST BE RECOMPUTED AFTER DUMP IS READ
C
  110 CONTINUE
      WRITE (NOUT,340)
      WRITE (NOUT,350)(IDUSE(I),I=1,18)
      ISTART=6
      IDX=IITL
      IITL=-1
      ISANG=IANG
      IANG=-2
      JTCONV=0
C
C     READ NAMELIST
C
      READ (NINP,TWOINP)
      IF (IANG.EQ.-2) GO TO 120
      IF (IABS(IANG).NE.1) IANG=0
      IANGPR=IANG
      IANG=IABS(IANG)
      GO TO 130
  120 CONTINUE
      IANG=ISANG
  130 CONTINUE
      IF (JCONV.EQ.0) GO TO 140
      IF (IGCDMP.NE.1) GO TO 140
      JTCONV=-JCONV
      JCONV=0
C
C     CHECK EDIT OPTION
C
  140 CONTINUE
      IF (IEDOPT.EQ.0) GO TO 230
      IF (IEDOPT.EQ.5) IEDOPT=-5
      IF (IEDOPT.NE.-5) GO TO 180
C
C     DUMMY EDIT
C
      IF (IANG.EQ.0) GO TO 230
      IF (IGCDMP.NE.0) GO TO 150
      IF (ISANG.EQ.0) GO TO 190
      GO TO 230
C
C     NOT FINAL DUMP
C
  150 CONTINUE
      IF (JCONV.EQ.0) GO TO 160
      IF (ISANG.EQ.0) CALL ERROR (1,ER1,7)
      GO TO 170
C
C     NOT CONVERGED DUMP
C
  160 CONTINUE
      JTCONV=1
      IGCDMP=1
  170 CONTINUE
      IEDOPT=IABS(IEDOPT)
      GO TO 230
C
C     LEGAL EDITS WITH ADDITIONAL INPUT REQUIRED
C
  180 CONTINUE
      IF (IANG.NE.0) GO TO 200
      IF (MESH.EQ.0) GO TO 230
      IF (JCONV.NE.0) CALL ERROR (1,ER1,7)
      IANG=1
      IF (IEDOPT.GT.0) GO TO 230
C
C     IMMEDIATE EDIT REQUESTED
C
  190 CONTINUE
      JTCONV=1
      IGCDMP=1
      IEDOPT=IABS(IEDOPT)
      GO TO 230
C
C     ANGULAR FLUX REQUESTED
C
  200 CONTINUE
      IF (IGCDMP.NE.0) GO TO 210
      IF (ISANG.NE.0) GO TO 230
  210 CONTINUE
      IF (JCONV.EQ.0) GO TO 220
      IF (ISANG.EQ.0) CALL ERROR (1,ER1,7)
      IEDOPT=IABS(IEDOPT)
      GO TO 230
  220 CONTINUE
      IANG=1
      IF (IEDOPT.LT.0) GO TO 190
  230 CONTINUE
      IF (IITL.EQ.-1) GO TO 240
C
C     RECOMPUTE NLIMIT
C
      NLIMIT=MIN0(10,IITL)
      IF (NLIMIT.EQ.IITL) NLIMIT=NLIMIT-2
      NLIMIT=MAX0(2,NLIMIT)
      IDX=0
      GO TO 250
  240 CONTINUE
      IITL=IDX
      IDX=1
  250 CONTINUE
      WRITE (NOUT,TWOOUT)
      IF ((IDX.EQ.0).AND.(IITL.GT.2)) IITL=IITL-2
      IF (IABS(IANG).NE.1) IANG=0
      IF (IANG.EQ.ISANG) GO TO 270
      IF (IANG.EQ.0) GO TO 270
      IF (JCONV.EQ.0) GO TO 260
      CALL ERROR (1,ER1,7)
C
C     RECOMPUTE ANGULAR FLUX STORAGE ( IF IANG HAS CHANGED )
C
  260 CONTINUE
      LANF=LAST2
      LAST2=LANF+ITP*MM*IANG*2
      LTHAF=ITP*MM*IANG*2
      LTVAF=ITP*MM*IANG*2
      IPHAF=LASTEC-1
      IPVAF=IPHAF+LTHAF*2*JT
      LASTEC=IPVAF+LTVAF*2*JTP
      LASTEC=LASTEC+1
C
C     COMPUTE REMAINDER OF BLOCK A TO BE USED AS LCM
C
      MAXECS = LIM2 - LAST2
      IF ( MAXECS .LE. 0 ) MAXECS = 0
      WRITE (NOUT,360)LAST2,LIM2,LASTEC,MAXECS
C
C     RECHECK STORAGE REQUIREMENTS BECAUSE IANG HAS CHANGED
C
      IF (LASTEC.GT.MAXECS) CALL ERROR (1,ER2,4)
      IF ( LAST2.GT.LIM2 ) CALL ERROR (1,ER3,5)
C
C     CHECK NEW INPUT PARAMETERS FROM RESTART DUMP
C
  270 CONTINUE
      IEDOPS=IEDOPT
      IEDOPT=IABS(IEDOPT)
      IF (IEDOPT.EQ.5) IEDOPT=4
C
C     IF IEDOPT .LT. 0 ON RESTART GO DIRECTLY TO FINAL PRINT AND EDIT
C     ON RESTART
C
      IF (IITL.LT.0) CALL ERROR (1,ER4,4)
      IF (ITLIM.LT.0) CALL ERROR (1,ER4,4)
      IF ( IGCDMP .EQ. 0 ) IGCDMP = 1
      IF (JTCONV) 280,300,290
  280 CONTINUE
      JCONV=-JTCONV
      GO TO 300
  290 CONTINUE
      JCONV=1+IANG
C
C     POSITION AT FIRST FLUX RECORD
C
  300 CONTINUE
      CALL REED (NOTDP,1,0.0,5,7)
C
C     RETURN FLUX BY GROUP TO LCM
C
      IECSR=1
      DO 310 IG=1,IGMRD
CKSK  CALL REED (NOTDP,0,A(LC),IDX,3)
CKSK  CALL RITE (0,IECSR,A(LC),IDX,1)
      CALL REED (NOTDP,0,AAA(LC),IDX,3)
      CALL RITE (0,IECSR,AAA(LC),IDX,1)
      IECSR=IECSR+IDX
  310 CONTINUE
C
C     RESTORE REMAINDER OF LCM
C
      DO 320 IDY=1,NORDM
CKSK  CALL REED (NOTDP,0,A(LC),IDX,3)
CKSK  CALL RITE (0,IECSR,A(LC),IDX,1)
      CALL REED (NOTDP,0,AAA(LC),IDX,3)
      CALL RITE (0,IECSR,AAA(LC),IDX,1)
      IECSR=IECSR+IDX
  320 CONTINUE
      CALL REED (NOTDP,1,0.0,4,7)
C
C     RESTORE DATA BLOCK A
C
CKSK  CALL REED (NOTDP,0,A,ITEMP,3)
      CALL REED (NOTDP,0,AAA,ITEMP,3)
      CALL REED (NOTDP,0,0.0,0,4)
      WRITE (NOUT,370)
C
C     EXCHANGE DUMP UNITS
C
      ITEMP=NDUMP1
      NDUMP1=NDUMP2
      NDUMP2=ITEMP
      RETURN
C
C
  330 FORMAT (57H0*****A GROUP RESTART DUMP TAPE IS TO BE PROCESSED.****
     1* )
  340 FORMAT (63H0*****THE RESTART DUMP READ CONTAINS THE TITLE AS FOLLO
     1WS***** )
  350 FORMAT (1H ,18A4)
  360 FORMAT (//8H0STORAGE,4X,8HREQUIRED,8H ALLOWED/11H SMALL CORE,2(2X,
     1I6)/11H LARGE CORE,2(1X,I7))
  370 FORMAT ( 61 H0*****A SUCCESSFUL RESTART DUMP LOAD HAS BEEN COMPLET
     1ED***** )
      END
