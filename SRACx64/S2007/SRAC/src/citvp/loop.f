CLOOP-VP-098 ***CITATION*** PHIBAR,SOURCE,CONVERGENCE FOR 1,2-D/ CF-FLUX
C
      SUBROUTINE LOOP( P2,SOUR,NRGN,XII,IVX,JVX,KVX,LVX,XLAMDA, SIG,
     & PVOL,NCOMP,MVX,CKSOY)
C
CDEL  INTEGER RGX , MSX , ZNEX , ZDX , WZX
CDEL  PARAMETER ( RGX=100, MSX=211, ZDX=200, ZNEX=1000, WZX=100 )
      INCLUDE  'CITPMINC'
C
      REAL*8 CKSOY(JVX*IVX)
      REAL*8 P2
      REAL*8 SOUR
      REAL*8 XII
      REAL*8 XLAMDA
C
      COMMON/ALSUB/BLSUB(30),TITL1(18),TITL2(18),IMAX,JMAX,KBMAX,KMAX,
     & LMAX,MMAX, NMAX,IMXP1,JMXP1,KBMXP1,NSETMX,NTO,MM1VX,KM1VX,IOIN,
     & IOUT,IOSIG,IOFLX,IO1,IO2,IO3,IO4,IO7,NER(100), IX(200),INNO(100),
     &  NGC(24),IEDG(24),ITMX(24),TIMX(6), GLIM(6),NDPL(24),IEDP1(24),
     & IEDP2(24),IEDP3(24), DPLH(6),NUAC(24),EPI(6),XMIS(6),NSRH(24),
     & XSRH1(6), XTR1(WZX),XTR2(WZX),NXTR1(WZX),NXTR2(WZX),SPARE(200),
     & IXPUT(200),XPUT(200)
      COMMON/AFLUX/BFLUX(30),KXMN8,NIT,NIIT,NIIIT,JXP1,KSCT1,KSCT2,
     & ISTART,IEP, VRGP1,VRGP2,VRGP3,VRG1,VRG2,VRGK1,VRGK2,XABS,PROD,
     & XLEK,RMX,RMN,XKEF1,XKEF2,XKEF3,EXFC1,EXFC2,EXFC3, NI3,IEXTR,
     & IRECV,VRGABS,LO3,LO4,XLAMDB,EPI1,EPI2, BETTA,SUMXI,IX25,IX28,I,J,
     &  KB,K,ITMAX,ITIME, BET(MSX),DEL(MSX)
C
      DIMENSION P2 (JVX*IVX, KVX), SOUR (JVX*IVX ), NRGN (JVX*IVX )
      DIMENSION XII(KVX,MVX)
      DIMENSION SIG(KVX,MVX,10),PVOL(LVX),NCOMP(LVX)
C
      IF (IX(24).GT.0) GO TO 105
      DO 200 JAY=1,JVX*IVX
  200   CKSOY(JAY)=0.0D0
C
      IF (SPARE(98).EQ.0.0) THEN
      DO 220 K=1,KVX
      DO 210 JAY=1,JVX*IVX
  210   CKSOY(JAY)=CKSOY(JAY)+SIG(K,NCOMP(NRGN(JAY)),4)*P2(JAY,K)
  220 CONTINUE
      ELSE
      DO 240 K=1,KVX
      DO 230 JAY=1,JVX*IVX
  230   CKSOY(JAY)=CKSOY(JAY)+SIG(K,NCOMP(NRGN(JAY)),4)*P2(JAY,K)
     &          +XLAMDA*SIG(K,NCOMP(NRGN(JAY)),8)*P2(JAY,K)
  240 CONTINUE
      ENDIF
      DO 250 JAY=1,JVX*IVX
  250   SOUR(JAY)=CKSOY(JAY)*PVOL(NRGN(JAY))
      GO TO 109
C
  105 CONTINUE
      DO 260 JAY=1,JVX*IVX
  260   SOUR(JAY)=0.0D0
      DO 280 K=1,KVX
      DO 270 JAY=1,JVX*IVX
        L=NRGN( JAY )
        M=NCOMP( L )
  270   SOUR(JAY)=SOUR(JAY)+XII(K,M)*P2(JAY,K)
  280 CONTINUE
C
  109 CONTINUE
      RETURN
      END
