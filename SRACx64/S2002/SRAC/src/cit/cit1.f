CMOD  SUBROUTINE CIT1(AA,MEMORY)
      SUBROUTINE CIT1(AA,MEMORY,IAA)
C
C     THIS ROUTINE IS USED ONLY IN SRAC-CITATION AND NOT USED IN COREBN
C
CDEL  INTEGER RGX , MSX , ZNEX , ZDX , WZX
CDEL  PARAMETER ( RGX=100, MSX=211, ZDX=200, ZNEX=1000, WZX=100 )
      INCLUDE  'CITPMINC'
C
      COMMON /CIT1C/ NM,NXR,ID,IRN,LCNM,LCNXR,LCMAC,LCVOL,ICMAX
     &              ,LCVLMC,DUM(9),IC(3000)
CM   &,IC(3000)
      COMMON /SRACIT/ ID2,IXKI,IDELAY,IXYZ(ZNEX)
      COMMON /CRBNC/ ICONV,ICRBN,NCBSTP,AVZAB(ZNEX)
C     COMMON /RECCIT/ LNRGN,LPVOL
      COMMON /PERTCM/ P(1),MEMPET,IPERT,PP(997)
      COMMON /MAINC/ III(1000)
      COMMON/ALSUB/BLSUB(30),TITL1(18),TITL2(18),IMAX,JMAX,KBMAX,KMAX,
     & LMAX,MMAX, NMAX,IMXP1,JMXP1,KBMXP1,NSETMX,NTO,MM1VX,KM1VX,IOIN,
     & IOUT,IOSIG,IOFLX,IO1,IO2,IO3,IO4,IO7,NER(100), IX(200),INNO(100),
     &  NGC(24),IEDG(24),ITMX(24),TIMX(6), GLIM(6),NDPL(24),IEDP1(24),
     & IEDP2(24),IEDP3(24), DPLH(6),NUAC(24),EPI(6),XMIS(6),NSRH(24),
     & XSRH1(6), XTR1(WZX),XTR2(WZX),NXTR1(WZX),NXTR2(WZX),SPARE(200),
     & IXPUT(200),XPUT(200)
      COMMON/AMESH/BMESH(30),NREGI,NREGJ,NREGKB,XSHI(RGX),XSHJ(RGX),
     & XSHKB(RGX), MSHI(RGX),MSHJ(RGX),MSHKB(RGX),Y(MSX),YY(MSX), X(MSX)
     &  ,XX(MSX),Z(MSX),ZZ(MSX), ZONVOL(ZNEX),AVZPD(ZNEX),PDI(MSX),
     & PDJ(MSX) , PDK(MSX)
      COMMON/AFLUX/BFLUX(30),KXMN8,NIT,NIIT,NIIIT,JXP1,KSCT1,KSCT2,
     & ISTART,IEP, VRGP1,VRGP2,VRGP3,VRG1,VRG2,VRGK1,VRGK2,XABS,PROD,
     & XLEK,RMX,RMN,XKEF1,XKEF2,XKEF3,EXFC1,EXFC2,EXFC3, NI3,IEXTR,
     & IRECV,VRGABS,LO3,LO4,XLAMDA,EPI1,EPI2, BETTA,SUMXI,IX25,IX28,I,J,
     &  KB,K,ITMAX,ITIME, BET(MSX),DEL(MSX)
      COMMON/ABURN/BBURN(30),NSIG1(50),NSIG2(50),NSIG3(50),N1N2R(2,ZDX),
     &  NSIG4(50),NSIG5(50),NSIG6(50),NJM(50),NJMM(50),NJNQ(50),NCH(50),
     &  NZON(ZDX),NXSET(ZDX),NXODR(ZDX),IDXSET(ZDX),NCLASS(ZDX),NDP(ZDX)
     &  , XNAME(3,ZDX)
      COMMON/AVDLM/IVDLM(1),IVX,JVX,KBVX,KVX,LVX,MVX,NVX,IVXP1,JVXP1,
     & KBVXP1,NSETVX,NVO,IVO,IVZ,KVZ,NCRP,NSPA,N3DDIM,NBLOCK, JIVX,
     & JIP1VX,JP1IXZ,IOVX,IOVZ
      COMMON/AKADD/KAY(1),K1,K2,K3,K4,K5,K6,K7,K8,K9,K10,K11, K12,K13,
     & K131,K14,K15,K16,K17,K18,K19,K20,K21,K22,K23,K24, K25,K26,K27,
     & K28,K29,K30,K31,K32,K33,K34,K35,K36,K37, K38,K39,K40,K41,K42,K43,
     &  K44,K45,K46,K47,K48,K49, K50,K51,K52,K53,K54,K55,K56,K57,K58,
     & K59, K60,K61,K62, K63,K64,K65,K66,K67,K68,K69,K70,K71,K72,K73,
     & K74,K75, K76,K77,K78,K79,K80,K81,K82,K83,K84,K85,K86,K87, K88,
     & K89,K90, K91,K92,K93,K94,K95,K96,K97,K98, K99,K100,NDATA,KNRGN,
     & KNCOMP, KPVOL,KRVOL,MEMVRY, MEMX
      COMMON/ASRCH/ BSRCH(30),XK1,XK2,XK3,XN1,XN2,XN3, DELK1,DELK2,
     & DELK3,BATTY,DRV,TBF,GWC,EK2,RCCM,DNDK(5), NSC(5),NSCN,NXZ,NXN,
     & NXM,NXS,INIL,INIU,INID
      COMMON/CMARY/MEMARY,IMN,MNI,IJLMN,NMLJI,IY(50),AX(50),TITL(36)
      COMMON/COOPD/FLOTR(200),INTGR(100)
C
      DIMENSION IDUM(3),MATNM(2),A(20),AA(MEMORY),AC(1)
      DIMENSION CMARYD(1),IFLOT(1)
CADD
      INTEGER*4    IAA(MEMORY)
CEND
      EQUIVALENCE (CMARYD(1),MEMARY),(IFLOT(1),FLOTR(1))
      EQUIVALENCE (III(64),NOUT1),(III(65),NOUT2),(IC(1),AC(1))
C
      CHARACTER*4 EOF,EOF9,A,A1
      DATA EOF,EOF9 /'    ','999 '/
C-----------------------------------------------------------------------
C     ICRBN IS SET IN CIT1 IF SRAC, OR CRBN IF COREBN
C     ICRBN =0 : SRAC-CITATION, ICRBN=1 : COREBN
C-----------------------------------------------------------------------
      ICRBN = 0
C
C     WRITE(NOUT1,6000)
C  *** COMMON SIZE SET
C
      NIN    = III(62)
      MEMPET = 1000
C     ICMAX = 3000 /* TRNASFERRED TO MAIN */
      WRITE(NOUT2,6000)
 6000 FORMAT(//10X,'***** MULTI-DIMENSIONAL DIFFUSION CODE INPUT STEP-',
     &      'I *****'//                                                )
      IOIN = 91
C     CALL REAI(IDUM,3,'BLOC','K1  ')
      CALL REAM(DUM,IDUM,DUM,0,3,0)
      LCNM=1
      NM=IDUM(1)
      NXR=IDUM(2)
      ID=IDUM(3)
      WRITE(NOUT2,6010) NM,NXR,ID
 6010 FORMAT(6X,'NUMBER OF MATERIALS USED IN THIS ROUTINE',I45/
     &       6X,'NUMBER OF X-REGIONS ( =0 MIX CROSS SECTION STEP IS SK',
     &       'IPPED)',I26/
     &       6X,'OPTION TO SELECT DIFFUSION COEFFICIENT (1,2,3,<0) = (',
     &       'D1,D2,D1&D2,SPECIAL)',I12                                )
C     CALL REAI(II(LCNM),NM,'MAT ','NO. ')
C     WRITE(NOUT2,6100) (II(I),I=LCNM,LCNM+NM-1)
C6100 FORMAT(10X,'MATERIAL NUMBER'(/10X,10I10))
      IXKI = 0
      IDELAY = 0
      IPERT = 0
      IF (NM.GT.0) GO TO  85
      IPERT = 1
      NM    = -NM
   85 CONTINUE
      IF (ID.GE.0) GO TO 90
C     CALL REAI(IDUM,2,'XI  ','DELY')
      CALL REAM(DUM,IDUM,DUM,0,2,0)
      IXKI = IDUM(1)
      IDELAY = IDUM(2)
      ID = IABS(ID)
      WRITE (NOUT2,6200) IXKI,IDELAY
 6200 FORMAT(6X,'OPTION OF MATERIAL DEPENDENT FISSION SPECTRUM USE (0,',
     &      '1) = (NO,YES)',I19/
     &       6X,'OPTION OF DELAYED NEUTRON DATA CREATE ON MACRO FILE (',
     &       '0,1) = (NO,YES)',I17                                     )
   90 CONTINUE
      ID2 = 0
      IF(ID.NE.3) GO TO 110
      ID2 = 1
C     CALL REAI(IXYZ,NM,'D NO','.   ')
      CALL REAM(DUM,IXYZ,DUM,0,NM,0)
      WRITE(NOUT2,6300) (IXYZ(I),I=1,NM)
 6300 FORMAT(6X,'SELECTION OF D1 AND D2 FOR EACH AXES AND EACH MATERIA',
     &       'LS',I30,4I10/(81X,5I10)                                  )
      DO 100 I = 1,NM
      IF (IXYZ(I).GT.0.AND.IXYZ(I).LT.9) GO TO 100
      WRITE(NOUT1,6050) I,IXYZ(I)
      STOP
  100 CONTINUE
  110 CONTINUE
      IF (IPERT.GT.0) CALL PERTIN(NOUT2)
      IF(III(2).NE.5.AND.III(12).NE.5.AND.III(14).EQ.1) GO TO 40
      REWIND IOIN
      A1='    '
   10 A1=A(1)
CMOD  READ(5,6030,END=999) A
      READ(NIN,6030,END=999) A
      WRITE(IOIN,6030) A
 6030 FORMAT(20A4)
      IF(A1 .NE. EOF9) GO TO 10
      DO 20 I=1,18
      IF(A(I) .NE. EOF) GO TO 10
   20 CONTINUE
      REWIND IOIN
      CALL CIT2(AA,MEMORY,1)
      IRN1 = NREGJ*NREGI*NREGKB
      IRN = IRN1
      IF (NXR.EQ.0) IRN = 0
      LCNXR = LCNM + NM
      LCMAC = LCNXR +  IRN
      LCVOL = LCMAC + IRN
CM    ICLAST = LCVOL + IRN
      LCVLMC = LCVOL + IRN
      ICLAST = LCVLMC + NM
C     IF (III(18) .EQ. 0) GO TO 25
C     LNRGN = ICLAST
C     MESHT = IMAX*JMAX*KBMAX
C     LPVOL = LNRGN + MESHT
C     ICLAST = LPVOL + IRN1
C  25 CONTINUE
      IF(ICMAX .GE. ICLAST) GO TO 30
      WRITE(NOUT1,6060) ICLAST,ICMAX
      STOP
   30 CONTINUE
COMMENT  INSERTED 86' 7/8 AS FOLLOWS
      IF(NXR.GT.0 .AND.(NGC(12).NE.0 .OR. IDELAY.NE.0 .OR.
     & IPERT.NE.0) ) THEN
      WRITE(NOUT1,6035)
      WRITE(NOUT2,6035)
     & ' ** CONFLICT USE OF CITATION STEP DETECTED ',
     & '    AS BOTH OF CROSS SECTION AVERAGE (NXR=',NXR,
     & ') & ADJOINT FLUX CALCULATION(NGC12=1) ARE SPECIFIED --> ERROR',
     & ' STOP **'
 6035 FORMAT(A/A,I3,A,A)
                      ENDIF
      WRITE(NOUT1,6040) ICLAST,ICMAX
      WRITE(NOUT2,6040) ICLAST,ICMAX
   40 CONTINUE
      CALL CITTOS(NM,IRN,IRN1,IC(LCNM),IC(LCNXR),IC(LCMAC),AC(LCVOL),
     1            AA(KRVOL),AA(KNCOMP),IC(LCVLMC)  )
CM   &            AA(KRVOL),AA(KNCOMP)                               )
C    1            AA(KRVOL),AA(KNCOMP),AC(LNRGN),AC(LPVOL),AA(KNRGN),
C    2            AA(KPVOL),MESHT                                    )
CI86/01/21 FOR REACTION RATE CALCULATION FT01-FT92
C
      IBLSB = 1341 + 4*WZX
      IBMES = 33   + 6*RGX + 9*MSX + 2*ZNEX
      IBFLX = 76   + 2*MSX
      IBBUR = 530  + 11*ZDX
C
      REWIND 92
C
C     WRITE(92) (BLSUB  (I),I=1,1741)
C    &        ,(BMESH  (I),I=1,2932)
C    &        ,(BFLUX  (I),I=1, 498)
C    &        ,(BBURN  (I),I=1,2730)
      WRITE(92) (BLSUB  (I),I=1,IBLSB)
     &        ,(BMESH  (I),I=1,IBMES)
     &        ,(BFLUX  (I),I=1,IBFLX)
     &        ,(BBURN  (I),I=1,IBBUR)
     &        ,(IVDLM  (I),I=1,  26)
     &        ,(KAY    (I),I=1, 109)
     &        ,(BSRCH  (I),I=1,  63)
     &        ,(CMARYD (I),I=1, 141)
     &        ,(IFLOT  (I),I=1, 500)
CMOD &        ,(AA(KNRGN-1+I),I=1,JMAX*IMAX*KBMAX)
     &        ,(IAA(KNRGN-1+I),I=1,JMAX*IMAX*KBMAX)
CMOD &        ,(AA(KPVOL-1+I),I=1,LMAX),(AA(KNCOMP-1+I),I=1,LMAX)
     &        ,(AA(KPVOL-1+I),I=1,LMAX),(IAA(KNCOMP-1+I),I=1,LMAX)
C
      REWIND 92
      RETURN
  999 CONTINUE
      WRITE(NOUT1,6070)
      STOP
 6040 FORMAT(10X,'STORAGE USED',I10,' FROM',I10,' IN CIT1 STEP')
 6050 FORMAT(10X,'ERROR IN CIT1 , IXYZ(',I3,') < 1 OR > 8',I6 )
 6060 FORMAT(10X,'*** ERROR ALLOCATED CIT1C STORAGE SHOTAGE FOR CIT1'
     &      ,' STEP ***'/10X,'STORAGE NEEDED =',I10,' ALLOCATED =',I10)
 6070 FORMAT('0*** END OF FILE ON INPUT FILE DETECTED IN CIT1 STEP ***'
     &      )
      END
