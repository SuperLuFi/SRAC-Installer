CFXRD --106 ***CITATION*** LINE RELAXATION ON COLS FOR 1,2-D/ CF-DNSD
C
      SUBROUTINE FXRD( SCAT, P2,DCONB,DCONR,PTSA, IVX,JVX,KVX, IVXP1,
     & JVXP1,IVZ,KVZ,BET,DEL,NRGN,E1,LVX, IOVX,IOVZ)
C
CDEL  INTEGER RGX , MSX , ZNEX , ZDX , WZX
CDEL  PARAMETER ( RGX=100, MSX=211, ZDX=200, ZNEX=1000, WZX=100 )
      INCLUDE  'CITPMINC'
C
      REAL*8 P2
      REAL*8 BET(MSX),DEL(MSX),T,TEMP,TMF,TEMPW
      REAL*8 SCAT
C
      COMMON/ALSUB/BLSUB(30),TITL1(18),TITL2(18),IMAX,JMAX,KBMAX,KMAX,
     & LMAX,MMAX, NMAX,IMXP1,JMXP1,KBMXP1,NSETMX,NTO,MM1VX,KM1VX,IOIN,
     & IOUT,IOSIG,IOFLX,IO1,IO2,IO3,IO4,IO7,NER(100), IX(200),INNO(100),
     &  NGC(24),IEDG(24),ITMX(24),TIMX(6), GLIM(6),NDPL(24),IEDP1(24),
     & IEDP2(24),IEDP3(24), DPLH(6),NUAC(24),EPI(6),XMIS(6),NSRH(24),
     & XSRH1(6), XTR1(WZX),XTR2(WZX),NXTR1(WZX),NXTR2(WZX),SPARE(200),
     & IXPUT(200),XPUT(200)
      COMMON/AFLUX/BFLUX(30),KXMN8,NIT,NIIT,NIIIT,JXP1,KSCT1,KSCT2,
     & ISTART,IEP, VRGP1,VRGP2,VRGP3,VRG1,VRG2,VRGK1,VRGK2,XABS,PROD,
     & XLEK,RMX,RMN,XKEF1,XKEF2,XKEF3,EXFC1,EXFC2,EXFC3, NI3,IEXTR,
     & IRECV,VRGABS,LO3,LO4,XLAMDA,EPI1,EPI2, BETTA,SUMXI,IX25,IX28,I,J,
     &  KB,K,ITMAX,ITIME, BAT(MSX),DAL(MSX)
C
      DIMENSION SCAT(JVX,IVX), P2(JVX,IVX,KVX),DCONB(JVX,IVXP1,IOVX),
     & DCONR(JVXP1,IVZ,IOVZ),PTSA(JVX,IVX,IOVX)
      DIMENSION NRGN(JVX,IVX),E1(LVX,KVX)
C
      INRB=IX(72)+1
      N = IX(20)
CKSK
      IF (P2(1,1,K).NE.0.0) THEN   
CBUG    TEMPW = 1/(PTSA(1,1,N)+E1(1,K))
        L = NRGN(1,1)
        TEMPW = 1/(PTSA(1,1,N)+E1(L,K))
      ENDIF
CKSK
  100 DO 142 J = 1,JVX
      JP1 = J-1
      JP2 = J+1
      DEL(1) = 0.0
      D1 = DCONR(J,1,N)
      D2 = DCONR(JP2,1,N)
      D4 = DCONB(J,2,N)
  101 IF (J-1) 102,102,108
  102 IF (P2(1,1,K)) 103,104,103
  103 BET(1) = (P2(2,1,K)*D2+ SCAT(1,1))/D4
CKSK  DEL(1) = D4/(PTSA(1,1,N)+E1(1,K))
      DEL(1) = D4*TEMPW
  104 DO 107 I = 2,IVX
      IF (P2(1,I,K)) 106,105,106
  105 DEL(I) = 0.0
      GO TO 107
  106 T=D4*DEL(I-1)
      L = NRGN(1,I)
      D4 = DCONB(1,I+1,N)
      BET(I) = (P2(2,I,K)*DCONR(2,I,N)+ SCAT(1,I)+ BET(I-1)*T)/D4
      DEL(I) = D4/(PTSA(1,I,N)-T+E1(L,K))
  107 CONTINUE
      GO TO 125
  108 IF (J-JVX) 119,109,109
  109 IF (P2(JVX,1,K)) 110,113,110
  110 BET(1) = (P2(JP1,1,K)*D1+ SCAT(J,1))/D4
      L = NRGN(JVX,1)
      DEL(1) = D4/(PTSA(JVX,1,N)+E1(L,K))
      GO TO (113,113,111,112),INRB
  111 BET(1)=BET(1)+P2(1,IVX,K)*D2/D4
      GO TO 113
  112 BET(1)=BET(1)+P2(JVX,IVX,K)*D2/D4
  113 DO 118 I = 2,IVX
      IF (P2(JVX,I,K)) 115,114,115
  114 DEL(I) = 0.0
      GO TO 118
  115 T=D4*DEL(I-1)
      L = NRGN(JVX,I)
      D4 = DCONB(J,I+1,N)
      BET(I) = (P2(JP1,I,K)*DCONR(JVX,I,N)+ SCAT(JVX,I)+BET(I-1)*T)/D4
      DEL(I) = D4/(PTSA(JVX,I,N)-T+E1(L,K))
      GO TO (118,118,116,117),INRB
  116 BET(I)=BET(I)+P2(I,IVX,K)*DCONR(JVXP1,I,N)/D4
      GO TO 118
  117 BET(I)=BET(I)+P2(JVX,IVXP1-I,K)*DCONR(JVXP1,I,N)/D4
  118 CONTINUE
      GO TO 125
  119 IF (P2(J,1,K)) 120,121,120
  120 CONTINUE
      L = NRGN(J,1)
      BET(1) = (P2(JP1,1,K)*D1+P2(JP2,1,K)*D2+ SCAT(J,1))/D4
      DEL(1) = D4/(PTSA(J,1,N)+E1(L,K))
  121 CONTINUE
      DO 124 I=2,IVX
      IF (P2(J,I,K)) 123,122,123
  122 DEL(I) = 0.0
      GO TO 124
  123 T=D4*DEL(I-1)
      L = NRGN(J,I)
      D4 = DCONB(J,I+1,N)
      BET(I) = (P2(JP1,I,K)*DCONR(J,I,N)+P2(JP2,I,K)*DCONR(JP2,I,N)+
     & SCAT(J,I)+BET(I-1)*T)/D4
      DEL(I) = D4/(PTSA(J,I,N)-T+E1(L,K))
  124 CONTINUE
  125 CONTINUE
      IF (INRB.NE.3) GO TO 126
      IF (J.EQ.JVX) GO TO 126
      BET(IVX)=BET(IVX)+P2(JVX,J,K)
  126 TEMP = BET(IVX)*DEL(IVX)
      T = P2(J,IVX,K)
      TMF=T+VRGK2*(TEMP-T)
      IF (IEP) 127,131,128
  127 P2(J,IVX,K)=TEMP
      GO TO 132
  128 IF (TMF-TEMP) 130,131,129
  129 TMF = DMIN1(TMF,(TEMP+ T))
      GO TO 131
  130 TMF = DMAX1(TMF,0.5*TEMP)
  131 CONTINUE
      P2(J,IVX,K)=TMF
  132 DO 139 JJ = 2,IVX
      I = IVXP1-JJ
      T = P2(J,I,K)
      TEMP = DEL(I)*(TEMP+BET(I))
      TMF=T+VRGK2*(TEMP-T)
      IF (IEP) 133,137,134
  133 P2(J,I,K)=TEMP
      GO TO 139
  134 IF (TMF-TEMP) 136,137,135
  135 TMF = DMIN1(TMF,(TEMP+ T))
      GO TO 137
  136 TMF = DMAX1(TMF,0.5*TEMP)
  137 CONTINUE
  138 P2 (J,I, K) = TMF
  139 CONTINUE
      IF (NUAC(8)) 140,142,142
  140 M=JVXP1-J
      DO 141I=1,IVX
      L=IVXP1-I
      P2(M,L,K)=P2(J,I,K)
  141 CONTINUE
  142 CONTINUE
      RETURN
      END
