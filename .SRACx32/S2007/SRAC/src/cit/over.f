COVER --034 ***CITATION*** READS OVERLAY SECTION 006/ CF-IPTM
C
      SUBROUTINE OVER(ISTEP,
     &                NRGN,NCOMP,RVOL,PVOL,IVX,JVX,KBVX,LSZ,NNN1,N222)
C
CDEL  INTEGER RGX , MSX , ZNEX , ZDX , WZX
CDEL  PARAMETER ( RGX=100, MSX=211, ZDX=200, ZNEX=1000, WZX=100 )
      INCLUDE  'CITPMINC'
C
      COMMON/ALSUB/BLSUB(30),TITL1(18),TITL2(18),IMAX,JMAX,KBMAX,KMAX,
     & LMAX,MMAX, NMAX,IMXP1,JMXP1,KBMXP1,NSETMX,NTO,MM1VX,KM1VX,IOIN,
     & IOUT,IOSIG,IOFLX,IO1,IO2,IO3,IO4,IO7,NER(100), IX(200),INNO(100),
     &  NGC(24),IEDG(24),ITMX(24),TIMX(6), GLIM(6),NDPL(24),IEDP1(24),
     & IEDP2(24),IEDP3(24), DPLH(6),NUAC(24),EPI(6),XMIS(6),NSRH(24),
     & XSRH1(6), XTR1(WZX),XTR2(WZX),NXTR1(WZX),NXTR2(WZX),SPARE(200),
     & IXPUT(200),XPUT(200)
C
      DIMENSION NRGN(JVX,IVX,KBVX),NCOMP(LSZ),RVOL(LSZ),PVOL(LSZ)
      DIMENSION NOVER(6,MSX),JL(3),JR(3),IT(3),IB(3),KBF(3),KBB(3)
C
      NTOT = IVX*JVX*KBVX
      IF(ISTEP.EQ.1)WRITE(IOUT,1000)
      IF (NUAC(5).GT.5) GO TO 100
      IGO = 1
      GO TO 102
  100 IF (NUAC(5).GT.10) GO TO 101
      IGO = 2
      GO TO 102
  101 IGO = 3
  102 LENTRY = 0
      READ(IOIN,1001)M,N
      IF (M.EQ.0) GO TO 137
      IF(ISTEP.EQ.1)WRITE(IOUT,1002)M
  103 READ(IOIN,1001)(JL(I),JR(I),IT(I),IB(I),KBF(I),KBB(I),I=1,3)
      DO 104 I = 1,3
      IF (JL(I).EQ.0) GO TO 105
      LENTRY = LENTRY+1
C
C MESSAGE FOR MSX
      IF ( LENTRY .GE. MSX ) THEN
      WRITE(6,'(1X,A)')
     &'** MESSAGE FROM LENTRY IN SUBROUTINE OVER ** '
      WRITE(6,'(1X,A)')
     &'INSUFFICIENT MESH AREA NUMBER MSX.'
      WRITE(6,'(1X,A,I5)')
     &'CURRENT NUMBER FOR MSX IS ',MSX
      WRITE(6,'(1X,A)')
     &'COULD YOU PLEASE CHECK YOUR NUMBER IMMEDIATERY.'
      WRITE(6,'(1X,A)')
     &'I AM WILLING TO YOUR QUICK RESPONCE. THANK YOU.'
      STOP
      ENDIF
C
      NOVER(1,LENTRY) = JL(I)
      NOVER(2,LENTRY) = JR(I)
      NOVER(3,LENTRY) = IT(I)
      NOVER(4,LENTRY) = IB(I)
      NOVER(5,LENTRY) = KBF(I)
      NOVER(6,LENTRY) = KBB(I)
  104 CONTINUE
      GO TO 103
  105 DO 116 L = 1,LENTRY
      IF ((NOVER(1,L).GT.0).AND.(NOVER(1,L).LE.JMAX)) GO TO 106
      NER(6) = 6
  106 IF ((NOVER(2,L).GT.0).AND.(NOVER(2,L).LE.JMAX)) GO TO 107
      NER(6) = 6
  107 IF (NOVER(1,L).LE.NOVER(2,L)) GO TO 108
      NER(6) = 6
  108 GO TO (116,109,109),IGO
  109 IF ((NOVER(3,L).GT.0).AND.(NOVER(3,L).LE.IMAX)) GO TO 110
      NER(6) = 6
  110 IF ((NOVER(4,L).GT.0).AND.(NOVER(4,L).LE.IMAX)) GO TO 111
      NER(6) = 6
  111 IF (NOVER(3,L).LE.NOVER(4,L)) GO TO 112
      NER(6) = 6
  112 GO TO (116,116,113),IGO
  113 IF ((NOVER(5,L).GT.0).AND.(NOVER(5,L).LE.KBMAX)) GO TO 114
      NER(6) = 6
  114 IF ((NOVER(6,L).GT.0).AND.(NOVER(6,L).LE.KBMAX)) GO TO 115
      NER(6) = 6
  115 IF (NOVER(5,L).LE.NOVER(6,L)) GO TO 116
      NER(6) = 6
  116 CONTINUE
      IF(ISTEP .NE. 1) GO TO 120
      GO TO (117,118,119),IGO
  117 WRITE(IOUT,1003)(NOVER(1,L),NOVER(2,L),L=1,LENTRY)
      GO TO 120
  118 WRITE(IOUT,1003)(NOVER(1,L),NOVER(2,L),NOVER(3,L),NOVER(4,L), L=1,
     &  LENTRY)
      GO TO 120
  119 WRITE(IOUT,1003)(NOVER(1,L),NOVER(2,L),NOVER(3,L),NOVER(4,L),
     & NOVER(5,L),NOVER(6,L),L=1,LENTRY)
  120 IF (NER(6).NE.6) GO TO 121
      IF(ISTEP.EQ.1)WRITE(IOUT,1004)
      STOP
  121 CONTINUE
      I1 = 1
      I2 = 1
      KB1 = 1
      KB2 = 1
      DO 136 LE = 1,LENTRY
      J1 = NOVER(1,LE)
      J2 = NOVER(2,LE)
      GO TO (124,122,122),IGO
  122 I1 = NOVER(3,LE)
      I2 = NOVER(4,LE)
      GO TO (124,124,123),IGO
  123 KB1 = NOVER(5,LE)
      KB2 = NOVER(6,LE)
  124 DO 135 KB = KB1,KB2
      DO 134 I = I1,I2
      DO 133 J = J1,J2
      IF(N.EQ.0) GO TO 798
      IF((KB.EQ.KB1).AND.(I.EQ.I1).AND.(J.EQ.J1)) GO TO 125
      GO TO 799
  798 CONTINUE
      IF ((LE.EQ.1).AND.(KB.EQ.KB1).AND.(I.EQ.I1).AND.(J.EQ.J1)) GO TO
     & 125
  799 CONTINUE
      L2 = NRGN(J,I,KB)
      VOL2 = PVOL(L2)
      T1 = ABS(VOL2/VOL1-1.0)
      IF (T1.GE.1.0E-6) GO TO 125
      IF (IND.EQ.0) GO TO 132
      GO TO 130
  125 CONTINUE
      L1 = NRGN(J,I,KB)
      VOL1 = PVOL(L1)
      IND = 0
      IF(N.GT.0) GO TO 800
      DO 126 KKBB = 1,KBMAX
      LREG = NRGN(J,I,KKBB)
      MM = NCOMP(LREG)
      IF (MM.NE.M) GO TO 126
      VOTM = PVOL(LREG)
      IF (ABS(VOTM/VOL1-1.0).LT.1.0E-6) GO TO 131
  126 CONTINUE
      DO 127 IIB = 1,IMAX
      LREG = NRGN(J,IIB,KB)
      MM = NCOMP(LREG)
      IF (MM.NE.M) GO TO 127
      VOTM = PVOL(LREG)
      IF (ABS(VOTM/VOL1-1.0).LT.1.0E-6) GO TO 131
  127 CONTINUE
      DO 128 JJB = 1,JMAX
      LREG = NRGN(JJB,I,KB)
      MM = NCOMP(LREG)
      IF (MM.NE.M) GO TO 128
      VOTM = PVOL(LREG)
      IF (ABS(VOTM/VOL1-1.0).LT.1.0E-6) GO TO 131
  128 CONTINUE
  800 CONTINUE
      LMAX = LMAX+1
      NNN1 = NNN1+1
      IND = 1
      IF (NNN1.LT.N222) GO TO 129
      IF(ISTEP.EQ.1)WRITE(IOUT,1005)
      STOP
  129 CONTINUE
      NCOMP(LMAX) = M
      PVOL(LMAX) = VOL1
  130 CONTINUE
      NRGN(J,I,KB) = LMAX
      GO TO 133
  131 CONTINUE
      NCOMP(LREG) = M
  132 CONTINUE
      NRGN(J,I,KB) = LREG
  133 CONTINUE
  134 CONTINUE
  135 CONTINUE
  136 CONTINUE
      GO TO 102
  137 MMAX = 0
      DO 138 L = 1,LMAX
      RVOL(L) = 0.0
      MMAX = MAX0(MMAX,NCOMP(L))
  138 CONTINUE
C
C MESSAGE FOR ZDX ZNEX
      IF ( MMAX .GE. ZDX ) THEN
      WRITE(6,'(1X,A)')
     &'** MESSAGE FROM MMAX IN SUBROUTINE OVER ** '
      WRITE(6,'(1X,A)')
     &'INSUFFICIENT ZONE AREA NUMBER ZDX.'
      WRITE(6,'(1X,A,I5)')
     &'CURRENT NUMBER FOR ZDX IS ',ZDX
      WRITE(6,'(1X,A)')
     &'COULD YOU PLEASE CHECK YOUR NUMBER IMMEDIATERY.'
      WRITE(6,'(1X,A)')
     &'I AM WILLING TO YOUR QUICK RESPONCE. THANK YOU.'
      STOP
      ENDIF
C
C MESSAGE FOR ZDX ZNEX
      IF ( MMAX .GE. ZNEX) THEN
      WRITE(6,'(1X,A)')
     &'** MESSAGE FROM MMAX IN SUBROUTINE OVER ** '
      WRITE(6,'(1X,A)')
     &'INSUFFICIENT EXPANDED-ZONE AREA NUMBER ZNEX.'
      WRITE(6,'(1X,A,I5)')
     &'CURRENT NUMBER FOR ZNEX IS ',ZNEX
      WRITE(6,'(1X,A)')
     &'COULD YOU PLEASE CHECK YOUR NUMBER IMMEDIATERY.'
      WRITE(6,'(1X,A)')
     &'I AM WILLING TO YOUR QUICK RESPONCE. THANK YOU.'
      STOP
      ENDIF
C
      DO 141 KB = 1,KBVX
      DO 140 I = 1,IVX
      DO 139 J = 1,JVX
      L = NRGN(J,I,KB)
      RVOL(L) = RVOL(L)+PVOL(L)
  139 CONTINUE
  140 CONTINUE
  141 CONTINUE
  142 CONTINUE
      RETURN
 1000 FORMAT(1H0,'MESH OVERLAY INPUT')
 1001 FORMAT(18I4)
 1002 FORMAT(1H0,'ZONE NUMBER',I3)
 1003 FORMAT(1H ,36I3)
 1004 FORMAT(1H0,'ERROR STOP NUMBER 6'/
     &     ' SOME ENTRY ON THE OVERLAY CARDS 006 IS LESS EQUAL TO 0,',
     &     'GREATER THAN MAXIMUM NUMBER OF ROWS, COLUMNS, PLANES, OR'/
     &     ' SOME FIRST ENTRY GREATER THAN THE SECOND ENTRY.')
 1005 FORMAT(1H0,'ERROR STOP NUMBER 0'/
     & 1H ,'STORAGE EXCEEDED IN OVERLAY CALCULATION')
      END
