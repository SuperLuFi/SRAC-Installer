CMASH -82.2 ***CITATION*** REGION VOLUMES AND MESH SPACING /CF - CRSH
C                          FOR DIMENSION SEARCH
C
      SUBROUTINE MASH(RVOL,PVOL,LVX,IND,NOUT,INEG)
C
CDEL  INTEGER RGX , MSX , ZNEX , ZDX , WZX
CDEL  PARAMETER ( RGX=100, MSX=211, ZDX=200, ZNEX=1000, WZX=100 )
      INCLUDE  'CITPMINC'
C
      REAL *8 XDEL,ADR,YDELSQ,XNIPTS,XNJPTS,XNKPTS,TEMP,ZXYR,YDIST,
     & XDIST,ZDIST,YDEL,ZDEL,AXYR,XDIST1,XDIST2,YDIST1,YDIST2,XNTOPS,U1,
     &  U2,H,H1,H2
C
      COMMON/ALSUB/BLSUB(30),TITL1(18),TITL2(18),IMAX,JMAX,KBMAX,KMAX,
     & LMAX,MMAX, NMAX,IMXP1,JMXP1,KBMXP1,NSETMX,NTO,MM1VX,KM1VX,IOIN,
     & IOUT,IOSIG,IOFLX,IO1,IO2,IO3,IO4,IO7,NER(100), IX(200),INNO(100),
     &  NGC(24),IEDG(24),ITMX(24),TIMX(6), GLIM(6),NDPL(24),IEDP1(24),
     & IEDP2(24),IEDP3(24), DPLH(6),NUAC(24),EPI(6),XMIS(6),NSRH(24),
     & XSRH1(6), XTR1(WZX),XTR2(WZX),NXTR1(WZX),NXTR2(WZX),SPARE(200),
     & IXPUT(200),XPUT(200)
      COMMON/AMESH/BMESH(30),NREGI,NREGJ,NREGKB,XSHI(RGX),XSHJ(RGX),
     & XSHKB(RGX), MSHI(RGX),MSHJ(RGX),MSHKB(RGX),Y(MSX),YY(MSX), X(MSX)
     &  ,XX(MSX),Z(MSX),ZZ(MSX), ZONVOL(ZNEX),AVZPD(ZNEX),PDI(MSX),
     & PDJ(MSX) , PDK(MSX)
C
      DIMENSION RVOL(LVX),PVOL(LVX)
      DIMENSION NX(6),TX(6)
C
C     SET NXY TO SAME NUMBER AS THE DIMENSION OF XX AND YY
      NXY = MSX
C
      NDIM = IX(25)
      NGEM = IX(26)
      IF (IND.GT.0) GO TO 165
      MGEM = 0
      H1 = 6*MSHI(1)*MSHJ(1)
      H2 = XSHI(1)*XSHJ(1)
      H = DSQRT(H2/H1)
      IF ((NGEM.EQ.8).OR.(NGEM.EQ.12)) MGEM = 8
  100 NRGNO = 0
      MESHGE = 0
      DO 118 KBR = 1,NREGKB
      NKBPTS = MSHKB(KBR)
      ZDIST = XSHKB(KBR)
      YDIST2 = 0.D+0
      DO 117 IR = 1,NREGI
      NIPTS = MSHI(IR)
      U1 = NIPTS
      YDIST = XSHI(IR)
      YDIST1 = YDIST2
      YDIST2 = YDIST2+XSHI(IR)
      XDIST2 = 0.D+0
      DO 116 JR = 1,NREGJ
      XDIST1 = XDIST2
      XDIST2 = XDIST2+XSHJ(JR)
      NJPTS = MSHJ(JR)
      U2 = NJPTS
      XDIST = XSHJ(JR)
      NTOPTS = NKBPTS*NIPTS*NJPTS
      XNTOPS = FLOAT(NTOPTS)
      NRGNO = NRGNO+1
      GO TO (101,102,103,104,105,106,107,108,109,110,111,112,113,114),
     & NGEM
  101 AXYR = XDIST
      GO TO 115
  102 AXYR = 3.141593*(XDIST2**2-XDIST1**2)
      GO TO 115
  103 AXYR = 4.0*3.141593/3.0*(XDIST2**3-XDIST1**3)
      GO TO 115
  104 AXYR = 1.0
      GO TO 115
  105 GO TO 115
  106 AXYR = YDIST*XDIST
      GO TO 115
  107 AXYR = 3.141593*(XDIST2**2-XDIST1**2)*YDIST
      GO TO 115
  108 AXYR = XDIST*(YDIST2**2-YDIST1**2)/2.0
      GO TO 115
  109 AXYR = 0.3608439* ((XDIST/U2)**2+(YDIST/U1)**2+ 0.4*XDIST*YDIST/
     & (U2*U1))*XNTOPS
      GO TO 115
  110 CONTINUE
      AXYR = 0.8660254040*XDIST*YDIST
C     SQRT(3)/2 = 0.8660254040
      GO TO 115
  111 AXYR = ZDIST*YDIST*XDIST
      GO TO 115
  112 AXYR = 0.5*ZDIST*XDIST*(YDIST2**2-YDIST1**2)
      GO TO 115
  113 AXYR = 0.3608439*ZDIST*((XDIST/U2)**2+(YDIST/U1)**2+ 0.4*XDIST*
     & YDIST/(U2*U1))*XNTOPS
      GO TO 115
  114 CONTINUE
      AXYR = 0.8660254040*XDIST*YDIST*ZDIST
C     SQRT(3)/2 = 0.8660254040
  115 RVOL(NRGNO) = AXYR
      PVOL(NRGNO) = AXYR/XNTOPS
      IF ((NGEM.NE.9).OR.(NGEM.NE.13)) GO TO 116
      IF (NRGNO.EQ.1) GO TO 116
      IF (PVOL(1).NE.PVOL(NRGNO)) MESHGE = 1
  116 CONTINUE
  117 CONTINUE
  118 CONTINUE
      KB = 0
      ZZ(1) = 0.0
      ZXYR=0.D+0
      ADR = 0.0
      DO 126 KBR = 1,NREGKB
      NKBPTS = MSHKB(KBR)
      XNKPTS = FLOAT (NKBPTS)
      ZDEL = XSHKB(KBR)/XNKPTS
      DO 125 KNR = 1,NKBPTS
      KB = KB+1
      ZXYR=ZXYR+ZDEL
      IF (KB-1) 119,119,120
  119 AXYR=0.5D+0*ZDEL
      GO TO 123
  120 IF (KNR-1) 121,121,122
  121 AXYR = AXYR + 0.5*(ZDEL+ADR)
      GO TO 123
  122 AXYR=AXYR+ZDEL
  123 ZZ(KB+1)=ZXYR
      Z(KB)=AXYR
      IF (KNR-NKBPTS) 125,124,124
  124 ADR = ZDEL
  125 CONTINUE
  126 CONTINUE
      NREGIJ = NREGI
      IF (MGEM-8) 128,127,128
  127 NREGIJ = NREGJ
  128 I = 0
      YY(1) = 0.0
      ZXYR=0.D+0
      ADR = 0.0
      DO 140 IR = 1,NREGIJ
      IF (MGEM-8) 129,130,129
  129 NIPTS = MSHI(IR)
      XNIPTS = FLOAT(NIPTS)
      XDEL = XSHI(IR)/XNIPTS
      GO TO 131
  130 NIPTS = MSHJ(IR)
      XNIPTS = FLOAT(NIPTS)
      XDEL = XSHJ(IR)/XNIPTS
  131 DO 139 INR = 1,NIPTS
      I=I+1
      IF ((NGEM.NE.10).AND.(NGEM.NE.14)) GO TO 132
      Y(I) = YY(I)+H
      YY(I+1) = YY(I)+3.0*H
      PDI(I) = YY(I+1)-H
      GO TO 139
  132 CONTINUE
      ZXYR=ZXYR+XDEL
      IF (I-1) 133,133,134
  133 AXYR=0.5D+0*XDEL
      GO TO 137
  134 IF (INR-1) 135,135,136
  135 AXYR=AXYR+0.5*(XDEL+ADR)
      GO TO 137
  136 AXYR=AXYR+XDEL
  137 Y(I)=AXYR
      YY(I+1)=ZXYR
      IF (INR-NIPTS) 139,138,138
  138 ADR = XDEL
  139 CONTINUE
  140 CONTINUE
      ZTEMP = 1.0/3.0
      J = 0
      XX(1) = 0.0
      ZXYR=0.D+0
      ZDEL1 = ZZ(2)-ZZ(1)
      YDEL1 = YY(2)-YY(1)
      IF (NGEM-5) 141,141,142
  141 T1 = 1.0
      GO TO 145
  142 IF (NGEM-11) 143,144,144
  143 T1 = YDEL1
      GO TO 145
  144 T1 = YDEL1*ZDEL1
  145 CONTINUE
      YDELSQ = YY(2)**2-YY(1)**2
      NREGIJ = NREGJ
      IF (MGEM-8) 147,146,147
  146 NREGIJ = NREGI
  147 DO 157 JR = 1,NREGIJ
      IF (MGEM.EQ.8) GO TO 148
      NJPTS = MSHJ(JR)
      TEMP = PVOL(JR)/T1
      XNJPTS = FLOAT(NJPTS)
      XDEL = XSHJ(JR)/XNJPTS
      GO TO 149
  148 NJPTS = MSHI(JR)
      JS = (JR-1)*NREGJ+1
      TEMP = PVOL(JS)/T1
      XNJPTS = FLOAT(NJPTS)
      XDEL = XSHI(JR)/XNJPTS
  149 DO 156 JNR = 1,NJPTS
      J = J+1
      GO TO (150,151,154,156,156,150,151,152,150,153,150,152,150,153),
     & NGEM
  150 ZXYR=ZXYR+XDEL
      GO TO 155
  151 ZXYR= DSQRT(TEMP/3.141593+ZXYR**2)
      GO TO 155
  152 ZXYR= DSQRT(2.0*TEMP+ZXYR **2)
      GO TO 155
  153 CONTINUE
      X(J) = XX(J)+H
      XX(J+1) = X(J)+H
      GO TO 156
  154 ZXYR= (3.0*TEMP/(4.0*3.141593)+ZXYR**3)**ZTEMP
  155 CONTINUE
      XX(J+1)=ZXYR
  156 CONTINUE
  157 CONTINUE
      IF ((NGEM.EQ.10).OR.(NGEM.EQ.14)) GO TO 164
      JXLM = JMAX
      IF (MGEM.EQ.8) JXLM = IMAX
      DO 161 J = 1,JXLM
      GO TO (158,159,160,161,161,158,159,159,158,161,158,159,158,161),
     & NGEM
  158 X(J) = (XX(J+1)+XX(J))*0.5
      GO TO 161
  159 X(J) = SQRT((XX(J+1)**2+XX(J)**2)*0.5)
      GO TO 161
  160 X(J) = ((XX(J+1)**3+XX(J)**3)*0.5)**ZTEMP
  161 CONTINUE
      IF (MGEM-8) 164,162,164
  162 DO 163 N = 1,NXY
      TEMP1 = XX(N)
      TEMP2 = YY(N)
      XX(N) = TEMP2
      YY(N) = TEMP1
      TEMP1 = X(N)
      TEMP2 = Y(N)
      X(N) = TEMP2
      Y(N) = TEMP1
  163 CONTINUE
  164 CONTINUE
      IF (NOUT.NE.0) GO TO 165
      IF (INEG.GT.0) GO TO 165
      GO TO 184
  165 CONTINUE
      GO TO (166,168,169,169,169,170,173,174,175,176,177,181,182,183),
     & NGEM
  166 WRITE(IOUT,1005)XX(JMAX+1)
  167 WRITE(IOUT,1006)
      WRITE(IOUT,1007)(MSHJ(J),XSHJ(J),J=1,NREGJ)
      WRITE(IOUT,1008)JMAX
      WRITE(IOUT,1009)
      WRITE(IOUT,1010)(J,XX(J),J=2,JMXP1)
      WRITE(IOUT,1011)
      WRITE(IOUT,1010)(J,X(J),J=1,JMAX)
      GO TO 184
  168 WRITE(IOUT,1012)XX(JMAX+1)
      GO TO 167
  169 WRITE(IOUT,1013)XX(JMAX+1)
      GO TO 167
  170 WRITE(IOUT,1014)XX(JMAX+1),YY(IMAX+1)
  171 WRITE(IOUT,1006)
      WRITE(IOUT,1007)(MSHJ(J),XSHJ(J),J=1,NREGJ)
      WRITE(IOUT,1015)
      WRITE(IOUT,1007)(MSHI(I),XSHI(I),I=1,NREGI)
      WRITE(IOUT,1016)JMAX,IMAX
      WRITE(IOUT,1009)
      WRITE(IOUT,1010)(J,XX(J),J=2,JMXP1)
      WRITE(IOUT,1017)
      WRITE(IOUT,1010)(I,YY(I),I=2,IMXP1)
      WRITE(IOUT,1011)
      WRITE(IOUT,1010)(J,X(J),J=1,JMAX)
      IF (NGEM.NE.10) GO TO 172
      WRITE(IOUT,1000)
      WRITE(IOUT,1001)(I,Y(I),PDI(I),I=1,IMAX)
      GO TO 184
  172 CONTINUE
      WRITE(IOUT,1017)
      WRITE(IOUT,1010)(I,Y(I),I=1,IMAX)
      GO TO 184
  173 WRITE(IOUT,1018)XX(JMAX+1),YY(IMAX+1)
      GO TO 171
  174 WRITE(IOUT,1019)XX(JMAX+1),YY(IMAX+1)
      GO TO 171
  175 WRITE(IOUT,1020)XX(JMAX+1),YY(IMAX+1)
      GO TO 171
  176 CONTINUE
      WRITE(IOUT,1002)XX(JMAX+1),YY(IMAX+1)
      GO TO 171
  177 WRITE(IOUT,1021)XX(JMAX+1),YY(IMAX+1),ZZ(KBMAX+1)
  178 WRITE(IOUT,1006)
      WRITE(IOUT,1007)(MSHJ(J),XSHJ(J),J=1,NREGJ)
      WRITE(IOUT,1015)
      WRITE(IOUT,1007)(MSHI(I),XSHI(I),I=1,NREGI)
      WRITE(IOUT,1022)
      WRITE(IOUT,1007)(MSHKB(I),XSHKB(I),I=1,NREGKB)
      WRITE(IOUT,1023)JMAX,IMAX,KBMAX
      WRITE(IOUT,1009)
      WRITE(IOUT,1010)(J,XX(J),J=2,JMXP1)
      WRITE(IOUT,1017)
      WRITE(IOUT,1010)(I,YY(I),I=2,IMXP1)
      WRITE(IOUT,1024)
      WRITE(IOUT,1010)(KB,ZZ(KB),KB=2,KBMXP1)
      WRITE(IOUT,1011)
      WRITE(IOUT,1010)(J,X(J),J=1,JMAX)
      IF (NGEM.NE.14) GO TO 179
      WRITE(IOUT,1000)
      WRITE(IOUT,1001)(I,Y(I),PDI(I),I=1,IMAX)
      GO TO 180
  179 CONTINUE
      WRITE(IOUT,1017)
      WRITE(IOUT,1010)(I,Y(I),I=1,IMAX)
  180 CONTINUE
      WRITE(IOUT,1024)
      WRITE(IOUT,1010)(KB, Z(KB ),KB=1,KBMAX)
      GO TO 184
  181 WRITE(IOUT,1025)XX(JMAX+1),YY(IMAX+1),ZZ(KBMAX+1)
      GO TO 178
  182 WRITE(IOUT,1026)XX(JMAX+1),YY(IMAX+1),ZZ(KBMAX+1)
      GO TO 178
  183 CONTINUE
      WRITE(IOUT,1003)XX(JMAX+1),YY(IMAX+1),ZZ(KBMAX+1)
      GO TO 178
  184 CONTINUE
      IF (IND.GT.0) GO TO 194
      DO 185 J = 1,JMAX
      IF (XX(J)-XX(J+1)) 185,188,188
  185 CONTINUE
      DO 186 I = 1,IMAX
      IF (YY(I)-YY(I+1)) 186,188,188
  186 CONTINUE
      DO 187 KB = 1,KBMAX
      IF (ZZ(KB)-ZZ(KB+1)) 187,187,188
  187 CONTINUE
      GO TO 189
  188 STOP 1357
  189 IF (MESHGE.EQ.0) GO TO 190
      WRITE(IOUT,1027)
  190 CONTINUE
      IF ((NGEM.NE.10).AND.(NGEM.NE.14)) GO TO 194
      DO 193 I = 1,NREGI
      T1 = 2*MSHI(I)
      T2 = XSHI(I)
      DO 192 J = 1,NREGJ
      T3 = MSHJ(J)
      T4 = XSHJ(J)
      T5 = (T1*T4)/(T2*T3)
      T6 = ABS(T5-1.0)
      IF (T6.LE.0.00001) GO TO 191
      WRITE(IOUT,1004)I,J,T1,T4,T3,T2,T5
  191 CONTINUE
  192 CONTINUE
  193 CONTINUE
  194 CONTINUE
      RETURN
 1000 FORMAT(1H0,'    I   ODD J  EVEN J')
 1001 FORMAT(1H ,I5,2F8.3,I5,2F8.3,I5,2F8.3,I5,2F8.3,I5,2F8.3,I5,2F8.3)
 1002 FORMAT(2H0 ,'TWO DIMENSIONAL TRIANGULAR GEOMETRY (X,Y)'
     & ,2H  ,'WIDTH',1PE14.6,2H  ,'HEIGHT',E14.6//)
 1003 FORMAT(2H0 ,'THREE DIMENSIONAL TRIANGULAR GEOMETRY (X,Y,Z)'
     & ,2H  ,'WIDTH',1PE14.6,2H  ,'HEIGHT',E14.6,2H  ,'DEPTH',E14.6//)
 1004 FORMAT('0******WARNING--TRIANGLES NOT EQULATERAL FOR HORIZONTAL-',
     &'VERTICAL REGION',2I3/' 2*I, WIDTH, J, HEIGHT, AND (2*I*WIDTH)',
     &'/(J*HEIGHT) ARE',1P5E13.5)
 1005 FORMAT('0 ONE DIMENSIONAL SLAB GEOMETRY (X)  WIDTH',1PE14.6/
     &  /)
 1006 FORMAT(2H0 ,'REGION SPECIFICATIONS'/'    PTS  REGION WIDTH')
 1007 FORMAT(1H ,I6,1PE14.6,I6,E14.6,I6,E14.6,I6,E14.6,I6,E14.6, I6,
     & E14.6)
 1008 FORMAT(2H0 ,'X-DIR. POINTS',I4)
 1009 FORMAT(2H0 ,'DISTANCES TO MESH INTERVAL',1H ,'INTERFACES'/
     & 1H0 ,'    J   DIST.')
 1010 FORMAT(1H ,I5,F8.3,I5,F8.3,I5,F8.3,I5,F8.3,I5,F8.3,I5,F8.3, I5,
     & F8.3,I5,F8.3,I5,F8.3)
 1011 FORMAT(2H0 ,'DISTANCES TO FLUX POINTS'/ 1H0,'    J   DIST.')
 1012 FORMAT(2H0 ,'ONE DIMENSIONAL CYLINDRICAL GEOMETRY (R)',
     & 2H  ,'WIDTH',1PE14.6//)
 1013 FORMAT(2H0 ,'ONE DIMENSIONAL SPHERICAL GEOMETRY (R)'
     & ,2H  ,'WIDTH',1PE14.6//)
 1014 FORMAT(2H0 ,'TWO DIMENSIONAL SLAB GEOMETRY (X,Y)'
     & ,2H  ,'WIDTH',1PE14.6,2H  ,'HEIGHT',E14.6//)
 1015 FORMAT('0   PTS  REGION HEIGHT')
 1016 FORMAT('0 X-DIR. POINTS',I4,9X,'Y-DIR. POINTS',I4)
 1017 FORMAT('0    I   DIST.')
 1018 FORMAT('0 TWO DIMENSIONAL CYLINDRICAL GEOMETRY (R,Z)',
     & '  WIDTH',1PE14.6,'  HEIGHT',E14.6//)
 1019 FORMAT('0 TWO DIMENSIONAL CIRCULAR GEOMETRY (R,THETA)',
     & 2X,'WIDTH',1PE14.6,2X,'HEIGHT',E14.6//)
 1020 FORMAT('0 TWO DIMENSIONAL HEXAGIONAL GEOMETRY (X,Y)',
     & 2X,'WIDTH',1PE14.6,2X,'HEIGHT',E14.6//)
 1021 FORMAT('0 THREE DIMENSIONAL SLAB GEOMETRY (X,Y,Z)',
     & 2X,'WIDTH',1PE14.6,2X,'HEIGHT',E14.6,'  DEPTH',E14.6//)
 1022 FORMAT('0   PTS  REGION DEPTH')
 1023 FORMAT('0  X-DIR. POINTS',I4,'         Y-DIR. POINTS',I4,
     & '         Z-DIR. POINTS',I4)
 1024 FORMAT('0    KB   DIST')
 1025 FORMAT('0 THREE DIMENSIONAL CYLINDRICAL GEOMETRY (R,THETA,Z)',
     & 2X,'WIDTH',1PE14.6,'  HEIGHT',E14.6,'  DEPTH',E14.6//)
 1026 FORMAT('0 THREE DIMENSIONAL HEXAGIONAL GEOMETRY (X,Y,Z)',
     & '  WIDTH',1PE14.6,'  HEIGHT',E14.6,'  DEPTH',E14.6//)
 1027 FORMAT('0******WARNING--REGION VOLUMES NOT EQUAL IN HEX GEOM.')
      END
