CCNST --101 ***CITATION*** EQ. CNSTS. FOR 1,2-D/ CF-EIGN
C
      SUBROUTINE CNST(NRGN, SCAC,DCONB, DCONR,F1, SIG,PTSA,NCOMP,PVOL,
     & BBND,BND, IVX,JVX,KVX,LVX,MVX,IVXP1,JVXP1, IVZ,KVZ, IOVX,IOVZ,A,
     & MEMORY,AIO,IX3738)
C
CDEL  INTEGER RGX , MSX , ZNEX , ZDX , WZX
CDEL  PARAMETER ( RGX=100, MSX=211, ZDX=200, ZNEX=1000, WZX=100 )
      INCLUDE  'CITPMINC'
C
      REAL*8 TPTSA,D1,D2,D3,D4,D5,D6,D7
C
      COMMON/ALSUB/BLSUB(30),TITL1(18),TITL2(18),IMAX,JMAX,KBMAX,KMAX,
     & LMAX,MMAX, NMAX,IMXP1,JMXP1,KBMXP1,NSETMX,NTO,MM1VX,KM1VX,IOIN,
     & IOUT,IOSIG,IOFLX,IO1,IO2,IO3,IO4,IO7,NER(100), IX(200),INNO(100),
     &  NGC(24),IEDG(24),ITMX(24),TIMX(6), GLIM(6),NDPL(24),IEDP1(24),
     & IEDP2(24),IEDP3(24), DPLH(6),NUAC(24),EPI(6),XMIS(6),NSRH(24),
     & XSRH1(6), XTR1(WZX),XTR2(WZX),NXTR1(WZX),NXTR2(WZX),SPARE(200),
     & IXPUT(200),XPUT(200)
      COMMON/AMESH/BMESH(30),NREGI,NREGJ,NREGKB,XSHI(RGX),XSHJ(RGX),
     & XSHKB(RGX), MSHI(RGX),MSHJ(RGX),MSHKB(RGX),Y(MSX),YY(MSX), X(MSX)
     &  ,XX(MSX),Z(MSX),ZZ(MSX), ZONVOL(ZNEX),AVZPD(ZNEX),PDI(MSX),
     & PDJ(MSX) , PDK(MSX)
      COMMON/AFLUX/BFLUX(30),KXMN8,NIT,NIIT,NIIIT,JXP1,KSCT1,KSCT2,
     & ISTART,IEP, VRGP1,VRGP2,VRGP3,VRG1,VRG2,VRGK1,VRGK2,XABS,PROD,
     & XLEK,RMX,RMN,XKEF1,XKEF2,XKEF3,EXFC1,EXFC2,EXFC3, NI3,IEXTR,
     & IRECV,VRGABS,LO3,LO4,XLAMDA,EPI1,EPI2, BETTA,SUMXI,IX25,IX28,I,J,
     &  KB,K,ITMAX,ITIME, BET(MSX),DEL(MSX)
      COMMON/ABURN/BBURN(30),NSIG1(50),NSIG2(50),NSIG3(50),N1N2R(2,ZDX),
     &  NSIG4(50),NSIG5(50),NSIG6(50),NJM(50),NJMM(50),NJNQ(50),NCH(50),
     &  NZON(ZDX),NXSET(ZDX),NXODR(ZDX),IDXSET(ZDX),NCLASS(ZDX),NDP(ZDX)
     &  , XNAME(3,ZDX)
C
      DIMENSION NRGN(JVX,IVX), SCAC(KVX,MVX,KVX),DCONB(JVX,IVXP1,IOVX),
     & DCONR(JVXP1,IVZ,IOVZ), F1(KVX,MVX),SIG(KVX,MVX,12),PTSA(JVX,IVX,
     & IOVX)
      DIMENSION NCOMP(LVX),PVOL(LVX)
      DIMENSION BBND(KVX),BND(6,KVX)
      DIMENSION AIO(IX3738)
      DIMENSION A(MEMORY)
C
C     INRB = 1  ORDINARY
C     INRB = 2  PERIODIC(REPEATING)
C     INRB = 3  90 DEGREE ROTATIONAL
C     INRB = 4  180 DEGREE ROTATIONAL
C
      KKK = 1
      INRB=IX(72)+1
      KMAXP1 = KMAX + 1
      IO14 = IX(81)
      REWIND IO14
      GO TO (107,107,102,100),INRB
  100 I=IVX/2
      DO 101J=1,I
      K=IVX+1-J
      TAL=(YY(J)-Y(J))/(Y(K)-YY(K+1))
      IF (NUAC(5).EQ.10) TAL=(PDI(I)-YY(I))/(YY(K+1)-Y(K))
      EPICH = ABS(TAL-1.0)
      IF (EPICH.GT.1.0E-4) GO TO 103
  101 CONTINUE
      GO TO 107
  102 CONTINUE
      IDA = IVX
      IF (NUAC(5).EQ.10) IDA = 2*IVX
      IF (JVX.EQ.IDA) GO TO 104
  103 JB=32
      WRITE(IOUT,1000) JB,I,J
      WRITE(IOUT,2000)
      STOP
  104 CONTINUE
      J = 1
      DO 106 I = 1,IVX
      TAL=Y(I)/X(I)
      IF (NUAC(5).NE.10.OR.I.EQ.1) GO TO 105
      J=J+2
      TAL=(Y(I)-PDI(I-1))/(X(J)-X(J-1))
  105 EPICH = ABS(TAL - 1.0)
      IF (EPICH.GT.1.0E-4) GO TO 103
  106 CONTINUE
  107 CONTINUE
      IX37 = IX(37)
      IX38 = IX(38)
      IO15 = IX(82)
      IOADJ = IO15
      IF (IX(71).GT.0) IOADJ = IO2
      IF (IX37.GT.0) REWIND IOADJ
      IF (IX(71).GT.0) IX(5) = IX(17)
      EPICH=1.0E-5
      SPARE(51) = -1.0E+30
      SPARE(57) = -1.0E+30
      N17 = NUAC(17)
      SQUIRE=1.1547005
      IF (N17) 114,114,108
  108 IF (XMIS(2)) 114,109,109
  109 DO 113 K = 1,KMAX
      IF (XMIS(2)) 113,110,111
  110 T1 = 0.4692
      GO TO 112
  111 T1 = XMIS(2)
  112 BBND(K) = T1
  113 CONTINUE
  114 CONTINUE
      NDIM = IX(25)
      NGEM = IX(26)
      PI = 3.141593
      IF (IX37.GT.0) GO TO 121
      DO 117 K = 1,IOVX
      DO 116 I = 1,IVXP1
      DO 115 J = 1,JVX
      DCONB(J,I,K) = 0.0
  115 CONTINUE
  116 CONTINUE
  117 CONTINUE
      DO 120 K = 1,IOVZ
      DO 119 I = 1,IVZ
      DO 118 J = 1,JVXP1
      DCONR(J,I,K) = 0.0
  118 CONTINUE
  119 CONTINUE
  120 CONTINUE
  121 CONTINUE
  122 CONTINUE
      SPARE(98) = 0.0
      DO 134 K = 1,KMAX
      READ(IO14) ((F1(KK,M),KK=1,KMAX),M=1,MMAX)
      DO 133 M=1,MMAX
      IF (M-N17) 128,123,128
  123 IF (XMIS(2)) 124,125,125
  124 IF (BBND(K)) 125,128,125
  125 DO 126 L=1,10
      SIG(K,M,L) = 0.0
  126 CONTINUE
      DO 127 KK = 1,KMAX
      SCAC(K,M,KK) = 0.0
  127 CONTINUE
      GO TO 133
  128 CONTINUE
C     SIG(K,M,9) = SIG(K,M,1)*SIG(K,M,6)
      SIG(K,M,9) = SIG(K,M,12)*SIG(K,M,6)
      SPARE(98) = SPARE(98) + SIG(K,M,8)
C***************************SEARCH OPTIONS******************************
      IF (IX(5).NE.-2) GO TO 131
      IF ((IX(44).EQ.0).AND.(IX(49).EQ.0)) GO TO 130
      IF (IX(49).GT.0) GO TO 129
      IF ((M.EQ.IX(44)).OR.(M.EQ.IX(45)).OR.(M.EQ.IX(46))
     & .OR.(M.EQ.IX(47)).OR.(M.EQ.IX(48))) GO TO 130
      GO TO 131
  129 IF (IX(49).NE.NCLASS(M)) GO TO 131
  130 SIG(K,M,5) = SIG(K,M,9)
      SIG(K,M,9) = 0.0
  131 CONTINUE
      DO 132 KK = 1,KMAX
      SCAC(K,M,KK) = F1(KK,M)
  132 CONTINUE
  133 CONTINUE
  134 CONTINUE
      REWIND IO14
      T1 = 0.0
      DO 141 K = 1,KMAX
      DO 140 M=1,MMAX
      TPTSA=0.D+0
      DO 135 KK = 1,KMAX
      TPTSA = TPTSA + SCAC(K,M,KK)
  135 CONTINUE
      SIG(K,M,2) = TPTSA
      TPTSA = TPTSA + SIG(K,M,3) + SIG(K,M,9)
      SIG(K,M,10) = TPTSA
      SIG(K,M,3) = SIG(K,M,10) - SIG(K,M,2) - SIG(K,M,9)
      IF ((SIG(K,M,10).EQ.0.0).OR.(SIG(K,M,5).EQ.0.0)) GO TO 136
      SPARE(51) = AMAX1(SPARE(51),SIG(K,M,5)/SIG(K,M,10))
C****************************SEARCH OPTIONS*****************************
  136 CONTINUE
      IF (IX(5).EQ.(-5)) GO TO 139
      IF ((IX(5).EQ.0).OR.(IX(5).GE.2)) GO TO 139
      IF ((IX(44).EQ.0).AND.(IX(49).EQ.0)) GO TO 138
      IF (IX(49).GT.0) GO TO 137
      IF ((M.EQ.IX(44)).OR.(M.EQ.IX(45)).OR.(M.EQ.IX(46))
     & .OR.(M.EQ.IX(47)).OR.(M.EQ.IX(48))) GO TO 138
      GO TO 139
  137 IF (IX(49).NE.NCLASS(M)) GO TO 139
  138 T1 = T1 + SIG(K,M,5)
  139 CONTINUE
  140 CONTINUE
  141 CONTINUE
C****************************SEARCH OPTIONS*****************************
      IF (IX(5).EQ.(-5)) GO TO 143
      IF ((IX(5).EQ.0).OR.(IX(5).GE.2)) GO TO 143
  142 IF (T1.NE.0.0) GO TO 143
      JB = 16
      WRITE(IOUT,1000) JB
      WRITE(IOUT,2001)
      STOP
  143 CONTINUE
      DO 243 KT1=1,KMAX
      K = KT1
      N = KT1
      IF (IX37.EQ.0) GO TO 149
      N = 1
      IF (IX(71).GT.0) K= KMAXP1 - KT1
      DO 145 I = 1,IVXP1
      DO 144 J = 1,JVX
      DCONB(J,I,1) = 0.0
  144 CONTINUE
  145 CONTINUE
      DO 148 K1= 1,IOVZ
      DO 147 I = 1,IVX
      DO 146 J = 1,JVXP1
      DCONR(J,I,K1)= 0.0
  146 CONTINUE
  147 CONTINUE
  148 CONTINUE
  149 CONTINUE
      DO 230 I = 1,IMAX
      T1 = YY(I+1)-YY(I)
      DELTT = 0.0
      IF (I-1) 151,151,150
  150 DELTT = YY(I)-Y(I-1)
      IF (NGEM.EQ.10) DELTT = YY(I)-PDI(I-1)
  151 DELT = Y(I)-YY(I)
      DELB = YY(I+1)-Y(I)
      IF (NGEM.EQ.10) DELB = YY(I+1)-PDI(I)
      DELBB = 0.0
      IF (I-IMAX) 152,153,153
  152 DELBB = Y(I+1)-YY(I+1)
  153 CONTINUE
      DO 229 J = 1,JMAX
      N2 = J
      NRN = NRGN(J,I)
      NOE = J-(J/2)*2
      DELLL = 0.0
      IF (J-1) 155,155,154
  154 DELLL = XX(J)-X(J-1)
      IF (NGEM.EQ.10) N2 = N2-1
  155 DELL = X(J)-XX(J)
      DELR = XX(J+1)-X(J)
      DELRR = 0.0
      IF (J-JMAX) 156,157,157
  156 DELRR = X(J+1)-XX(J+1)
  157 CONTINUE
      GO TO (163,164,166,169,169,163,164,165,158,167),NGEM
  158 TAT=SQUIRE*DELT
      TAL=SQUIRE*DELL
      TAR=DELR+DELL
      TAB=DELB+DELT
      TD1 = X(J+1)-X(J)
  159 TD2 = Y(I)-Y(I-1)
      IF (I.EQ.1) TD2 = 2*Y(I)
      IF (J.EQ.JMAX) TD1 = TD2
      DELHT = 0.5*SQRT(TD1**2+TD2**2-TD1*TD2)
      DELHB = DELHT
      TAR=TAL
      TAB=TAT
      TAH=SQUIRE*DELHT
      MH=0
      IF (J-JMAX) 160,162,162
  160 IF (I-1) 162,162,161
  161 NHN=NRGN(J+1,I-1)
      MH=NCOMP(NHN)
  162 GO TO 169
  163 TAL = T1
      TAR = T1
      TAT = XX(J+1)-XX(J)
      TAB = TAT
      GO TO 169
  164 TAL = 2.0*PI*XX(J)*T1
      TAR = 2.0*PI*XX(J+1)*T1
      TAT = PI*(XX(J+1)**2-XX(J)**2)
      TAB = TAT
      GO TO 169
  165 TAL = T1
      TAR = T1
      TAT = YY(I)*(XX(J+1)-XX(J))
      TAB = YY(I+1)*(XX(J+1)-XX(J))
      DELR = DELR*Y(I)
      DELRR = DELRR*Y(I)
      DELL = DELL*Y(I)
      DELLL = DELLL*Y(I)
      GO TO 169
  166 TAL = 4.0*PI*XX(J)**2
      TAR = 4.0*PI*XX(J+1)**2
      TAT = 0.0
      TAB = 0.0
      GO TO 169
  167 CONTINUE
      TAL = 3.46410*(X(J)-XX(J))
C     2*SQRT(3) = 3.46410
      TAR = 3.46410*(XX(J+1)-X(J))
      IF (NOE.EQ.0) GO TO 168
      TAT = 3.46410*(Y(I)-YY(I))
      TAB = 0.0
      GO TO 169
  168 CONTINUE
      TAB = 3.46410*(YY(I+1)-PDI(I))
      TAT = 0.0
  169 CONTINUE
      M = NCOMP(NRN)
      IF (I.EQ.1) GO TO 170
      NRNT = NRGN(J,I-1)
      IF ((NGEM.EQ.10).AND.(J.LT.JMAX)) NRNT = NRGN(J+1,I-1)
      MT = NCOMP(NRNT)
  170 IF (J.EQ.1) GO TO 171
      NRNL = NRGN(J-1,I)
      ML = NCOMP(NRNL)
      GO TO 172
  171 IF (INRB.NE.2) GO TO 172
      NRNL = NRGN(JMAX,I)
      ML = NCOMP(NRNL)
  172 IF (I.EQ.IMAX) GO TO 173
      NRNB = NRGN(J,I+1)
      IF ((NGEM.EQ.10).AND.(J.GT.1)) NRNB = NRGN(J-1,I+1)
      MB = NCOMP(NRNB)
      GO TO 174
  173 IF (INRB.NE.3) GO TO 174
      NRNB=NRGN(JVX,J)
      IF (NGEM.EQ.10) NRNB = NRGN(JVX,J/2)
      MB=NCOMP(NRNB)
      DELB=XX(JVXP1)-X(JVX)
  174 IF (J.EQ.JMAX) GO TO 175
      NRNR = NRGN(J+1,I)
      MR = NCOMP(NRNR)
      GO TO 179
  175 GO TO (179,176,177,178),INRB
  176 CONTINUE
      NRNR = NRGN(1,I)
      MR = NCOMP(NRNR)
      DELRR = X(1)
      IF(NGEM.EQ.8) DELRR = DELRR*Y(I)
      GO TO 179
  177 CONTINUE
      NRNR=NRGN(I,IVX)
      IF (NGEM.EQ.10) NRNR = NRGN(2*I,IVX)
      MR=NCOMP(NRNR)
      DELRR=YY(IVXP1)-Y(IVX)
      IF (NGEM.EQ.10) DELRR = YY(IVXP1)-PDI(IVX)
      GO TO 179
  178 CONTINUE
      NRNR=NRGN(JVX,IVXP1-I)
      MR=NCOMP(NRNR)
      DELRR=DELR
  179 CONTINUE
      IF (M.NE.N17) GO TO 180
      IF (XMIS(2).GE.0.0) GO TO 196
      IF (BBND(K).NE.0.0) GO TO 196
  180 IF (I.GT.1) GO TO 181
C     DCONB(J,I,N) = BND(2,K)*TAT/ (1.0+DELT*BND(2,K)/SIG(K,M,1))
      DCONB(J,I,N) = BND(2,K)*TAT/ (1.0+DELT*BND(2,K)/SIG(K,M,11))
  181 IF (J.GT.1) GO TO 182
      IF (INRB.EQ.2) GO TO 182
      DCONR(J,I,N) = BND(1,K)*TAL/ (1.0+DELL*BND(1,K)/SIG(K,M,1))
  182 IF (I.LT.IMAX) GO TO 183
C     DCONB(N2,I+1,N) = BND(4,K)*TAB/ (1.0+DELB*BND(4,K)/SIG(K,M,1))
      DCONB(N2,I+1,N) = BND(4,K)*TAB/ (1.0+DELB*BND(4,K)/SIG(K,M,11))
      IF (DCONB(N2,I+1,N).EQ.0.0) DCONB(N2,I+1,N) = 4096.0E-13
  183 IF (J.LT.JMAX) GO TO 184
      IF (INRB.GT.1) GO TO 184
      DCONR(J+1,I,N) = BND(3,K)*TAR/ (1.0+DELR*BND(3,K)/SIG(K,M,1))
      IF (DCONR(J+1,I,N).EQ.0.0) DCONR(J+1,I,N) = 4096.0E-13
      GO TO 185
  184 DCONR(J+1,I,N) = SIG(K,MR,1)*TAR/(DELRR+SIG(K,MR,1)*DELR/ SIG(K,M,
     &  1))
      IF (DCONR(J+1,I,N).EQ.0.0) DCONR(J+1,I,N) = 4096.0E-13
  185 IF (I.GE.IMAX) GO TO 186
C     DCONB(N2,I+1,N)= TAB*SIG(K,MB,1)/(DELBB+DELB*SIG(K,MB,1)/ SIG(K,M,
      DCONB(N2,I+1,N)=TAB*SIG(K,MB,11)/(DELBB+DELB*SIG(K,MB,11)/ SIG(K,
     &  M,11))
      IF (DCONB(N2,I+1,N).EQ.0.0) DCONB(N2,I+1,N) = 4096.0E-13
  186 CONTINUE
      IF (N17.LE.0) GO TO 196
      IF (XMIS(2).GE.0.0) GO TO 187
      IF (BBND(K).EQ.0.0) GO TO 196
  187 IF (IMAX.LE.1) GO TO 192
      IF (I.NE.IMAX) GO TO 189
      IF (INRB.NE.3) GO TO 190
      IF (MB.NE.N17) GO TO 190
C     DCONB(J,I+1,N) = BBND(K)*TAB/(1.0+DELB*BBND(K)/SIG(K,M,1))
      DCONB(J,I+1,N) = BBND(K)*TAB/(1.0+DELB*BBND(K)/SIG(K,M,11))
      IF (DCONB(J,I+1,N).EQ.0.0) DCONB(J,I+1,N) = 4096.0E-13
      IF (NGEM.EQ.10) GO TO 188
      DCONR(JVXP1,I,N)=DCONB(J,I+1,N)
      GO TO 190
  188 CONTINUE
      IF ((J/2)*2.NE.J) GO TO 190
      DCONR(JVXP1,J/2,N) = DCONB(N2,I+1,N)
      GO TO 190
  189 IF (MB.NE.N17) GO TO 190
C     DCONB(N2,I+1,N) = BBND(K)*TAB/(1.0+DELB*BBND(K)/SIG(K,M,1))
      DCONB(N2,I+1,N) = BBND(K)*TAB/(1.0+DELB*BBND(K)/SIG(K,M,11))
      IF (DCONB(N2,I+1,N).EQ.0.0) DCONB(N2,I+1,N) = 4096.0E-13
  190 IF (I.EQ.1) GO TO 192
  191 IF (MT.NE.N17) GO TO 192
C     DCONB(J,I,N) = BBND(K)*TAT/(1.0+DELT*BBND(K)/SIG(K,M,1))
      DCONB(J,I,N) = BBND(K)*TAT/(1.0+DELT*BBND(K)/SIG(K,M,11))
  192 CONTINUE
      IF (JMAX.LE.1) GO TO 196
      IF (J.LT.JMAX) GO TO 193
      IF (INRB.LE.1) GO TO 195
  193 IF (MR.NE.N17) GO TO 194
      DCONR(J+1,I,N) = BBND(K)*TAR/(1.0+DELR*BBND(K)/SIG(K,M,1))
      IF (DCONR(J+1,I,N).EQ.0.0) DCONR(J+1,I,N) = 4096.0E-13
C     IF (INRB.EQ.4) DCONR(JVXP1,IVXP1-I,N)=DCONR(JVXP1,I,N)
  194 IF (J.GT.1) GO TO 195
      IF (INRB.NE.2) GO TO 196
      IF (ML.NE.N17) GO TO 196
      DCONR(JVXP1,I,N) = BBND(K)*TAL/(1.0+DELL*BBND(K)/SIG(K,M,1))
      IF (DCONR(JVXP1,I,N).EQ.0.0) DCONR(JVXP1,I,N) = 4096.0E-13
      GO TO 196
  195 IF (ML.NE.N17) GO TO 196
      DCONR(J,I,N) = BBND(K)*TAL/(1.0+DELL*BBND(K)/SIG(K,M,1))
      IF (DCONR(J,I,N).EQ.0.0) DCONR(J ,I,N) = 4096.0E-13
  196 IF (NGEM.NE.9) GO TO 228
  197 KKK = IOVX+N
      IF (N17) 198,198,199
  198 CONTINUE
      IF (J.EQ.JMAX) GO TO 209
      IF (I.EQ.1) GO TO 224
      DCONR(J+1,I,KKK)=TAH*SIG(K,MH,1)/(DELHT+DELHB*SIG(K,MH,1)/SIG(K,M,
     &  1))
      GO TO 208
  199 IF (XMIS(2)) 200,202,202
  200 IF (BBND(K)) 198,198,202
  201 DCONR(J+1,I,KKK)=0
      GO TO 208
  202 IF (MH-N17) 205,203,205
  203 IF (M-N17) 204,201,204
  204 DCONR(J+1,I,KKK)=BBND(K)*TAH/(1.0+DELHT*BBND(K)/SIG(K,M,1))
      GO TO 208
  205 IF (M-N17) 198,206,198
  206 IF (MH) 201,201,207
  207 DCONR(J+1,I,KKK)=BBND(K)*TAH/(1.0+DELHB*BBND(K)/SIG(K,MH,1))
  208 IF (J-JMAX) 216,209,209
  209 DCONR(J+1,I,KKK)=0
      IF (I-1) 210,210,214
  210 IF (DCONR(J+1,I,N)-4096.0E-13) 211,212,211
  211 DCONR(J+1,I,N)=1.5*DCONR(J+1,I,N)/SQUIRE
  212 IF (DCONB(J,I,N)-4096.0E-13) 213,224,213
  213 DCONB(J,I,N)=1.5*DCONB(J,I,N)/SQUIRE
      GO TO 224
  214 IF (DCONR(J+1,I,N)-4096.0E-13) 215,216,215
  215 DCONR(J+1,I,N)=2.0*DCONR(J+1,I,N)/SQUIRE
  216 IF (I-IMAX) 224,217,217
  217 DCONR(J,I+1,KKK)=0
      IF (J-1) 218,218,222
  218 IF (DCONR(J,I,N)-4096.0E-13) 219,220,219
  219 DCONR(J,I,N)=1.5*DCONR(J,I,N)/SQUIRE
  220 IF (DCONB(J,I+1,N)-4096.0E-13) 221,224,221
  221 DCONB(J,I+1,N)=1.5*DCONB(J,I+1,N)/SQUIRE
      GO TO 224
  222 IF (DCONB(J,I+1,N)-4096.0E-13) 223,224,223
  223 DCONB(J,I+1,N)=2.0*DCONB(J,I+1,N)/SQUIRE
  224 IF (I-1) 225,225,226
  225 DCONR(J+1,I,KKK)=0
      IF (J.NE.JMAX) DCONB(J,1,N) = 2.0*DCONB(J,1,N)/SQUIRE
  226 IF (J-1) 227,227,228
  227 DCONR(J,I+1,KKK)=0
      IF (I.NE.IMAX) DCONR(1,I,N) = 2.0*DCONR(1,I,N)/SQUIRE
  228 CONTINUE
  229 CONTINUE
  230 CONTINUE
      GO TO (237,235,233,231),INRB
  231 I=IVX/2
      DO 232LL=1,I
      DCONR(JVXP1,IVXP1-LL,N)=DCONR(JVXP1,LL,N)
  232 CONTINUE
      GO TO 237
  233 DCONR(JVXP1,IVX,N)=4096.0E-13
      LJ = 1
      DO 234 LL = 1,IVX
      DCONB(LJ,IVXP1,N) = DCONR(JVXP1,LL,N)
      LJ = LJ+1
      IF (NGEM.EQ.10) LJ = LJ+1
  234 CONTINUE
      GO TO 237
  235 DO 236I=1,IVX
      DCONR(1,I, N )=DCONR(JVXP1,I,N)
  236 CONTINUE
  237 CONTINUE
      DO 242 I=1,IMAX
      DO 241 J=1,JMAX
      NRN = NRGN(J,I)
      M = NCOMP(NRN)
      D1 = DCONB(J,I,N)
      D2 = DCONB(J,I+1,N)
      IF (NGEM.NE.10) GO TO 238
      D2 = 0.0
      IF (J.EQ.1) GO TO 238
      D2 = DCONB(J-1,I+1,N)
  238 CONTINUE
      D3 = DCONR(J,I,N)
      D4 = DCONR(J+1,I,N)
      D7 = SIG(K,M,10)
      TPTSA = D1 + D2 + D3 + D4 + D7*PVOL(NRN)
      IF (NGEM.NE.9) GO TO 239
      D5 = DCONR(J,I+1,KKK)
      D6 = DCONR(J+1,I,KKK)
      TPTSA = TPTSA+D5+D6
  239 CONTINUE
      PTSA(J,I,N)=TPTSA
      IF ((TPTSA.EQ.0.0).OR.(SIG(K,M,5).EQ.0.0)) GO TO 240
      SPARE(57) = AMAX1(SPARE(57),SIG(K,M,5)*PVOL(NRN)/PTSA(J,I,N))
  240 CONTINUE
  241 CONTINUE
  242 CONTINUE
      IF (IX37.EQ.0) GO TO 243
      WRITE(IOADJ) AIO
  243 CONTINUE
      IF (IX37.EQ.0) GO TO 244
C     END FILE IOADJ
      REWIND IOADJ
  244 CONTINUE
C     DIAGONAL SYMMETRY CHECKOUT
      IF (IX(71).GT.0) GO TO 262
      IF (NUAC(8)) 247,262,245
  245 IF (IMAX-JMAX) 246,254,246
  246 NUAC(8)=0
      WRITE(IOUT,1001)
      GO TO 261
  247 II=IMAX/2
      DO 253 N = 1,KMAX
      K = N
      IF (IX37.EQ.0) GO TO 248
      K =1
      READ(IO15) AIO
  248 CONTINUE
      DO 252I=1,II
      L=IMAX-I+1
      DO 251J=1,JMAX
      M=JMAX-J+1
      MT=NRGN(J,I)
      ML=NRGN(M,L)
      IF (NCOMP(MT)-NCOMP(ML)) 246,249,246
  249 CONTINUE
      IF (PTSA(J,I,K).EQ.0.0) GO TO 250
      IF (ABS(PTSA(M,L,K)/PTSA(J,I,K)-1.0)-EPICH) 250,246,246
  250 CONTINUE
  251 CONTINUE
  252 CONTINUE
  253 CONTINUE
      GO TO 261
  254 CONTINUE
      DO 260 N = 1,KMAX
      K = N
      IF (IX37.EQ.0) GO TO 255
      K = 1
      READ(IO15) AIO
  255 CONTINUE
      DO 259 I = 1,IMAX
      DO 258J=I,JMAX
      MT=NRGN(J,I)
      ML=NRGN(I,J)
      IF (NCOMP(MT)-NCOMP(ML)) 246,256,246
  256 CONTINUE
      IF (PTSA(I,J,K).EQ.0.0) GO TO 257
      IF (ABS(PTSA(J,I,K)/PTSA(I,J,K)-1.0)-EPICH) 257,246,246
  257 CONTINUE
  258 CONTINUE
  259 CONTINUE
  260 CONTINUE
      NUAC(20)=1
  261 CONTINUE
      IF (IX37.GT.0) REWIND IO15
  262 CONTINUE
      IF (SPARE(51).NE.0.0) SPARE(51) = -1.0/SPARE(51)
      IF (SPARE(57).NE.0.0) SPARE(57) = -1.0/SPARE(57)
      IF (IX(71).GT.0) IX(5)= 0
      RETURN
 1000 FORMAT(1H0,'ERROR STOP',4I6)
 1001 FORMAT(1H0,'DIAGONAL SYMMETRY OPTION DENIED')
 2000 FORMAT(1H ,'THE MESH IS NOT SQUARE, OR NOT EQUAL IN THE X AND Y ',
     &       'DIRECTIONS FOR 90 DEGREE ROTATIONAL SYMMETRY.')
 2001 FORMAT(1H ,'NO INITIAL VALUES OF THE SEARCH PARAMETERS (1/V,B**2,'
     &      ,'OR CONCENTRATIONS) WERE INPUT FOR A DIRECT SEARCH.')
      END
