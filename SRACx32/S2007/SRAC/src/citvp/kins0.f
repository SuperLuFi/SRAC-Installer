CKINS0--115 ***CITATION*** CALC. ROD LOSSES FOR 3D  /CF-KLUX
C FOR VP-VERSION CALCULATION INDEX SET
C
      SUBROUTINE KINS0(P2E,B2,NRGNE,DCONBE,DCONRE,DCONBK,SCAC,XL, IVX,
     & JVX,KBVX,KVX,LVX,JVXP1,KBVXP1,JIVX,JIP1VX,JP1IXZ,IOVX,IOVZ, PVOL,
CITJMOD
C    &  NCOMP,MVX,IVXP1)
     &  NCOMP,MVX,IVXP1,
     &  NVPHZ1,NVPHZ2,NVPHZ3,NVPHZ4,NVPHZ5,NVPHZ6,NVPHZ7,NVPHZ8,NVPHZ,
     &  JP5K)
CITJMOD
C
CDEL  INTEGER RGX , MSX , ZNEX , ZDX , WZX
CDEL  PARAMETER ( RGX=100, MSX=211, ZDX=200, ZNEX=1000, WZX=100 )
      INCLUDE  'CITPMINC'
C
      REAL*8 SUMXI,TPTSA,XADB,XPDB,XS1DB,XS2DB, TL,XRDB,CS1S,CS2S,XLL1,
     & D8,XADX,YADX, XLL2,XLL3,XLL4,XLL5,XLL6,XLEK,B2LK,B3LK,B4LK,B5LK,
     & D1,D2,D3,D4,D5, D6,D7,YADB,YPDB,YLEK,YS1S,YS2S,YS1DB,YS2DB,YRDB,
     & SPR50,XLAST
C
      COMMON/ADUBP/SUMXI(ZNEX)
     &                  ,TPTSA,XADB,XPDB,XS1DB,XS2DB, TL,XRDB,CS1S,CS2S,
     &  XLL1,D8,XADX,YADX, XLL2,XLL3,XLL4,XLL5,XLL6,XLEK,B2LK,B3LK,B4LK,
     &  B5LK,D1,D2,D3,D4,D5, D6,D7,YADB,YPDB,YLEK,YS1S,YS2S,YS1DB,YS2DB,
     &  YRDB,SPR50,XLAST
      COMMON/ALSUB/BLSUB(30),TITL1(18),TITL2(18),IMAX,JMAX,KBMAX,KMAX,
     & LMAX,MMAX, NMAX,IMXP1,JMXP1,KBMXP1,NSETMX,NTO,MM1VX,KM1VX,IOIN,
     & IOUT,IOSIG,IOFLX,IO1,IO2,IO3,IO4,IO7,NER(100), IX(200),INNO(100),
     &  NGC(24),IEDG(24),ITMX(24),TIMX(6), GLIM(6),NDPL(24),IEDP1(24),
     & IEDP2(24),IEDP3(24), DPLH(6),NUAC(24),EPI(6),XMIS(6),NSRH(24),
     & XSRH1(6), XTR1(WZX),XTR2(WZX),NXTR1(WZX),NXTR2(WZX),SPARE(200),
     & IXPUT(200),XPUT(200)
      COMMON/AFLUX/BFLUX(30),KXMN8,NIT,NIIT,NIIIT,JXP1,KSCT1,KSCT2,
     & ISTART,IEP, VRGP1,VRGP2,VRGP3,VRG1,VRG2,VRGK1,VRGK2,XABS,PROD,
     & XELK,RMX,RMN,XKEF1,XKEF2,XKEF3,EXFC1,EXFC2,EXFC3, NI3,IEXTR,
     & IRECV,VRGABS,LO3,LO4,XLAMDA,EPI1,EPI2, BETTA,SAMXI,IX25,IX28,I,J,
     &  KB,K,ITMAX,ITIME, BET(MSX),DEL(MSX)
C
      DIMENSION P2E(JIVX,KBVX,KVX),B2(MVX,KVX),NRGNE(JVX,IVX,KBVX),
     & DCONBE(JIP1VX,KBVX,IOVX),DCONRE(JP1IXZ,KBVX,IOVZ), DCONBK(JIVX,
     & KBVXP1,IOVX),SCAC(KVX,MVX,KVX),XL(6,KVX)
      DIMENSION PVOL(LVX),NCOMP(LVX)
CITJMOD
      DIMENSION NVPHZ1(JP5K,3),NVPHZ2(JP5K,3),NVPHZ3(JP5K,3),
     &          NVPHZ4(JP5K,3),NVPHZ5(JP5K,3),NVPHZ6(JP5K,3),
     &          NVPHZ7(JP5K,3),NVPHZ8(JP5K,3),NVPHZ(8)
CITJMOD
C
CCCCC ********* SUBSCRIPT DEFINITIONS (KINS E-110) ********* CCCCC
C    NEW         OLD            NEW         OLD
C     N1         J,I             N6       J-1,I+1
C     N2         J,I-1           N7       J+1,I-1
C     N3         J,I+1           N8 *       J,I
C     N4       J-1,I             N9 *       J,I+1
C     N5       J+1,I             N10 *    J+1,I
C     N11        1,I             N12      JVX,I
C     N13      JVX,J             N14        I,IVX
C     N15      JVX,IVXP1-I
C
C     INRB = 1  ORDINARY
C     INRB = 2  PERIODIC(REPEATING)
C     INRB = 3  90 DEGREE ROTATIONAL
C     INRB = 4  180 DEGREE ROTATIONAL
C
CITJMOD
      ICNT1 = 0
      ICNT2 = 0
      ICNT3 = 0
      ICNT4 = 0
      ICNT5 = 0
      ICNT6 = 0
      ICNT7 = 0
      ICNT8 = 0
      IERR  = 0
CITJMOD
      INRB = IX(72) + 1
      N = IX(20)
  100 DO 146 KB = 1,KBMAX
      DO 145 I = 1,IMAX
      NN1= (I-1)*JVX
      NN2= (I-1)*JVXP1
      DO 144 J = 1,JMAX
      N1= NN1 + J
      N2= N1 - JVX
      N3= N1 + JVX
      N4= N1 - 1
      N5= N1 + 1
      N6= N3 - 1
      N7= N2 + 1
      N8= NN2 + J
      N9= N8 + JVXP1
      N10= N8 + 1
      L = NRGNE(J,I,KB)
      M = NCOMP(L)
CITJMOD
C     IF (P2E(N1,KB,K)) 103,101,103
      IF (P2E(N1,KB,K)) 103,143,103
C 101 IF (XMIS(2).GE.0) GO TO 143
C     TT5 = 0.0
C     DO 102 KK = 1,KMAX
C     TT5 = TT5 + SCAC(KK,M,K)*P2E(N1,KB,KK)
C 102 CONTINUE
C     B2(M,K) = B2(M,K) + TT5*PVOL(L)
C     GO TO 143
CITJMOD
  103 IF (KB-1) 106,106,104
  104 IF (P2E(N1,KB-1,K)) 106,105,106
  105 LF = NRGNE(J,I,KB-1)
      MF = NCOMP(LF)
CITJMOD
C     B2(MF,K) = B2(MF,K)+P2E(N1 ,KB,K)*DCONBK(N1 ,KB,N)
      ICNT1 = ICNT1+1
      IF (ICNT1.LE.JP5K) THEN
        NVPHZ1(ICNT1,1) = (KB-1)*JIVX+N1
        NVPHZ1(ICNT1,2) = MF
        NVPHZ1(ICNT1,3) = (KB-1)*JIVX+N1
        ELSE
        IERR = 1
      END IF
CITJMOD
  106 IF (KB-KBMAX) 107,110,110
  107 IF (P2E(N1,KB+1,K)) 110,108,110
  108 LBK = NRGNE(J,I,KB+1)
      MBK = NCOMP(LBK)
CITJMOD
C     T1 = DCONBK(N1 ,KB+1 ,N)
C     IF (T1-4096.0E-13) 109,110,109
C 109 B2(MBK,K) = B2(MBK,K)+P2E(N1 ,KB,K)*T1
      ICNT2 = ICNT2+1
      IF (ICNT2.LE.JP5K) THEN
        NVPHZ2(ICNT2,1) = KB*JIVX+N1
        NVPHZ2(ICNT2,2) = MBK
        NVPHZ2(ICNT2,3) = (KB-1)*JIVX+N1
        ELSE
        IERR = 1
      END IF
CITJMOD
  110 IF (I-1) 114,114,111
  111 CONTINUE
      IF (NUAC(5).NE.14) GO TO 112
      IF (P2E(N7,KB,K).NE.0) GO TO 114
      LT = NRGNE(J+1,I-1,KB)
      GO TO 113
  112 CONTINUE
      IF (P2E(N2,KB,K).NE.0) GO TO 114
      LT = NRGNE(J,I-1,KB)
  113 CONTINUE
      MT = NCOMP(LT)
CITJMOD
C     B2(MT,K) = B2(MT,K)+P2E(N1 ,KB,K)*DCONBE(N1 ,KB,N)
      ICNT3 = ICNT3+1
      IF (ICNT3.LE.JP5K) THEN
        NVPHZ3(ICNT3,1) = (KB-1)*JIP1VX+N1
        NVPHZ3(ICNT3,2) = MT
        NVPHZ3(ICNT3,3) = (KB-1)*JIVX+N1
        ELSE
        IERR = 1
      END IF
CITJMOD
  114 IF (I-IMAX) 117,115,115
  115 IF (INRB.NE.3) GO TO 122
      N13 = J*JVX
      LB = NRGNE(JVX,J,KB)
      IF (NUAC(5).NE.14) GO TO 116
      IF ((J/2)*2.NE.J) GO TO 122
      N13 = N13/2
      LB = NRGNE(JVX,J/2,KB)
  116 CONTINUE
      IF (P2E(N13,KB,K).NE.0.0) GO TO 122
      MB = NCOMP(LB)
CITJMOD
C     T1 = DCONBE(N3,KB,N)
CITJMOD
      GO TO 120
  117 CONTINUE
      IF (NUAC(5).NE.14) GO TO 118
      IF (J.EQ.1) GO TO 122
      IF (P2E(N6,KB,K).NE.0) GO TO 122
      LB = NRGNE(J-1,I+1,KB)
      N3 = N3-1
      GO TO 119
  118 CONTINUE
      IF (P2E(N3,KB,K).NE.0) GO TO 122
      LB = NRGNE(J ,I+1,KB)
  119 CONTINUE
      MB = NCOMP(LB)
CITJMOD
C     T1 = DCONBE(N3 ,KB,N)
C 120 IF (T1-4096.0E-13) 121,122,121
C 121 B2(MB,K) = B2(MB,K)+P2E(N1 ,KB,K)*T1
  120 CONTINUE
      ICNT4 = ICNT4+1
      IF (ICNT4.LE.JP5K) THEN
        NVPHZ4(ICNT4,1) = (KB-1)*JIP1VX+N3
        NVPHZ4(ICNT4,2) = MB
        NVPHZ4(ICNT4,3) = (KB-1)*JIVX+N1
        ELSE
        IERR = 1
      END IF
CITJMOD
  122 IF (J.LE.1) GO TO 123
      IF (P2E(N4,KB,K).NE.0.0) GO TO 125
      LL = NRGNE(J-1,I,KB)
      ML = NCOMP(LL)
      GO TO 124
  123 IF (INRB.NE.2) GO TO 125
      N12 = NN1 + JVX
      IF (P2E(N12,KB,K).NE.0.0) GO TO 125
      LL = NRGNE(JVX,I,KB)
      ML = NCOMP(LL)
CITJMOD
C 124 B2(ML,K) = B2(ML,K) + P2E(N1 ,KB,K)*DCONRE(N8 ,KB,N)
  124 CONTINUE
      ICNT5 = ICNT5+1
      IF (ICNT5.LE.JP5K) THEN
        NVPHZ5(ICNT5,1) = (KB-1)*JP1IXZ+N8
        NVPHZ5(ICNT5,2) = ML
        NVPHZ5(ICNT5,3) = (KB-1)*JIVX+N1
        ELSE
        IERR = 1
      END IF
CITJMOD
  125 IF (J.GE.JVX) GO TO 126
      IF (P2E(N5,KB,K).NE.0.0) GO TO 133
      LR = NRGNE(J+1,I,KB)
      MR = NCOMP(LR)
CITJMOD
C     T1 = DCONRE(N10 ,KB,N)
CITJMOD
      GO TO 131
  126 GO TO (133,127,128,130),INRB
  127 CONTINUE
      N11 = NN1 + 1
      IF (P2E(N11,KB,K).NE.0.0) GO TO 133
      LR = NRGNE(1,I,KB)
      MR = NCOMP(LR)
CITJMOD
C     T1 = DCONRE(N10 ,KB,N)
CITJMOD
      GO TO 131
  128 CONTINUE
      N14 = (IVX-1)*JVX + I
      LR = NRGNE(I,IVX,KB)
      IF (NUAC(5).NE.14) GO TO 129
      N14 = N14+I
      LR = NRGNE(2*I,IVX,KB)
  129 CONTINUE
      IF (P2E(N14,KB,K).NE.0.0) GO TO 133
      MR = NCOMP(LR)
CITJMOD
C     T1 = DCONRE(N10,KB,N)
CITJMOD
      GO TO 131
  130 CONTINUE
      N15 = (IVXP1-I)*JVX
      IF (P2E(N15,KB,K).NE.0.0) GO TO 133
      LR = NRGNE(JVX,IVXP1-I,KB)
      MR = NCOMP(LR)
CITJMOD
C     T1 = DCONRE(N10,KB,N)
C 131 IF (T1.EQ.4096.0E-13) GO TO 133
C 132 B2(MR,K) = B2(MR,K) + P2E(N1 ,KB,K)*T1
  131 CONTINUE
      ICNT6 = ICNT6+1
      IF (ICNT6.LE.JP5K) THEN
        NVPHZ6(ICNT6,1) = (KB-1)*JP1IXZ+N10
        NVPHZ6(ICNT6,2) = MR
        NVPHZ6(ICNT6,3) = (KB-1)*JIVX+N1
        ELSE
        IERR = 1
      END IF
CITJMOD
  133 IF (NUAC(5)-13) 143,134,143
  134 KKK = N + IOVX
      IF (I-1) 138,138,135
  135 IF (J-JMAX) 136,138,138
  136 IF (P2E(N7,KB,K)) 138,137,138
  137 LB=NRGNE(J+1,I-1,KB)
      MB = NCOMP(LB)
CITJMOD
C     B2(MB,K)=B2(MB,K)+P2E(N1 ,KB,K)*DCONRE(N10 ,KB,KKK)
      ICNT7 = ICNT7+1
      IF (ICNT7.LE.JP5K) THEN
        NVPHZ7(ICNT7,1) = (KB-1)*JP1IXZ+N10
        NVPHZ7(ICNT7,2) = MB
        NVPHZ7(ICNT7,3) = (KB-1)*JIVX+N1
        ELSE
        IERR = 1
      END IF
CITJMOD
  138 IF (J-1) 142,142,139
  139 IF (I-IMAX) 140,142,142
  140 IF (P2E(N6,KB,K)) 142,141,142
  141 LB=NRGNE(J-1,I+1,KB)
      MB = NCOMP(LB)
CITJMOD
C     B2(MB,K)=B2(MB,K)+P2E(N1 ,KB,K)*DCONRE(N9 ,KB,KKK)
      ICNT8 = ICNT8 + 1
      IF (ICNT8.LE.JP5K) THEN
        NVPHZ8(ICNT8,1) = (KB-1)*JP1IXZ+N9
        NVPHZ8(ICNT8,2) = MB
        NVPHZ8(ICNT8,3) = (KB-1)*JIVX+N1
        ELSE
        IERR = 1
      END IF
CITJMOD
  142 CONTINUE
  143 CONTINUE
  144 CONTINUE
  145 CONTINUE
  146 CONTINUE
  147 CONTINUE
CITJMOD
C     IF (NUAC(17).EQ.0) GO TO 149
C     DO 148 M=1,MMAX
C     XRDB = XRDB + B2(M,K)
C 148 CONTINUE
C 149 CONTINUE
      NVPHZ(1) = ICNT1
      NVPHZ(2) = ICNT2
      NVPHZ(3) = ICNT3
      NVPHZ(4) = ICNT4
      NVPHZ(5) = ICNT5
      NVPHZ(6) = ICNT6
      NVPHZ(7) = ICNT7
      NVPHZ(8) = ICNT8
      IF (IERR.NE.0) THEN
        MAXW = 0
        DO 150 I = 1,8
         MAXW = MAX(MAXW,NVPHZ(I))
  150   CONTINUE
        WRITE(6,'(100A)') ' ',('=',I=1,99)
        WRITE(6,'(A,A,I10,A)')
     >    ' = SYSTEM ERROR IN KINS0 PLEASE CHANGE ''JP5K'' IN SUB. ',
     >    ' IPTM & KLUX , REQUIRED JP5K IS',JP5K,' WORDS'
        WRITE(6,'(100A)') ' ',('=',I=1,99)
        STOP
      END IF
CITJMOD
      RETURN
      END
